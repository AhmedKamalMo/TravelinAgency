#!/usr/bin/env node

console.log('ðŸ”§ FIXING NUXT.JS STATIC ASSETS LOADING');
console.log('========================================\n');

console.log('ðŸ“‹ DEPLOYMENT COMMANDS TO FIX _NUXT ASSETS:');
console.log('============================================');
console.log('');
console.log('# 1. Deploy the fixed index.php');
console.log('cat > index.php << "EOF"');
console.log('<?php');
console.log('// Fixed index.php for Nuxt.js deployment with proper _nuxt asset handling');
console.log('header("Content-Type: text/html; charset=utf-8");');
console.log('');
console.log('// Get the request URI');
console.log('$requestUri = $_SERVER["REQUEST_URI"];');
console.log('$cleanUri = parse_url($requestUri, PHP_URL_PATH);');
console.log('$cleanUri = strtok($cleanUri, "?");');
console.log('');
console.log('// Handle API routes first');
console.log('if (strpos($cleanUri, "/api/") === 0) {');
console.log('    if (file_exists(__DIR__ . "/api-handler.php")) {');
console.log('        include __DIR__ . "/api-handler.php";');
console.log('        exit;');
console.log('    }');
console.log('}');
console.log('');
console.log('// Handle Nuxt.js static assets (_nuxt/) - FIXED VERSION');
console.log('if (strpos($cleanUri, "/_nuxt/") === 0) {');
console.log('    $possiblePaths = [');
console.log('        __DIR__ . "/output/public" . $cleanUri,');
console.log('        __DIR__ . "/output" . $cleanUri,');
console.log('        __DIR__ . "/dist" . $cleanUri,');
console.log('        __DIR__ . "/public" . $cleanUri,');
console.log('        __DIR__ . $cleanUri');
console.log('    ];');
console.log('');
console.log('    foreach ($possiblePaths as $nuxtPath) {');
console.log('        if (file_exists($nuxtPath)) {');
console.log('            $fileExtension = strtolower(pathinfo($nuxtPath, PATHINFO_EXTENSION));');
console.log('            if ($fileExtension === "css") {');
console.log('                header("Content-Type: text/css");');
console.log('            } elseif ($fileExtension === "js") {');
console.log('                header("Content-Type: application/javascript");');
console.log('            }');
console.log('            header("Cache-Control: public, max-age=31536000");');
console.log('            readfile($nuxtPath);');
console.log('            exit;');
console.log('        }');
console.log('    }');
console.log('');
console.log('    http_response_code(404);');
console.log('    echo "Nuxt asset not found: " . $cleanUri;');
console.log('    exit;');
console.log('}');
console.log('');
console.log('// Handle static files');
console.log('$staticExtensions = ["css", "js", "jpg", "jpeg", "png", "gif", "webp", "svg", "ico", "woff", "woff2", "ttf", "eot"];');
console.log('$fileExtension = strtolower(pathinfo($cleanUri, PATHINFO_EXTENSION));');
console.log('');
console.log('if (in_array($fileExtension, $staticExtensions)) {');
console.log('    $possiblePaths = [');
console.log('        __DIR__ . $cleanUri,');
console.log('        __DIR__ . "/public" . $cleanUri,');
console.log('        __DIR__ . "/output/public" . $cleanUri,');
console.log('        __DIR__ . "/dist" . $cleanUri');
console.log('    ];');
console.log('');
console.log('    foreach ($possiblePaths as $filePath) {');
console.log('        if (file_exists($filePath)) {');
console.log('            if ($fileExtension === "css") {');
console.log('                header("Content-Type: text/css");');
console.log('            } elseif ($fileExtension === "js") {');
console.log('                header("Content-Type: application/javascript");');
console.log('            }');
console.log('            header("Cache-Control: public, max-age=31536000");');
console.log('            readfile($filePath);');
console.log('            exit;');
console.log('        }');
console.log('    }');
console.log('');
console.log('    http_response_code(404);');
console.log('    echo "File not found: " . $cleanUri;');
console.log('    exit;');
console.log('}');
console.log('');
console.log('// Serve the main Nuxt.js application');
console.log('$nuxtFiles = [');
console.log('    __DIR__ . "/index.html",');
console.log('    __DIR__ . "/200.html",');
console.log('    __DIR__ . "/output/index.html",');
console.log('    __DIR__ . "/output/200.html"');
console.log('];');
console.log('');
console.log('foreach ($nuxtFiles as $nuxtFile) {');
console.log('    if (file_exists($nuxtFile)) {');
console.log('        $content = file_get_contents($nuxtFile);');
console.log('        $content = str_replace("src=\\"/", "src=\\"", $content);');
console.log('        $content = str_replace("href=\\"/", "href=\\"", $content);');
console.log('        echo $content;');
console.log('        exit;');
console.log('    }');
console.log('}');
console.log('');
console.log('// Fallback page');
console.log('http_response_code(200);');
console.log('echo "<!DOCTYPE html><html><head><title>World Trip Agency</title></head><body><h1>Website Loading...</h1></body></html>";');
console.log('?>');
console.log('EOF');
console.log('');
console.log('# 2. Test _nuxt assets');
console.log('curl -k -I https://worldtripagency.com/_nuxt/entry.Cjk20dY-.css');
console.log('curl -k -I https://worldtripagency.com/_nuxt/CNW6Qy33.js');
console.log('');
console.log('# 3. Test the admin page');
console.log('curl -k -I https://worldtripagency.com/admin/login');
console.log('');
console.log('ðŸŽ¯ This will fix:');
console.log('âœ… _nuxt CSS files loading (404 errors)');
console.log('âœ… _nuxt JS files loading (404 errors)');
console.log('âœ… Admin page styling and functionality');
console.log('âœ… All Nuxt.js static assets');
