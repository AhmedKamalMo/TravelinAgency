#!/usr/bin/env node

console.log('ðŸ”§ FIXING 500 INTERNAL SERVER ERROR');
console.log('===================================\n');

console.log('ðŸ“‹ DEPLOYMENT COMMANDS TO FIX 500 ERROR:');
console.log('=========================================');
console.log('');
console.log('# 1. Restore working index.php with _nuxt fix');
console.log('cat > index.php << "EOF"');
console.log('<?php');
console.log('header("Content-Type: text/html; charset=utf-8");');
console.log('');
console.log('$requestUri = $_SERVER["REQUEST_URI"];');
console.log('$cleanUri = parse_url($requestUri, PHP_URL_PATH);');
console.log('$cleanUri = strtok($cleanUri, "?");');
console.log('');
console.log('// Handle API routes first');
console.log('if (strpos($cleanUri, "/api/") === 0) {');
console.log('    if (file_exists(__DIR__ . "/api-handler.php")) {');
console.log('        include __DIR__ . "/api-handler.php";');
console.log('        exit;');
console.log('    }');
console.log('}');
console.log('');
console.log('// Handle _nuxt assets - SIMPLE FIX');
console.log('if (strpos($cleanUri, "/_nuxt/") === 0) {');
console.log('    $nuxtPath = __DIR__ . "/output/public" . $cleanUri;');
console.log('    if (file_exists($nuxtPath)) {');
console.log('        $ext = strtolower(pathinfo($nuxtPath, PATHINFO_EXTENSION));');
console.log('        if ($ext === "css") header("Content-Type: text/css");');
console.log('        if ($ext === "js") header("Content-Type: application/javascript");');
console.log('        header("Cache-Control: public, max-age=31536000");');
console.log('        readfile($nuxtPath);');
console.log('        exit;');
console.log('    }');
console.log('    http_response_code(404);');
console.log('    echo "Asset not found";');
console.log('    exit;');
console.log('}');
console.log('');
console.log('// Handle static files');
console.log('$extensions = ["css", "js", "jpg", "jpeg", "png", "gif", "webp", "svg", "ico"];');
console.log('$ext = strtolower(pathinfo($cleanUri, PATHINFO_EXTENSION));');
console.log('');
console.log('if (in_array($ext, $extensions)) {');
console.log('    $paths = [');
console.log('        __DIR__ . $cleanUri,');
console.log('        __DIR__ . "/output/public" . $cleanUri');
console.log('    ];');
console.log('');
console.log('    foreach ($paths as $path) {');
console.log('        if (file_exists($path)) {');
console.log('            if ($ext === "css") header("Content-Type: text/css");');
console.log('            if ($ext === "js") header("Content-Type: application/javascript");');
console.log('            readfile($path);');
console.log('            exit;');
console.log('        }');
console.log('    }');
console.log('');
console.log('    http_response_code(404);');
console.log('    echo "File not found";');
console.log('    exit;');
console.log('}');
console.log('');
console.log('// Serve main application');
console.log('$files = [');
console.log('    __DIR__ . "/index.html",');
console.log('    __DIR__ . "/200.html",');
console.log('    __DIR__ . "/output/public/200.html"');
console.log('];');
console.log('');
console.log('foreach ($files as $file) {');
console.log('    if (file_exists($file)) {');
console.log('        $content = file_get_contents($file);');
console.log('        $content = str_replace("src=\\"/", "src=\\"", $content);');
console.log('        $content = str_replace("href=\\"/", "href=\\"", $content);');
console.log('        echo $content;');
console.log('        exit;');
console.log('    }');
console.log('}');
console.log('');
console.log('// Fallback');
console.log('echo "<!DOCTYPE html><html><head><title>World Trip Agency</title></head><body><h1>Loading...</h1></body></html>";');
console.log('?>');
console.log('EOF');
console.log('');
console.log('# 2. Test the website');
console.log('curl -k -I https://travelin-agency-nlcs.vercel.app/');
console.log('');
console.log('# 3. Test _nuxt assets');
console.log('curl -k -I https://travelin-agency-nlcs.vercel.app/_nuxt/entry.Cjk20dY-.css');
console.log('');
console.log('ðŸŽ¯ This will fix:');
console.log('âœ… 500 Internal Server Error');
console.log('âœ… _nuxt assets loading');
console.log('âœ… Main website functionality');
console.log('âœ… Admin page styling');
