import{i as e}from"./AdminPageHeader.vue.mjs";import{q as t}from"./index2.mjs";import{M as r}from"./nuxt-link.mjs";import{d as a}from"./AdminStats.vue.mjs";import{ref as s,computed as l,readonly as o,watch as n,mergeProps as i,withCtx as d,createVNode as u,unref as c,createTextVNode as m,useSSRContext as p}from"vue";import{ssrRenderAttrs as v,ssrRenderComponent as y,ssrRenderAttr as x,ssrIncludeBooleanAttr as w,ssrLooseContain as f,ssrLooseEqual as b,ssrRenderList as $,ssrInterpolate as A,ssrRenderClass as S}from"vue/server-renderer";import{p as D}from"./useExcelExport.mjs";import{H as L}from"./server.mjs";import"@iconify/utils/lib/css/icon";import"@iconify/vue";import"fs";import"stream";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"node:crypto";import"consola";import"node:url";import"ipx";import"node:fs";import"node:path";import"vue-router";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"unhead/utils";import"devalue";import"unhead/plugins";import"@unhead/schema-org";import"@unhead/schema-org/vue";import"floating-vue";const C={__name:"index",__ssrInlineRender:!0,setup(p){const{users:C,isLoading:_,userStats:E,getRoleName:k,getRoleColor:T,getStatusName:U,getStatusColor:F,formatDate:j}=(()=>{const e=s([]),t=s(null),r=s(!1),a=s(null),g=async t=>{try{r.value=!0,a.value=null;const s=new URLSearchParams;null!=t&&t.page&&s.append("page",t.page.toString()),null!=t&&t.limit&&s.append("limit",t.limit.toString()),null!=t&&t.search&&s.append("search",t.search),null!=t&&t.status&&s.append("status",t.status),null!=t&&t.role&&s.append("role",t.role);const l=await $fetch(`/api/admin/users?${s.toString()}`);if(l.success&&l.data)return e.value=l.data.users,l.data;throw new Error(l.error||"Failed to fetch users")}catch(t){throw console.error("Error fetching users:",t),a.value=t.message||"Failed to fetch users",e.value=[],t}finally{r.value=!1}},h=async(s,l)=>{var o;try{r.value=!0,a.value=null;const n=await $fetch(`/api/admin/users/${s}`,{method:"PUT",body:l});if(n.success&&n.data){const r=e.value.findIndex((e=>e.id.toString()===s.toString()));return-1!==r&&(e.value[r]=n.data),(null==(o=t.value)?void 0:o.id.toString())===s.toString()&&(t.value=n.data),n.data}throw new Error(n.error||"Failed to update user")}catch(e){throw console.error("Error updating user:",e),a.value=e.message||"Failed to update user",e}finally{r.value=!1}},n=l((()=>{const t=e.value.length,r=e.value.filter((e=>"active"===e.status)).length,a=e.value.filter((e=>"inactive"===e.status)).length,s=e.value.filter((e=>"suspended"===e.status)).length,l=new Date;l.setHours(0,0,0,0);const o=e.value.filter((e=>new Date(e.created_at)>=l)).length,n=new Date(l.getTime()-6048e5),i=e.value.filter((e=>new Date(e.created_at)>=n)).length,d=new Date(l.getTime()-2592e6);return{total:t,active:r,inactive:a,suspended:s,newToday:o,newThisWeek:i,newThisMonth:e.value.filter((e=>new Date(e.created_at)>=d)).length}}));return{users:o(e),currentUser:o(t),isLoading:o(r),error:o(a),userStats:n,fetchUsers:g,fetchUser:async e=>{try{r.value=!0,a.value=null;const s=await $fetch(`/api/admin/users/${e}`);if(s.success&&s.data)return t.value=s.data,s.data;throw new Error(s.error||"Failed to fetch user")}catch(e){throw console.error("Error fetching user:",e),a.value=e.message||"Failed to fetch user",t.value=null,e}finally{r.value=!1}},createUser:async t=>{try{r.value=!0,a.value=null;const s=await $fetch("/api/admin/users",{method:"POST",body:t});if(s.success&&s.data)return e.value.unshift(s.data),s.data;throw new Error(s.error||"Failed to create user")}catch(e){throw console.error("Error creating user:",e),a.value=e.message||"Failed to create user",e}finally{r.value=!1}},updateUser:h,deleteUser:async s=>{var l;try{r.value=!0,a.value=null;const o=await $fetch(`/api/admin/users/${s}`,{method:"DELETE"});if(o.success)return e.value=e.value.filter((e=>e.id.toString()!==s.toString())),(null==(l=t.value)?void 0:l.id.toString())===s.toString()&&(t.value=null),!0;throw new Error(o.error||"Failed to delete user")}catch(e){throw console.error("Error deleting user:",e),a.value=e.message||"Failed to delete user",e}finally{r.value=!1}},toggleUserStatus:async(e,t)=>{try{return await h(e,{status:t})}catch(e){throw console.error("Error toggling user status:",e),e}},changeUserRole:async(e,t)=>{try{return await h(e,{role:t})}catch(e){throw console.error("Error changing user role:",e),e}},searchUsers:async e=>{try{return await g({search:e})}catch(e){throw console.error("Error searching users:",e),e}},filterUsers:async e=>{try{return await g(e)}catch(e){throw console.error("Error filtering users:",e),e}},getRoleName:e=>({admin:"مدير",moderator:"مشرف",user:"مستخدم"}[e]||e),getRoleColor:e=>({admin:"bg-red-100 text-red-800",moderator:"bg-blue-100 text-blue-800",user:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),getStatusName:e=>({active:"نشط",inactive:"غير نشط",suspended:"معلق"}[e]||e),getStatusColor:e=>({active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-800",suspended:"bg-orange-100 text-orange-800"}[e]||"bg-gray-100 text-gray-800"),formatDate:e=>new Date(e).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}})(),R=s(""),M=s(""),N=s(""),P=s(""),H=s(1),I=l((()=>{let e=C.value;if(R.value&&(e=e.filter((e=>{var t,r,a;return(null==(t=e.full_name)?void 0:t.toLowerCase().includes(R.value.toLowerCase()))||(null==(r=e.name)?void 0:r.toLowerCase().includes(R.value.toLowerCase()))||e.email.toLowerCase().includes(R.value.toLowerCase())||(null==(a=e.phone)?void 0:a.toLowerCase().includes(R.value.toLowerCase()))}))),M.value&&(e=e.filter((e=>e.status===M.value))),N.value&&(e=e.filter((e=>e.role===N.value))),P.value){const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(r.getTime()-6048e5),s=new Date(r.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(P.value){case"today":return t>=r;case"week":return t>=a;case"month":return t>=s;default:return!0}}))}return e.slice(10*(H.value-1),10*H.value)})),W=l((()=>{let e=C.value;if(R.value&&(e=e.filter((e=>{var t,r,a;return(null==(t=e.full_name)?void 0:t.toLowerCase().includes(R.value.toLowerCase()))||(null==(r=e.name)?void 0:r.toLowerCase().includes(R.value.toLowerCase()))||e.email.toLowerCase().includes(R.value.toLowerCase())||(null==(a=e.phone)?void 0:a.toLowerCase().includes(R.value.toLowerCase()))}))),M.value&&(e=e.filter((e=>e.status===M.value))),N.value&&(e=e.filter((e=>e.role===N.value))),P.value){const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(r.getTime()-6048e5),s=new Date(r.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(P.value){case"today":return t>=r;case"week":return t>=a;case"month":return t>=s;default:return!0}}))}return e.length})),Y=l((()=>Math.ceil(W.value/10))),G=()=>{try{const{exportUsersToExcel:e}=D();e(C.value)?console.log("تم تصدير المستخدمين بنجاح"):console.error("فشل في تصدير المستخدمين")}catch(e){console.error("خطأ في تصدير المستخدمين:",e)}};return n([R,M,N,P],(()=>{H.value=1})),L({title:"إدارة المستخدمين - Wonder Land Admin",meta:[{name:"description",content:"إدارة وتحرير المستخدمين المسجلين"},{name:"robots",content:"noindex, nofollow"}]}),(s,l,o,n)=>{const p=e,D=t,L=r,C=a;l(`<div${v(i({class:"space-y-6"},n))}><div class="h-16"></div>`),l(y(p,{title:"إدارة المستخدمين",description:"إدارة وتحرير المستخدمين المسجلين"},{actions:d(((e,t,r,a)=>{if(!t)return[u("button",{onClick:G,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[u(D,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),u("span",{class:"hidden sm:inline"},"تصدير البيانات"),u("span",{class:"sm:hidden"},"تصدير")]),u(L,{to:"/admin/users/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:d((()=>[u(D,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),u("span",{class:"hidden sm:inline"},"إضافة مستخدم جديد"),u("span",{class:"sm:hidden"},"إضافة")])),_:1})];t(`<button class="inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"${a}>`),t(y(D,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,r,a)),t(`<span class="hidden sm:inline"${a}>تصدير البيانات</span><span class="sm:hidden"${a}>تصدير</span></button>`),t(y(L,{to:"/admin/users/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:d(((e,t,r,a)=>{if(!t)return[u(D,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),u("span",{class:"hidden sm:inline"},"إضافة مستخدم جديد"),u("span",{class:"sm:hidden"},"إضافة")];t(y(D,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,r,a)),t(`<span class="hidden sm:inline"${a}>إضافة مستخدم جديد</span><span class="sm:hidden"${a}>إضافة</span>`)})),_:1},r,a))})),_:1},o)),l(y(C,{stats:c(E)},null,o)),l('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div class="relative">'),l(y(D,{name:"material-symbols:search",class:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"},null,o)),l(`<input${x("value",c(R))} type="text" placeholder="البحث في المستخدمين..." class="w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></div><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${w(Array.isArray(c(M))?f(c(M),""):b(c(M),""))?" selected":""}>جميع الحالات</option><option value="active"${w(Array.isArray(c(M))?f(c(M),"active"):b(c(M),"active"))?" selected":""}>نشط</option><option value="inactive"${w(Array.isArray(c(M))?f(c(M),"inactive"):b(c(M),"inactive"))?" selected":""}>غير نشط</option><option value="suspended"${w(Array.isArray(c(M))?f(c(M),"suspended"):b(c(M),"suspended"))?" selected":""}>معلق</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${w(Array.isArray(c(N))?f(c(N),""):b(c(N),""))?" selected":""}>جميع الأدوار</option><option value="admin"${w(Array.isArray(c(N))?f(c(N),"admin"):b(c(N),"admin"))?" selected":""}>مدير</option><option value="moderator"${w(Array.isArray(c(N))?f(c(N),"moderator"):b(c(N),"moderator"))?" selected":""}>مشرف</option><option value="user"${w(Array.isArray(c(N))?f(c(N),"user"):b(c(N),"user"))?" selected":""}>مستخدم</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${w(Array.isArray(c(P))?f(c(P),""):b(c(P),""))?" selected":""}>جميع التواريخ</option><option value="today"${w(Array.isArray(c(P))?f(c(P),"today"):b(c(P),"today"))?" selected":""}>اليوم</option><option value="week"${w(Array.isArray(c(P))?f(c(P),"week"):b(c(P),"week"))?" selected":""}>هذا الأسبوع</option><option value="month"${w(Array.isArray(c(P))?f(c(P),"month"):b(c(P),"month"))?" selected":""}>هذا الشهر</option></select></div></div><div class="bg-white rounded-lg shadow-sm border border-gray-200">`),c(_)?(l('<div class="flex justify-center items-center py-12">'),l(y(D,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"},null,o)),l('<span class="mr-3 text-gray-600">جارٍ تحميل المستخدمين...</span></div>')):c(I).length>0?(l('<div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> المستخدم </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> البريد الإلكتروني </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الدور </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الحالة </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> تاريخ التسجيل </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الإجراءات </th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e'),$(c(I),(e=>{l('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-10 w-10"><div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center">'),l(y(D,{name:"material-symbols:person",class:"h-6 w-6 text-gray-600"},null,o)),l(`</div></div><div class="mr-4"><div class="text-sm font-medium text-gray-900">${A(e.full_name||e.name||"غير محدد")}</div><div class="text-sm text-gray-500">${A(e.phone||"لا يوجد رقم هاتف")}</div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900">${A(e.email)}</div><div class="text-sm text-gray-500">${A(e.email_verified?"مؤكد":"غير مؤكد")}</div></td><td class="px-6 py-4 whitespace-nowrap"><span class="${S([c(T)(e.role),"px-2 py-1 text-xs font-medium rounded-full"])}">${A(c(k)(e.role))}</span></td><td class="px-6 py-4 whitespace-nowrap"><span class="${S([c(F)(e.status),"px-2 py-1 text-xs font-medium rounded-full"])}">${A(c(U)(e.status))}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${A(c(j)(e.created_at))}</td><td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><div class="flex items-center space-x-2 space-x-reverse">`),l(y(L,{to:`/admin/users/${e.id}`,class:"text-blue-600 hover:text-blue-900 p-1 rounded",title:"عرض"},{default:d(((e,t,r,a)=>{if(!t)return[u(D,{name:"material-symbols:visibility",class:"h-4 w-4"})];t(y(D,{name:"material-symbols:visibility",class:"h-4 w-4"},null,r,a))})),_:2},o)),l(y(L,{to:`/admin/users/${e.id}/edit`,class:"text-green-600 hover:text-green-900 p-1 rounded",title:"تحرير"},{default:d(((e,t,r,a)=>{if(!t)return[u(D,{name:"material-symbols:edit",class:"h-4 w-4"})];t(y(D,{name:"material-symbols:edit",class:"h-4 w-4"},null,r,a))})),_:2},o)),l(`<button class="${S(["active"===e.status?"text-orange-600 hover:text-orange-900":"text-green-600 hover:text-green-900","p-1 rounded"])}"${x("title","active"===e.status?"إلغاء التفعيل":"تفعيل")}>`),l(y(D,{name:"active"===e.status?"material-symbols:pause":"material-symbols:play-arrow",class:"h-4 w-4"},null,o)),l('</button><button class="text-red-600 hover:text-red-900 p-1 rounded" title="حذف">'),l(y(D,{name:"material-symbols:delete",class:"h-4 w-4"},null,o)),l("</button></div></td></tr>")})),l("\x3c!--]--\x3e</tbody></table></div>")):(l('<div class="text-center py-12">'),l(y(D,{name:"material-symbols:people",class:"h-16 w-16 text-gray-300 mx-auto mb-4"},null,o)),l('<h3 class="text-lg font-medium text-gray-900 mb-2">لا يوجد مستخدمون</h3><p class="text-gray-500 mb-6">لم يتم العثور على أي مستخدمين</p>'),l(y(L,{to:"/admin/users/create",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},{default:d(((e,t,r,a)=>{if(!t)return[u(D,{name:"material-symbols:add",class:"h-5 w-5 ml-2"}),m(" إضافة مستخدم جديد ")];t(y(D,{name:"material-symbols:add",class:"h-5 w-5 ml-2"},null,r,a)),t(" إضافة مستخدم جديد ")})),_:1},o)),l("</div>")),l("</div>"),c(Y)>1?l(`<div class="flex items-center justify-between"><div class="text-sm text-gray-700"> عرض ${A(10*(c(H)-1)+1)} إلى ${A(Math.min(10*c(H),c(W)))} من أصل ${A(c(W))} مستخدم </div><div class="flex space-x-1 space-x-reverse"><button${w(1===c(H))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> السابق </button><span class="px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md">${A(c(H))}</span><button${w(c(H)===c(Y))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> التالي </button></div></div>`):l("\x3c!----\x3e"),l("</div>")}}},_=C.setup;C.setup=(e,t)=>{const r=p();return(r.modules||(r.modules=new Set)).add("pages/admin/users/index.vue"),_?_(e,t):void 0};export{C as default};
//# sourceMappingURL=index.vue6.mjs.map
