import{d as e,a as t,c as a}from"../../../_/nitro.mjs";import{executeQuery as s}from"../../../_/database.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"@iconify/utils";import"node:crypto";import"consola";import"node:url";import"ipx";import"node:fs";import"node:path";import"mysql2/promise";import"bcryptjs";import"jsonwebtoken";const n=e((async e=>{try{const a=t(e),{menu_name:n}=a;let i=[];try{let e="\n        SELECT \n          n.id, n.menu_name, n.title, n.url, n.page_id, n.parent_id, n.order_index, n.target, n.icon,\n          p.slug as page_slug, p.status as page_status\n        FROM cms_navigation n\n        LEFT JOIN cms_pages p ON n.page_id = p.id\n        WHERE n.is_active = 1\n      ";const t=[];n&&(e+=" AND n.menu_name = ?",t.push(n)),e+=" ORDER BY n.menu_name, n.order_index ASC",i=await s(e,t),i=i.map((e=>"/home"===e.url||"/home/"===e.url?{...e,url:"/"}:e)),i=i.filter((e=>"/services"!==e.url&&"/services/"!==e.url&&"/contact"!==e.url&&"/contact/"!==e.url&&(!e.page_id||"published"===e.page_status)))}catch(e){let t={};try{const e=await import("fs/promises"),a=(await import("path")).join(process.cwd(),"page-statuses.json"),s=await e.readFile(a,"utf-8");t=JSON.parse(s)}catch(e){t={1:"published",2:"published",3:"published",4:"published"}}i=[{id:1,menu_name:"main",title:"الرئيسية",url:"/",page_id:1,order_index:1,target:"_self",page_slug:null,page_status:t[1]||"published"},{id:2,menu_name:"main",title:"الباقات",url:"/packages/",page_id:2,order_index:2,target:"_self",page_slug:"packages",page_status:t[2]||"published"},{id:3,menu_name:"main",title:"صمم باقتك",url:"/custom-package/",page_id:3,order_index:3,target:"_self",page_slug:"custom-package",page_status:t[3]||"published"},{id:4,menu_name:"main",title:"عن الشركة",url:"/about/",page_id:4,order_index:4,target:"_self",page_slug:"about",page_status:t[4]||"published"}].filter((e=>"published"===e.page_status))}const r=new Map,p=[];for(const e of i){const t=e.page_slug?`/${e.page_slug}`:e.url;r.set(e.id,{...e,url:t,children:[]})}for(const e of i)if(e.parent_id){const t=r.get(e.parent_id);t&&t.children.push(r.get(e.id))}else p.push(r.get(e.id));return{success:!0,data:{menus:p.reduce(((e,t)=>(e[t.menu_name]||(e[t.menu_name]=[]),e[t.menu_name].push(t),e)),{})},timestamp:(new Date).toISOString(),cacheBuster:Date.now()}}catch(e){throw console.error("Error fetching public navigation:",e),a({statusCode:500,statusMessage:"Error fetching navigation"})}}));export{n as default};
//# sourceMappingURL=navigation.get.mjs.map
