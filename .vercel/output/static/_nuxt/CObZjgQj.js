import B from"./DpQTdEsJ.js";import{_ as P}from"./Bu0W61Is.js";import{A as T,h as v,B as E,R as S,m as I,c as p,o as m,a as t,b as g,w as U,d as b,i as s,j as C,k as a,v as d,f as k,T as x,F,r as M,t as u,G as L,l as O,J as G}from"./BPMBOJUR.js";import{u as H}from"./Df6Qpn-N.js";const J={class:"space-y-6"},W={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},z={class:"mt-4 sm:mt-0 flex space-x-3 space-x-reverse"},K={key:0,class:"flex justify-center items-center py-12"},Q={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},X={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Y={class:"lg:col-span-2 space-y-6"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},h={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ee=["value"],te={key:0},oe=["value"],se={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-800"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"space-y-4"},ae={class:"space-y-6"},ue={class:"bg-gray-50 rounded-lg p-4"},de={class:"space-y-4"},ie={class:"bg-blue-50 rounded-lg border border-blue-200 p-4"},me={class:"space-y-2 text-sm text-blue-800"},pe={class:"flex justify-between"},be={class:"flex justify-between"},ge={class:"flex justify-between"},fe={class:"flex justify-between"},ye={class:"flex justify-between"},ce={class:"flex justify-between"},ve={class:"flex justify-between"},xe={class:"flex justify-between"},_e={class:"bg-gray-50 rounded-lg p-4"},ke={class:"space-y-3"},we={key:0},Ve={class:"flex justify-end space-x-3 space-x-reverse pt-6 border-t border-gray-200"},Ue=["disabled"],Re={__name:"edit",setup(De){const f=T().params.id,w=v(!0),y=v(!1),_=v([]),r=v(null),o=v({customer_name:"",customer_email:"",customer_phone:"",package_id:"",guests_count:1,departure_date:"",return_date:"",total_amount:0,paid_amount:0,currency:"SAR",payment_method:"",payment_reference:"",booking_status:"pending",payment_status:"pending",special_requests:"",notes:"",booking_number:"",confirmed_at:"",cancellation_reason:""}),q=E(()=>o.value.customer_name&&o.value.customer_email&&o.value.customer_phone&&o.value.package_id&&o.value.departure_date&&o.value.total_amount>0),j=async()=>{try{const n=await $fetch("/api/packages");_.value=(n==null?void 0:n.data)||n||[]}catch(n){console.error("خطأ في تحميل الباقات:",n),_.value=[]}},A=async()=>{try{w.value=!0;const n=await $fetch(`/api/bookings/${f}`),e=(n==null?void 0:n.data)||n;e&&(o.value={customer_name:e.customer_name||"",customer_email:e.customer_email||"",customer_phone:e.customer_phone||"",package_id:e.package_id||"",guests_count:e.guests_count||1,departure_date:e.departure_date||"",return_date:e.return_date||"",total_amount:e.total_amount||0,paid_amount:e.paid_amount||0,currency:e.currency||"SAR",payment_method:e.payment_method||"",payment_reference:e.payment_reference||"",booking_status:e.booking_status||"pending",payment_status:e.payment_status||"pending",special_requests:e.special_requests||"",notes:e.notes||"",booking_number:e.booking_number||"",confirmed_at:e.confirmed_at||"",cancellation_reason:e.cancellation_reason||""},D())}catch(n){console.error("خطأ في تحميل الحجز:",n)}finally{w.value=!1}},D=()=>{if(r.value=_.value.find(n=>n.id==o.value.package_id),r.value&&(o.value.total_amount=r.value.price*o.value.guests_count,o.value.departure_date&&r.value.duration_days)){const n=new Date(o.value.departure_date),e=new Date(n);e.setDate(e.getDate()+r.value.duration_days),o.value.return_date=e.toISOString().split("T")[0]}},N=async()=>{try{y.value=!0;const n={...o.value,departure_date:o.value.departure_date,return_date:o.value.return_date||null,confirmed_at:o.value.confirmed_at||null,package_id:parseInt(o.value.package_id)};Object.keys(n).forEach(i=>{(n[i]===""||n[i]===null)&&delete n[i]});const e=await $fetch(`/api/bookings/${f}`,{method:"PUT",body:n});console.log("تم تحديث الحجز بنجاح:",e),await G(`/admin/bookings/${f}`)}catch(n){console.error("خطأ في تحديث الحجز:",n)}finally{y.value=!1}},c=n=>n?new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR"}).format(n):"0.00 ر.س",R=n=>({confirmed:"مؤكدة",pending:"في الانتظار",cancelled:"ملغية",completed:"مكتملة"})[n]||n,$=n=>({paid:"مدفوع",partial:"مدفوع جزئياً",pending:"في الانتظار",refunded:"مسترد"})[n]||n;return S(()=>o.value.guests_count,()=>{r.value&&(o.value.total_amount=r.value.price*o.value.guests_count)}),S(()=>o.value.departure_date,()=>{var n;if(o.value.departure_date&&((n=r.value)!=null&&n.duration_days)){const e=new Date(o.value.departure_date),i=new Date(e);i.setDate(i.getDate()+r.value.duration_days),o.value.return_date=i.toISOString().split("T")[0]}}),I(async()=>{await Promise.all([j(),A()])}),H({title:"تحرير الحجز - Wonder Land Admin",meta:[{name:"description",content:"تحرير تفاصيل الحجز"},{name:"robots",content:"noindex, nofollow"}]}),(n,e)=>{const i=B,V=P;return m(),p("div",J,[e[69]||(e[69]=t("div",{class:"h-16"},null,-1)),t("div",W,[e[21]||(e[21]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900"},"تحرير الحجز"),t("p",{class:"mt-1 text-sm text-gray-600"},"تعديل تفاصيل الحجز")],-1)),t("div",z,[g(V,{to:`/admin/bookings/${s(f)}`,class:"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"},{default:U(()=>[g(i,{name:"material-symbols:visibility",class:"h-5 w-5 ml-2"}),e[19]||(e[19]=b(" عرض "))]),_:1},8,["to"]),g(V,{to:"/admin/bookings",class:"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"},{default:U(()=>[g(i,{name:"material-symbols:arrow-back",class:"h-5 w-5 ml-2"}),e[20]||(e[20]=b(" العودة "))]),_:1})])]),s(w)?(m(),p("div",K,[g(i,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"}),e[22]||(e[22]=t("span",{class:"mr-3 text-gray-600"},"جارٍ تحميل الحجز...",-1))])):(m(),p("form",{key:1,onSubmit:C(N,["prevent"]),class:"space-y-6"},[t("div",Q,[t("div",X,[t("div",Y,[t("div",null,[e[27]||(e[27]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"معلومات العميل",-1)),t("div",Z,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"اسم العميل *",-1)),a(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s(o).customer_name=l),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"أدخل اسم العميل"},null,512),[[d,s(o).customer_name]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"البريد الإلكتروني *",-1)),a(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s(o).customer_email=l),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"أدخل البريد الإلكتروني"},null,512),[[d,s(o).customer_email]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"رقم الهاتف *",-1)),a(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>s(o).customer_phone=l),type:"tel",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+966501234567"},null,512),[[d,s(o).customer_phone]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"عدد الضيوف *",-1)),a(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>s(o).guests_count=l),type:"number",min:"1",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[d,s(o).guests_count,void 0,{number:!0}]])])])]),t("div",null,[e[38]||(e[38]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"تفاصيل الباقة",-1)),t("div",h,[t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"اختيار الباقة *",-1)),a(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>s(o).package_id=l),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onChange:D},[e[28]||(e[28]=t("option",{value:""},"اختر الباقة",-1)),(m(!0),p(F,null,M(s(_),l=>(m(),p("option",{key:l.id,value:l.id},u(l.title_ar||l.title_en||l.title)+" - "+u(c(l.price)),9,ee))),128))],544),[[x,s(o).package_id]])]),s(r)?(m(),p("div",te,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"مدة الرحلة",-1)),t("input",{value:s(r).duration_days+" أيام",type:"text",readonly:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"},null,8,oe)])):k("",!0),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"تاريخ المغادرة *",-1)),a(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>s(o).departure_date=l),type:"date",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[d,s(o).departure_date]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"تاريخ العودة",-1)),a(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s(o).return_date=l),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[d,s(o).return_date]])])]),s(r)?(m(),p("div",se,[e[37]||(e[37]=t("h3",{class:"text-sm font-medium text-blue-900 mb-2"},"تفاصيل الباقة المختارة",-1)),t("div",le,[t("div",null,[e[33]||(e[33]=t("span",{class:"font-medium"},"العنوان:",-1)),b(" "+u(s(r).title_ar||s(r).title_en||s(r).title),1)]),t("div",null,[e[34]||(e[34]=t("span",{class:"font-medium"},"السعر:",-1)),b(" "+u(c(s(r).price)),1)]),t("div",null,[e[35]||(e[35]=t("span",{class:"font-medium"},"المدة:",-1)),b(" "+u(s(r).duration_days)+" أيام ",1)]),t("div",null,[e[36]||(e[36]=t("span",{class:"font-medium"},"الوجهة:",-1)),b(" "+u(s(r).location||s(r).travel_period),1)])])])):k("",!0)]),t("div",null,[e[46]||(e[46]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"تفاصيل الدفع",-1)),t("div",ne,[t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"المبلغ الإجمالي *",-1)),a(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s(o).total_amount=l),type:"number",min:"0",step:"0.01",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"},null,512),[[d,s(o).total_amount,void 0,{number:!0}]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"المبلغ المدفوع",-1)),a(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s(o).paid_amount=l),type:"number",min:"0",step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"},null,512),[[d,s(o).paid_amount,void 0,{number:!0}]])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"العملة",-1)),a(t("select",{"onUpdate:modelValue":e[9]||(e[9]=l=>s(o).currency=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[41]||(e[41]=[t("option",{value:"SAR"},"ريال سعودي (SAR)",-1),t("option",{value:"USD"},"دولار أمريكي (USD)",-1),t("option",{value:"EUR"},"يورو (EUR)",-1),t("option",{value:"AED"},"درهم إماراتي (AED)",-1)]),512),[[x,s(o).currency]])]),t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"طريقة الدفع",-1)),a(t("select",{"onUpdate:modelValue":e[10]||(e[10]=l=>s(o).payment_method=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[43]||(e[43]=[L('<option value="">اختر طريقة الدفع</option><option value="cash">نقداً</option><option value="bank_transfer">تحويل بنكي</option><option value="credit_card">بطاقة ائتمان</option><option value="online">دفع إلكتروني</option>',5)]),512),[[x,s(o).payment_method]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"مرجع الدفع",-1)),a(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>s(o).payment_reference=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"رقم المرجع أو المعاملة"},null,512),[[d,s(o).payment_reference]])])])]),t("div",null,[e[49]||(e[49]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"طلبات خاصة وملاحظات",-1)),t("div",re,[t("div",null,[e[47]||(e[47]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"طلبات خاصة",-1)),a(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=l=>s(o).special_requests=l),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"أي طلبات خاصة من العميل"},null,512),[[d,s(o).special_requests]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ملاحظات إدارية",-1)),a(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=l=>s(o).notes=l),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ملاحظات إدارية أو تفاصيل إضافية"},null,512),[[d,s(o).notes]])])])])]),t("div",ae,[t("div",ue,[e[54]||(e[54]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"حالة الحجز",-1)),t("div",de,[t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"حالة الحجز *",-1)),a(t("select",{"onUpdate:modelValue":e[14]||(e[14]=l=>s(o).booking_status=l),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[50]||(e[50]=[t("option",{value:"pending"},"في الانتظار",-1),t("option",{value:"confirmed"},"مؤكدة",-1),t("option",{value:"cancelled"},"ملغية",-1),t("option",{value:"completed"},"مكتملة",-1)]),512),[[x,s(o).booking_status]])]),t("div",null,[e[53]||(e[53]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"حالة الدفع *",-1)),a(t("select",{"onUpdate:modelValue":e[15]||(e[15]=l=>s(o).payment_status=l),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[52]||(e[52]=[t("option",{value:"pending"},"في الانتظار",-1),t("option",{value:"partial"},"مدفوع جزئياً",-1),t("option",{value:"paid"},"مدفوع بالكامل",-1),t("option",{value:"refunded"},"مسترد",-1)]),512),[[x,s(o).payment_status]])])])]),t("div",ie,[e[63]||(e[63]=t("h3",{class:"text-lg font-semibold text-blue-900 mb-3"},"ملخص الحجز",-1)),t("div",me,[t("div",pe,[e[55]||(e[55]=t("span",null,"العميل:",-1)),t("span",null,u(s(o).customer_name||"غير محدد"),1)]),t("div",be,[e[56]||(e[56]=t("span",null,"عدد الضيوف:",-1)),t("span",null,u(s(o).guests_count||0),1)]),t("div",ge,[e[57]||(e[57]=t("span",null,"تاريخ المغادرة:",-1)),t("span",null,u(s(o).departure_date||"غير محدد"),1)]),t("div",fe,[e[58]||(e[58]=t("span",null,"المبلغ الإجمالي:",-1)),t("span",null,u(c(s(o).total_amount)),1)]),t("div",ye,[e[59]||(e[59]=t("span",null,"المبلغ المدفوع:",-1)),t("span",null,u(c(s(o).paid_amount)),1)]),t("div",ce,[e[60]||(e[60]=t("span",null,"المتبقي:",-1)),t("span",null,u(c(s(o).total_amount-s(o).paid_amount)),1)]),t("div",ve,[e[61]||(e[61]=t("span",null,"حالة الحجز:",-1)),t("span",null,u(R(s(o).booking_status)),1)]),t("div",xe,[e[62]||(e[62]=t("span",null,"حالة الدفع:",-1)),t("span",null,u($(s(o).payment_status)),1)])])]),t("div",_e,[e[67]||(e[67]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"معلومات إضافية",-1)),t("div",ke,[t("div",null,[e[64]||(e[64]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"رقم الحجز",-1)),a(t("input",{"onUpdate:modelValue":e[16]||(e[16]=l=>s(o).booking_number=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"رقم الحجز"},null,512),[[d,s(o).booking_number]])]),t("div",null,[e[65]||(e[65]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"تاريخ التأكيد",-1)),a(t("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>s(o).confirmed_at=l),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[d,s(o).confirmed_at]])]),s(o).booking_status==="cancelled"?(m(),p("div",we,[e[66]||(e[66]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"سبب الإلغاء",-1)),a(t("textarea",{"onUpdate:modelValue":e[18]||(e[18]=l=>s(o).cancellation_reason=l),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"سبب إلغاء الحجز"},null,512),[[d,s(o).cancellation_reason]])])):k("",!0)])])])]),t("div",Ve,[g(V,{to:`/admin/bookings/${s(f)}`,class:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"},{default:U(()=>e[68]||(e[68]=[b(" إلغاء ")])),_:1},8,["to"]),t("button",{type:"submit",disabled:s(y)||!s(q),class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50"},[s(y)?(m(),O(i,{key:0,name:"material-symbols:progress-activity",class:"animate-spin h-4 w-4 ml-2 inline"})):k("",!0),b(" "+u(s(y)?"جاري الحفظ...":"حفظ التغييرات"),1)],8,Ue)])])],32))])}}};export{Re as default};
