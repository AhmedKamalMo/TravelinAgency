import z from"./CjUD-tqt.js";import{_ as O}from"./TxntYzv-.js";import{_ as Q}from"./9nbd2Z0u.js";import{_ as G}from"./Bwk0c3Z5.js";import{h as C,B as N,S as A,P as J,l as K,c as S,o as D,a as t,b as d,f as X,d as F,u as l,j as M,v as Z,Y as P,R as W,F as I,r as ee,t as y,H as q,e as te}from"./DHjegAIK.js";import{u as se}from"./NS4odysN.js";import{u as re}from"./DOtPdQ7M.js";const oe=()=>{const c=C([]),x=C(null),p=C(!1),h=C(null),U=async s=>{try{p.value=!0,h.value=null;const r=new URLSearchParams;s!=null&&s.page&&r.append("page",s.page.toString()),s!=null&&s.limit&&r.append("limit",s.limit.toString()),s!=null&&s.search&&r.append("search",s.search),s!=null&&s.status&&r.append("status",s.status),s!=null&&s.role&&r.append("role",s.role);const i=await $fetch(`/api/admin/users?${r.toString()}`);if(i.success&&i.data)return c.value=i.data.users,i.data;throw new Error(i.error||"Failed to fetch users")}catch(r){throw console.error("Error fetching users:",r),h.value=r.message||"Failed to fetch users",c.value=[],r}finally{p.value=!1}},R=async s=>{try{p.value=!0,h.value=null;const r=await $fetch(`/api/admin/users/${s}`);if(r.success&&r.data)return x.value=r.data,r.data;throw new Error(r.error||"Failed to fetch user")}catch(r){throw console.error("Error fetching user:",r),h.value=r.message||"Failed to fetch user",x.value=null,r}finally{p.value=!1}},V=async s=>{try{p.value=!0,h.value=null;const r=await $fetch("/api/admin/users",{method:"POST",body:s});if(r.success&&r.data)return c.value.unshift(r.data),r.data;throw new Error(r.error||"Failed to create user")}catch(r){throw console.error("Error creating user:",r),h.value=r.message||"Failed to create user",r}finally{p.value=!1}},L=async(s,r)=>{var i;try{p.value=!0,h.value=null;const o=await $fetch(`/api/admin/users/${s}`,{method:"PUT",body:r});if(o.success&&o.data){const e=c.value.findIndex(n=>n.id.toString()===s.toString());return e!==-1&&(c.value[e]=o.data),((i=x.value)==null?void 0:i.id.toString())===s.toString()&&(x.value=o.data),o.data}else throw new Error(o.error||"Failed to update user")}catch(o){throw console.error("Error updating user:",o),h.value=o.message||"Failed to update user",o}finally{p.value=!1}},j=async s=>{var r;try{p.value=!0,h.value=null;const i=await $fetch(`/api/admin/users/${s}`,{method:"DELETE"});if(i.success)return c.value=c.value.filter(o=>o.id.toString()!==s.toString()),((r=x.value)==null?void 0:r.id.toString())===s.toString()&&(x.value=null),!0;throw new Error(i.error||"Failed to delete user")}catch(i){throw console.error("Error deleting user:",i),h.value=i.message||"Failed to delete user",i}finally{p.value=!1}},B=async(s,r)=>{try{return await L(s,{status:r})}catch(i){throw console.error("Error toggling user status:",i),i}},H=async(s,r)=>{try{return await L(s,{role:r})}catch(i){throw console.error("Error changing user role:",i),i}},Y=async s=>{try{return await U({search:s})}catch(r){throw console.error("Error searching users:",r),r}},u=async s=>{try{return await U(s)}catch(r){throw console.error("Error filtering users:",r),r}},w=N(()=>{const s=c.value.length,r=c.value.filter(f=>f.status==="active").length,i=c.value.filter(f=>f.status==="inactive").length,o=c.value.filter(f=>f.status==="suspended").length,e=new Date;e.setHours(0,0,0,0);const n=c.value.filter(f=>new Date(f.created_at)>=e).length,g=new Date(e.getTime()-7*24*60*60*1e3),v=c.value.filter(f=>new Date(f.created_at)>=g).length,k=new Date(e.getTime()-30*24*60*60*1e3),a=c.value.filter(f=>new Date(f.created_at)>=k).length;return{total:s,active:r,inactive:i,suspended:o,newToday:n,newThisWeek:v,newThisMonth:a}}),b=s=>({admin:"مدير",moderator:"مشرف",user:"مستخدم"})[s]||s,_=s=>({admin:"bg-red-100 text-red-800",moderator:"bg-blue-100 text-blue-800",user:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",m=s=>({active:"نشط",inactive:"غير نشط",suspended:"معلق"})[s]||s,T=s=>({active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-800",suspended:"bg-orange-100 text-orange-800"})[s]||"bg-gray-100 text-gray-800",E=s=>new Date(s).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return{users:A(c),currentUser:A(x),isLoading:A(p),error:A(h),userStats:w,fetchUsers:U,fetchUser:R,createUser:V,updateUser:L,deleteUser:j,toggleUserStatus:B,changeUserRole:H,searchUsers:Y,filterUsers:u,getRoleName:b,getRoleColor:_,getStatusName:m,getStatusColor:T,formatDate:E}},ae={class:"space-y-6"},ne={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},le={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ie={class:"relative"},de={class:"bg-white rounded-lg shadow-sm border border-gray-200"},ce={key:0,class:"flex justify-center items-center py-12"},ue={key:1,class:"overflow-x-auto"},ge={class:"min-w-full divide-y divide-gray-200"},me={class:"bg-white divide-y divide-gray-200"},pe={class:"px-6 py-4 whitespace-nowrap"},he={class:"flex items-center"},ve={class:"flex-shrink-0 h-10 w-10"},fe={class:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center"},xe={class:"mr-4"},ye={class:"text-sm font-medium text-gray-900"},we={class:"text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap"},_e={class:"text-sm text-gray-900"},Ce={class:"text-sm text-gray-500"},ke={class:"px-6 py-4 whitespace-nowrap"},Se={class:"px-6 py-4 whitespace-nowrap"},De={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ue={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Le={class:"flex items-center space-x-2 space-x-reverse"},Ee=["onClick","title"],Fe=["onClick"],$e={key:2,class:"text-center py-12"},Te={key:0,class:"flex items-center justify-between"},Ae={class:"text-sm text-gray-700"},Me={class:"flex space-x-1 space-x-reverse"},Pe=["disabled"],Ne={class:"px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md"},Re=["disabled"],$=10,ze={__name:"index",setup(c){const{users:x,isLoading:p,userStats:h,fetchUsers:U,deleteUser:R,toggleUserStatus:V,getRoleName:L,getRoleColor:j,getStatusName:B,getStatusColor:H,formatDate:Y}=oe(),u=C(""),w=C(""),b=C(""),_=C(""),m=C(1),T=N(()=>{let o=x.value;if(u.value&&(o=o.filter(e=>{var n,g,v;return((n=e.full_name)==null?void 0:n.toLowerCase().includes(u.value.toLowerCase()))||((g=e.name)==null?void 0:g.toLowerCase().includes(u.value.toLowerCase()))||e.email.toLowerCase().includes(u.value.toLowerCase())||((v=e.phone)==null?void 0:v.toLowerCase().includes(u.value.toLowerCase()))})),w.value&&(o=o.filter(e=>e.status===w.value)),b.value&&(o=o.filter(e=>e.role===b.value)),_.value){const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),g=new Date(n.getTime()-7*24*60*60*1e3),v=new Date(n.getTime()-30*24*60*60*1e3);o=o.filter(k=>{const a=new Date(k.created_at);switch(_.value){case"today":return a>=n;case"week":return a>=g;case"month":return a>=v;default:return!0}})}return o.slice((m.value-1)*$,m.value*$)}),E=N(()=>{let o=x.value;if(u.value&&(o=o.filter(e=>{var n,g,v;return((n=e.full_name)==null?void 0:n.toLowerCase().includes(u.value.toLowerCase()))||((g=e.name)==null?void 0:g.toLowerCase().includes(u.value.toLowerCase()))||e.email.toLowerCase().includes(u.value.toLowerCase())||((v=e.phone)==null?void 0:v.toLowerCase().includes(u.value.toLowerCase()))})),w.value&&(o=o.filter(e=>e.status===w.value)),b.value&&(o=o.filter(e=>e.role===b.value)),_.value){const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),g=new Date(n.getTime()-7*24*60*60*1e3),v=new Date(n.getTime()-30*24*60*60*1e3);o=o.filter(k=>{const a=new Date(k.created_at);switch(_.value){case"today":return a>=n;case"week":return a>=g;case"month":return a>=v;default:return!0}})}return o.length}),s=N(()=>Math.ceil(E.value/$)),r=async()=>{try{await U()}catch(o){console.error("خطأ في تحميل المستخدمين:",o)}},i=()=>{try{const{exportUsersToExcel:o}=se();o(x.value)?console.log("تم تصدير المستخدمين بنجاح"):console.error("فشل في تصدير المستخدمين")}catch(o){console.error("خطأ في تصدير المستخدمين:",o)}};return J([u,w,b,_],()=>{m.value=1}),K(()=>{r()}),re({title:"إدارة المستخدمين - Wonder Land Admin",meta:[{name:"description",content:"إدارة وتحرير المستخدمين المسجلين"},{name:"robots",content:"noindex, nofollow"}]}),(o,e)=>{const n=z,g=O,v=Q,k=G;return D(),S("div",ae,[e[18]||(e[18]=t("div",{class:"h-16"},null,-1)),d(v,{title:"إدارة المستخدمين",description:"إدارة وتحرير المستخدمين المسجلين"},{actions:F(()=>[t("button",{onClick:i,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[d(n,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),e[6]||(e[6]=t("span",{class:"hidden sm:inline"},"تصدير البيانات",-1)),e[7]||(e[7]=t("span",{class:"sm:hidden"},"تصدير",-1))]),d(g,{to:"/admin/users/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:F(()=>[d(n,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),e[8]||(e[8]=t("span",{class:"hidden sm:inline"},"إضافة مستخدم جديد",-1)),e[9]||(e[9]=t("span",{class:"sm:hidden"},"إضافة",-1))]),_:1})]),_:1}),d(k,{stats:l(h)},null,8,["stats"]),t("div",ne,[t("div",le,[t("div",ie,[d(n,{name:"material-symbols:search",class:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),M(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>P(u)?u.value=a:null),type:"text",placeholder:"البحث في المستخدمين...",class:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[Z,l(u)]])]),M(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>P(w)?w.value=a:null),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[10]||(e[10]=[t("option",{value:""},"جميع الحالات",-1),t("option",{value:"active"},"نشط",-1),t("option",{value:"inactive"},"غير نشط",-1),t("option",{value:"suspended"},"معلق",-1)]),512),[[W,l(w)]]),M(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>P(b)?b.value=a:null),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[11]||(e[11]=[t("option",{value:""},"جميع الأدوار",-1),t("option",{value:"admin"},"مدير",-1),t("option",{value:"moderator"},"مشرف",-1),t("option",{value:"user"},"مستخدم",-1)]),512),[[W,l(b)]]),M(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>P(_)?_.value=a:null),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[12]||(e[12]=[t("option",{value:""},"جميع التواريخ",-1),t("option",{value:"today"},"اليوم",-1),t("option",{value:"week"},"هذا الأسبوع",-1),t("option",{value:"month"},"هذا الشهر",-1)]),512),[[W,l(_)]])])]),t("div",de,[l(p)?(D(),S("div",ce,[d(n,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"}),e[13]||(e[13]=t("span",{class:"mr-3 text-gray-600"},"جارٍ تحميل المستخدمين...",-1))])):l(T).length>0?(D(),S("div",ue,[t("table",ge,[e[14]||(e[14]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," المستخدم "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," البريد الإلكتروني "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الدور "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الحالة "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," تاريخ التسجيل "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الإجراءات ")])],-1)),t("tbody",me,[(D(!0),S(I,null,ee(l(T),a=>(D(),S("tr",{key:a.id,class:"hover:bg-gray-50"},[t("td",pe,[t("div",he,[t("div",ve,[t("div",fe,[d(n,{name:"material-symbols:person",class:"h-6 w-6 text-gray-600"})])]),t("div",xe,[t("div",ye,y(a.full_name||a.name||"غير محدد"),1),t("div",we,y(a.phone||"لا يوجد رقم هاتف"),1)])])]),t("td",be,[t("div",_e,y(a.email),1),t("div",Ce,y(a.email_verified?"مؤكد":"غير مؤكد"),1)]),t("td",ke,[t("span",{class:q([l(j)(a.role),"px-2 py-1 text-xs font-medium rounded-full"])},y(l(L)(a.role)),3)]),t("td",Se,[t("span",{class:q([l(H)(a.status),"px-2 py-1 text-xs font-medium rounded-full"])},y(l(B)(a.status)),3)]),t("td",De,y(l(Y)(a.created_at)),1),t("td",Ue,[t("div",Le,[d(g,{to:`/admin/users/${a.id}`,class:"text-blue-600 hover:text-blue-900 p-1 rounded",title:"عرض"},{default:F(()=>[d(n,{name:"material-symbols:visibility",class:"h-4 w-4"})]),_:2},1032,["to"]),d(g,{to:`/admin/users/${a.id}/edit`,class:"text-green-600 hover:text-green-900 p-1 rounded",title:"تحرير"},{default:F(()=>[d(n,{name:"material-symbols:edit",class:"h-4 w-4"})]),_:2},1032,["to"]),t("button",{onClick:f=>l(V)(a),class:q([a.status==="active"?"text-orange-600 hover:text-orange-900":"text-green-600 hover:text-green-900","p-1 rounded"]),title:a.status==="active"?"إلغاء التفعيل":"تفعيل"},[d(n,{name:a.status==="active"?"material-symbols:pause":"material-symbols:play-arrow",class:"h-4 w-4"},null,8,["name"])],10,Ee),t("button",{onClick:f=>l(R)(a),class:"text-red-600 hover:text-red-900 p-1 rounded",title:"حذف"},[d(n,{name:"material-symbols:delete",class:"h-4 w-4"})],8,Fe)])])]))),128))])])])):(D(),S("div",$e,[d(n,{name:"material-symbols:people",class:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e[16]||(e[16]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"لا يوجد مستخدمون",-1)),e[17]||(e[17]=t("p",{class:"text-gray-500 mb-6"},"لم يتم العثور على أي مستخدمين",-1)),d(g,{to:"/admin/users/create",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},{default:F(()=>[d(n,{name:"material-symbols:add",class:"h-5 w-5 ml-2"}),e[15]||(e[15]=te(" إضافة مستخدم جديد "))]),_:1})]))]),l(s)>1?(D(),S("div",Te,[t("div",Ae," عرض "+y((l(m)-1)*$+1)+" إلى "+y(Math.min(l(m)*$,l(E)))+" من أصل "+y(l(E))+" مستخدم ",1),t("div",Me,[t("button",{onClick:e[4]||(e[4]=a=>m.value=Math.max(1,l(m)-1)),disabled:l(m)===1,class:"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," السابق ",8,Pe),t("span",Ne,y(l(m)),1),t("button",{onClick:e[5]||(e[5]=a=>m.value=Math.min(l(s),l(m)+1)),disabled:l(m)===l(s),class:"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," التالي ",8,Re)])])):X("",!0)])}}};export{ze as default};
