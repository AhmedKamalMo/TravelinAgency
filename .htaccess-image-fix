# Image serving fix for GoDaddy - redirect _ipx requests to actual images
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Force HTTPS redirect
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # Handle _ipx image processing requests - redirect to actual images
    # This fixes the 503 errors on image requests
    RewriteCond %{REQUEST_URI} ^/_ipx/.*?/images/(.*)$
    RewriteRule ^/_ipx/.*?/images/(.*)$ /images/$1 [L]

    # Handle static files (CSS, JS, images, etc.) directly from output/public/_nuxt/
    RewriteCond %{REQUEST_URI} ^/output/public/_nuxt/ [NC]
    RewriteRule ^ - [L]

    # Handle static files (CSS, JS, images, etc.) directly from public/
    RewriteCond %{REQUEST_URI} ^/public/ [NC]
    RewriteRule ^ - [L]

    # Handle other static files directly
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^ - [L]

    # Handle API routes
    RewriteCond %{REQUEST_URI} ^/api/ [NC]
    RewriteRule ^(.*)$ api-handler.php [QSA,L]

    # Handle Nuxt.js client-side routing (serve index.php for all other requests)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php [QSA,L]
</IfModule>

# Set default handler for PHP files
<FilesMatch "\.php$">
    SetHandler "application/x-httpd-php"
</FilesMatch>

# Enable Gzip compression for common file types
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css application/xml application/xhtml+xml application/rss+xml application/javascript application/x-javascript
</IfModule>

# Set Expires headers for static assets (adjust as needed)
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access 1 year"
    ExpiresByType image/jpeg "access 1 year"
    ExpiresByType image/gif "access 1 year"
    ExpiresByType image/png "access 1 year"
    ExpiresByType image/webp "access 1 year"
    ExpiresByType text/css "access 1 month"
    ExpiresByType application/pdf "access 1 month"
    ExpiresByType application/javascript "access 1 month"
    ExpiresByType application/x-javascript "access 1 month"
    ExpiresByType application/x-shockwave-flash "access 1 month"
    ExpiresByType image/x-icon "access 1 year"
    ExpiresDefault "access 2 days"
</IfModule>
