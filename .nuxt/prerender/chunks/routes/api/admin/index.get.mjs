import{defineEventHandler as e,getQuery as t}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{createConnection as a}from"file://F:/TravelinAgency/node_modules/mysql2/promise.js";const r=e((async e=>{try{const r=t(e),o=parseInt(r.page)||1,s=parseInt(r.limit)||10,n=r.search||"",i=r.status||"",l=r.role||"",d=await a({host:"localhost",user:"root",password:"",database:"wonderland_travel"}),[c]=await d.execute("\n      SELECT * FROM users \n      ORDER BY created_at DESC\n    ");await d.end();let u=c.map((e=>{let t="user";return"admin@wonderland.com"===e.email?t="admin":"moderator@wonderland.com"===e.email&&(t="moderator"),{id:e.id,email:e.email,full_name:e.full_name||e.name,phone:e.phone,role:t,status:e.status||"active",email_verified:e.email_verified||!1,phone_verified:e.phone_verified||!1,bio:e.bio,date_of_birth:e.date_of_birth,gender:e.gender,nationality:e.nationality,address:e.address,city:e.city,country:e.country,postal_code:e.postal_code,preferences:e.preferences?JSON.parse(e.preferences):{},created_at:e.created_at,updated_at:e.updated_at,last_login:e.last_login,login_count:e.login_count||0}}));n&&(u=u.filter((e=>{var t,a;return(null==(t=e.full_name)?void 0:t.toLowerCase().includes(n.toLowerCase()))||e.email.toLowerCase().includes(n.toLowerCase())||(null==(a=e.phone)?void 0:a.toLowerCase().includes(n.toLowerCase()))}))),i&&(u=u.filter((e=>e.status===i))),l&&(u=u.filter((e=>e.role===l)));const m=(o-1)*s,_=m+s;return{success:!0,data:{users:u.slice(m,_),total:u.length,page:o,limit:s}}}catch(e){return console.error("Error fetching users:",e),{success:!1,error:e.message||"فشل في جلب المستخدمين"}}}));export{r as default};
//# sourceMappingURL=index.get.mjs.map
