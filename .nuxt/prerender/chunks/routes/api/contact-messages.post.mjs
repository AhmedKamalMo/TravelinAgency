import{defineEventHandler as e,readBody as s,createError as i}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{e as n}from"../../_/database.mjs";import"../../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/mysql2/promise.js";import"file://F:/TravelinAgency/node_modules/bcryptjs/index.js";import"file://F:/TravelinAgency/node_modules/jsonwebtoken/index.js";const t=e((async e=>{try{const t=await s(e),{name:o,email:d,phone:a,subject:l,message:r,type:m="general",source:c="website",related_package_id:u=null,related_destination_id:g=null}=t;if(!o||!r)throw i({statusCode:400,statusMessage:"Name and message are required"});console.log("Inserting contact message with data:",{name:o,email:d||null,phone:a||null,subject:l||"استفسار عام",message:r,type:m,source:c,related_package_id:u,related_destination_id:g});const p=await n("\n      INSERT INTO contact_messages (\n        name, email, phone, subject, message, type, status, source,\n        related_package_id, related_destination_id, ip_address, user_agent, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())\n    ",[o,d||null,a||null,l||"استفسار عام",r,m,"new",c,u,g,"127.0.0.1","Test User Agent"]);if(console.log("Database result:",p),!p||0===p.affectedRows)throw console.error("Database insert failed:",p),i({statusCode:500,statusMessage:"Failed to save contact message"});return{success:!0,message:"Contact message submitted successfully",id:p.affectedRows>0?"success":null}}catch(e){if(console.error("Error creating contact message:",e),e.statusCode)throw e;throw i({statusCode:500,statusMessage:"Failed to process contact message"})}}));export{t as default};
//# sourceMappingURL=contact-messages.post.mjs.map
