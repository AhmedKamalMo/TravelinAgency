import{defineEventHandler as e,readBody as i,createError as s,setCookie as o}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{a as n,g as r}from"../../../_/database.mjs";import"../../../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/mysql2/promise.js";import"file://F:/TravelinAgency/node_modules/bcryptjs/index.js";import"file://F:/TravelinAgency/node_modules/jsonwebtoken/index.js";const t=e((async e=>{try{const t=await i(e),{email:d,password:l}=t;if(!d||!l)throw s({statusCode:400,statusMessage:"Email and password are required"});const m=await n(d,l);if(!m)throw s({statusCode:401,statusMessage:"Invalid login credentials"});const{user:a}=m;if(!a.role||!["admin","super_admin","moderator"].includes(a.role))throw s({statusCode:403,statusMessage:"ليس لديك صلاحيات للوصول إلى لوحة التحكم"});const u={userId:a.id,email:a.email,role:a.role},c=r(u,"7d");o(e,"auth-token",c,{httpOnly:!0,secure:!1,sameSite:"lax",maxAge:604800,path:"/"}),console.log("✅ Admin login successful:",{userId:a.id,email:a.email,role:a.role,timestamp:(new Date).toISOString()});return{success:!0,data:{user:{id:a.id,email:a.email,full_name:a.full_name,phone:a.phone,role:a.role,permissions:a.permissions,status:a.status},token:c}}}catch(e){if(console.error("Login API error:",e),e.statusCode)throw e;throw s({statusCode:500,statusMessage:"Internal server error during login"})}}));export{t as default};
//# sourceMappingURL=login.post.mjs.map
