import{defineEventHandler as e,getRouterParam as i,readBody as t,createError as a}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{executeQuery as n}from"../../../_/database.mjs";import"../../../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/mysql2/promise.js";import"file://F:/TravelinAgency/node_modules/bcryptjs/index.js";import"file://F:/TravelinAgency/node_modules/jsonwebtoken/index.js";const d=e((async e=>{try{const d=i(e,"id"),o=await t(e);if(!d)throw a({statusCode:400,statusMessage:"Package ID is required"});console.log(`Package ${d} update requested:`,o);try{if(0===(await n("\n        UPDATE packages SET\n          title_ar = ?,\n          title_en = ?,\n          description_ar = ?,\n          description_en = ?,\n          price = ?,\n          duration_days = ?,\n          travel_period = ?,\n          max_persons = ?,\n          image_url = ?,\n          featured = ?,\n          active = ?,\n          updated_at = CURRENT_TIMESTAMP\n        WHERE numeric_id = ? OR id = ?\n      ",[o.title_ar||o.title,o.title_en||o.title,o.description_ar||o.description,o.description_en||o.description,o.price||0,o.duration_days||7,o.travel_period||o.location||"",o.max_persons||10,o.image_url||"",o.featured?1:0,"active"===o.status?1:0,d,d])).affectedRows)throw new Error("Package not found in database");const e=await n("\n        SELECT \n          id, \n          title_ar,\n          title_en,\n          description_ar,\n          description_en,\n          price,\n          duration_days as duration,\n          image_url as image,\n          travel_period as location,\n          max_persons,\n          featured,\n          active as status,\n          created_at,\n          updated_at\n        FROM packages \n        WHERE numeric_id = ? OR id = ?\n      ",[d,d]);if(!e||0===e.length)throw new Error("Failed to retrieve updated package");const i=e[0];return{success:!0,message:"Package updated successfully in database",package:{id:i.id,title:i.title_ar||i.title_en,title_ar:i.title_ar,title_en:i.title_en,description:i.description_ar||i.description_en,description_ar:i.description_ar,description_en:i.description_en,price:i.price,duration:`${i.duration} days`,duration_days:i.duration,image:i.image,image_url:i.image,destination:i.location,location:i.location,travel_period:i.location,max_persons:i.max_persons||10,category:"international",featured:i.featured,status:1===i.status?"active":"inactive",features:[],itinerary:[],included:[],excluded:[],created_at:i.created_at,updated_at:i.updated_at}}}catch(e){console.log("Database update failed:",e);try{const e=await import("node:fs"),i=(await import("node:path")).join(process.cwd(),"public","packages-with-local-images.json"),t=e.readFileSync(i,"utf8"),a=JSON.parse(t),n=a.find((e=>e.id===parseInt(d)));if(n){const t={...n,title:o.title_ar||o.title||n.title,description:o.description_ar||o.description||n.description,price:o.price||n.price,duration:o.duration||n.duration,destination:o.travel_period||o.location||n.destination,featured:void 0!==o.featured?o.featured:n.featured,status:o.status||n.status,updated_at:(new Date).toISOString()},r=a.findIndex((e=>e.id===parseInt(d)));return-1!==r&&(a[r]=t,e.writeFileSync(i,JSON.stringify(a,null,2))),{success:!0,message:"Package updated successfully in local data (database unavailable)",package:{id:t.id,title:t.title,title_ar:t.title,title_en:t.title,description:t.description,description_ar:t.description,description_en:t.description,price:t.price,duration:t.duration,duration_days:7,image:t.image,image_url:t.image,destination:t.destination,location:t.destination,travel_period:t.destination,max_persons:10,category:"international",featured:t.featured,status:t.status,features:[],itinerary:[],included:[],excluded:[],created_at:t.created_at,updated_at:t.updated_at}}}}catch(e){console.log("Local package update also failed:",e)}throw a({statusCode:500,statusMessage:"Failed to update package in both database and local storage"})}}catch(e){if(console.error("Error updating package:",e),e.statusCode)throw e;throw a({statusCode:500,statusMessage:"Failed to update package"})}}));export{d as default};
//# sourceMappingURL=_id_.put.mjs.map
