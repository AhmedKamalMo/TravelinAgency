import{defineEventHandler as e,getRouterParam as s,readBody as i,createError as t}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{executeQuery as o}from"../../../../_/database.mjs";import"../../../../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/mysql2/promise.js";import"file://F:/TravelinAgency/node_modules/bcryptjs/index.js";import"file://F:/TravelinAgency/node_modules/jsonwebtoken/index.js";const d=e((async e=>{try{const d=s(e,"id"),n=await i(e);if(!d)throw t({statusCode:400,statusMessage:"Page ID is required"});const{slug:a,title:l,meta_title:r,meta_description:m,meta_keywords:u,status:p,template:c,updated_by:g=1}=n;if(0===(await o("SELECT id FROM cms_pages WHERE id = ?",[d])).length)throw t({statusCode:404,statusMessage:"Page not found"});if(a){if((await o("SELECT id FROM cms_pages WHERE slug = ? AND id != ?",[a,d])).length>0)throw t({statusCode:400,statusMessage:"Page with this slug already exists"})}const f=[],_=[];void 0!==a&&(f.push("slug = ?"),_.push(a)),void 0!==l&&(f.push("title = ?"),_.push(l)),void 0!==r&&(f.push("meta_title = ?"),_.push(r)),void 0!==m&&(f.push("meta_description = ?"),_.push(m)),void 0!==u&&(f.push("meta_keywords = ?"),_.push(u)),void 0!==p&&(f.push("status = ?"),_.push(p)),void 0!==c&&(f.push("template = ?"),_.push(c)),f.push("updated_by = ?"),_.push(g),_.push(d);const h=`UPDATE cms_pages SET ${f.join(", ")} WHERE id = ?`;await o(h,_);return{success:!0,data:{page:(await o("SELECT * FROM cms_pages WHERE id = ?",[d]))[0]},message:"Page updated successfully"}}catch(e){if(console.error("Error updating page:",e),e.statusCode)throw e;throw t({statusCode:500,statusMessage:"Error updating page"})}}));export{d as default};
//# sourceMappingURL=_id_.put.mjs.map
