import{defineEventHandler as e,getRouterParam as i,readBody as n,createError as o}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{e as t}from"../../../../_/database.mjs";import"../../../../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/mysql2/promise.js";import"file://F:/TravelinAgency/node_modules/bcryptjs/index.js";import"file://F:/TravelinAgency/node_modules/jsonwebtoken/index.js";const s=e((async e=>{var s,d,r,l,a,m;const p=i(e,"id"),c=await n(e);if(!p)throw o({statusCode:400,statusMessage:"Page ID is required"});try{if(await t("\n      UPDATE cms_pages SET\n        title = ?,\n        meta_title = ?,\n        meta_description = ?,\n        status = ?,\n        template = ?,\n        updated_at = CURRENT_TIMESTAMP\n      WHERE id = ?\n    ",[c.title_ar||c.title||"",c.title_en||c.meta_title||"",c.meta_description_ar||c.meta_description||"",c.status||"draft",c.template||"default",p]),await t("DELETE FROM cms_sections WHERE page_id = ?",[p]),c.components&&Array.isArray(c.components))for(let e=0;e<c.components.length;e++){const i=c.components[e];await t("\n          INSERT INTO cms_sections (\n            page_id, section_type, title, subtitle, content,\n            background_color, background_image, text_color, order_index, is_active, settings\n          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n        ",[p,i.type||"generic",(null==(s=i.props)?void 0:s.title)||"",(null==(d=i.props)?void 0:d.subtitle)||"",(null==(r=i.props)?void 0:r.content)||"",(null==(l=i.props)?void 0:l.backgroundColor)||"",(null==(a=i.props)?void 0:a.backgroundImage)||"",(null==(m=i.props)?void 0:m.textColor)||"",e,!0,JSON.stringify(i.props||{})])}return{success:!0,message:"Page updated successfully"}}catch(e){throw console.error("Error updating page:",e),o({statusCode:500,statusMessage:"Failed to update page"})}}));export{s as default};
//# sourceMappingURL=_id_.put.mjs.map
