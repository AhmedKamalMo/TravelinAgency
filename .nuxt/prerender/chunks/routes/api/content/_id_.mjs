import{defineEventHandler as e,getMethod as t,getRouterParam as n,createError as s,readBody as i}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{e as o}from"../../../_/database.mjs";import"../../../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/mysql2/promise.js";import"file://F:/TravelinAgency/node_modules/bcryptjs/index.js";import"file://F:/TravelinAgency/node_modules/jsonwebtoken/index.js";const a=e((async e=>{const a=t(e),d=n(e,"id");if(!d)throw s({statusCode:400,statusMessage:"Content ID is required"});switch(a){case"GET":return await async function(e){try{const t=await o("\n      SELECT \n        id, \n        title,\n        meta_title,\n        meta_description,\n        'page' as type,\n        status,\n        template,\n        created_at,\n        updated_at\n      FROM cms_pages \n      WHERE id = ?\n    ",[e]);if(!t||0===t.length)throw s({statusCode:404,statusMessage:"Content page not found"});const n=t[0];return{success:!0,page:{id:n.id,title:n.title,title_ar:n.title,title_en:n.meta_title||n.title,content:n.meta_description||"",content_ar:n.meta_description||"",content_en:n.meta_description||"",type:n.type,status:n.status,template:n.template,created_at:n.created_at,updated_at:n.updated_at}}}catch(e){if(console.error("Error fetching content page:",e),e.statusCode)throw e;throw s({statusCode:500,statusMessage:"Failed to fetch content page"})}}(d);case"PUT":return await async function(e,t){try{const n=await i(e);if(!(n.title_ar&&n.title_en&&n.content_ar&&n.content_en))throw s({statusCode:400,statusMessage:"Missing required fields"});return await o("\n      UPDATE cms_pages SET\n        title = ?,\n        meta_title = ?,\n        meta_description = ?,\n        status = ?,\n        template = ?,\n        updated_at = CURRENT_TIMESTAMP\n      WHERE id = ?\n    ",[n.title_ar||n.title,n.title_en||n.meta_title,n.content_ar||n.meta_description,n.status||"draft",n.template||"default",t]),{success:!0,message:"Content page updated successfully"}}catch(e){if(console.error("Error updating content page:",e),e.statusCode)throw e;throw s({statusCode:500,statusMessage:"Failed to update content page"})}}(e,d);case"DELETE":return await async function(e){try{const t=await o("\n      SELECT id FROM cms_pages WHERE id = ?\n    ",[e]);if(!t||0===t.length)throw s({statusCode:404,statusMessage:"Content page not found"});return await o("\n      DELETE FROM cms_pages WHERE id = ?\n    ",[e]),{success:!0,message:"Content page deleted successfully"}}catch(e){if(console.error("Error deleting content page:",e),e.statusCode)throw e;throw s({statusCode:500,statusMessage:"Failed to delete content page"})}}(d);default:throw s({statusCode:405,statusMessage:"Method not allowed"})}}));export{a as default};
//# sourceMappingURL=_id_.mjs.map
