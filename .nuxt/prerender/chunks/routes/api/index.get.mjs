import{defineEventHandler as e,getQuery as i,createError as n}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{e as t}from"../../_/database.mjs";import"../../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/mysql2/promise.js";import"file://F:/TravelinAgency/node_modules/bcryptjs/index.js";import"file://F:/TravelinAgency/node_modules/jsonwebtoken/index.js";const s=e((async e=>{var s;try{const n=i(e),{page:o="1",limit:a="50",type:d="",status:r="",featured:l="",search:m=""}=n,c=parseInt(o),u=parseInt(a),p=(c-1)*u;let _=[],f=[];if(d&&(_.push("category = ?"),f.push(d)),r&&(_.push("active = ?"),f.push("active"===r?1:0)),l&&(_.push("featured = ?"),f.push("true"===l?1:0)),m){_.push("(name_ar LIKE ? OR name_en LIKE ? OR description_ar LIKE ? OR description_en LIKE ?)");const e=`%${m}%`;f.push(e,e,e,e)}const g=_.length>0?`WHERE ${_.join(" AND ")}`:"",v=`SELECT COUNT(*) as total FROM destinations ${g}`,y=(null==(s=(await t(v,f))[0])?void 0:s.total)||0,j=`\n      SELECT \n        id,\n        name_ar,\n        name_en,\n        description_ar,\n        description_en,\n        image_url,\n        featured,\n        category,\n        active,\n        created_at,\n        updated_at\n      FROM destinations \n      ${g}\n      ORDER BY featured DESC, created_at DESC\n      LIMIT ? OFFSET ?\n    `,F=await t(j,[...f,u,p]);return{success:!0,data:F.map((e=>({id:e.id,name:e.name_ar||e.name_en,name_ar:e.name_ar,name_en:e.name_en,description:e.description_ar||e.description_en,description_ar:e.description_ar,description_en:e.description_en,image:e.image_url,image_url:e.image_url,featured:1===e.featured,category:e.category,active:1===e.active,status:1===e.active?"active":"inactive",created_at:e.created_at,updated_at:e.updated_at}))),pagination:{page:c,limit:u,total:y,totalPages:Math.ceil(y/u)}}}catch(e){throw console.error("Error fetching destinations:",e),n({statusCode:500,statusMessage:"Failed to fetch destinations"})}}));export{s as default};
//# sourceMappingURL=index.get.mjs.map
