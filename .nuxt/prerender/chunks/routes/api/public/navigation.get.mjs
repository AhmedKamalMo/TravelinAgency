import{defineEventHandler as e,getQuery as i,createError as n}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{executeQuery as s}from"../../../_/database.mjs";import"../../../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/mysql2/promise.js";import"file://F:/TravelinAgency/node_modules/bcryptjs/index.js";import"file://F:/TravelinAgency/node_modules/jsonwebtoken/index.js";const t=e((async e=>{try{const n=i(e),{menu_name:t}=n;let o=[];try{let e="\n        SELECT \n          n.id, n.menu_name, n.title, n.url, n.page_id, n.parent_id, n.order_index, n.target, n.icon,\n          p.slug as page_slug, p.status as page_status\n        FROM cms_navigation n\n        LEFT JOIN cms_pages p ON n.page_id = p.id\n        WHERE n.is_active = 1\n      ";const i=[];t&&(e+=" AND n.menu_name = ?",i.push(t)),e+=" ORDER BY n.menu_name, n.order_index ASC",o=await s(e,i),o=o.map((e=>"/home"===e.url||"/home/"===e.url?{...e,url:"/"}:e)),o=o.filter((e=>"/services"!==e.url&&"/services/"!==e.url&&"/contact"!==e.url&&"/contact/"!==e.url&&(!e.page_id||"published"===e.page_status)))}catch(e){let i={};try{const e=await import("node:fs/promises"),n=(await import("node:path")).join(process.cwd(),"page-statuses.json"),s=await e.readFile(n,"utf-8");i=JSON.parse(s)}catch(e){i={1:"published",2:"published",3:"published",4:"published"}}o=[{id:1,menu_name:"main",title:"الرئيسية",url:"/",page_id:1,order_index:1,target:"_self",page_slug:null,page_status:i[1]||"published"},{id:2,menu_name:"main",title:"الباقات",url:"/packages/",page_id:2,order_index:2,target:"_self",page_slug:"packages",page_status:i[2]||"published"},{id:3,menu_name:"main",title:"صمم باقتك",url:"/custom-package/",page_id:3,order_index:3,target:"_self",page_slug:"custom-package",page_status:i[3]||"published"},{id:4,menu_name:"main",title:"عن الشركة",url:"/about/",page_id:4,order_index:4,target:"_self",page_slug:"about",page_status:i[4]||"published"}].filter((e=>"published"===e.page_status))}const a=new Map,d=[];for(const e of o){const i=e.page_slug?`/${e.page_slug}`:e.url;a.set(e.id,{...e,url:i,children:[]})}for(const e of o)if(e.parent_id){const i=a.get(e.parent_id);i&&i.children.push(a.get(e.id))}else d.push(a.get(e.id));return{success:!0,data:{menus:d.reduce(((e,i)=>(e[i.menu_name]||(e[i.menu_name]=[]),e[i.menu_name].push(i),e)),{})},timestamp:(new Date).toISOString(),cacheBuster:Date.now()}}catch(e){throw console.error("Error fetching public navigation:",e),n({statusCode:500,statusMessage:"Error fetching navigation"})}}));export{t as default};
//# sourceMappingURL=navigation.get.mjs.map
