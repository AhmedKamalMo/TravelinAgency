import{defineEventHandler as e,getQuery as n,createError as i}from"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import{e as o}from"../../../_/database.mjs";import"../../../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/mysql2/promise.js";import"file://F:/TravelinAgency/node_modules/bcryptjs/index.js";import"file://F:/TravelinAgency/node_modules/jsonwebtoken/index.js";const s=e((async e=>{try{const i=n(e),{menu_name:s}=i;let d="\n      SELECT \n        n.id, n.menu_name, n.title, n.url, n.page_id, n.parent_id, n.order_index, n.target, n.icon,\n        p.slug as page_slug\n      FROM cms_navigation n\n      LEFT JOIN cms_pages p ON n.page_id = p.id AND p.status = 'published'\n      WHERE n.is_active = 1\n    ";const t=[];s&&(d+=" AND n.menu_name = ?",t.push(s)),d+=" ORDER BY n.menu_name, n.order_index ASC";const r=await o(d,t),l=new Map,m=[];for(const e of r){const n=e.page_slug?`/${e.page_slug}`:e.url;l.set(e.id,{...e,url:n,children:[]})}for(const e of r)if(e.parent_id){const n=l.get(e.parent_id);n&&n.children.push(l.get(e.id))}else m.push(l.get(e.id));return{success:!0,data:{menus:m.reduce(((e,n)=>(e[n.menu_name]||(e[n.menu_name]=[]),e[n.menu_name].push(n),e)),{})}}}catch(e){throw console.error("Error fetching public navigation:",e),i({statusCode:500,statusMessage:"Error fetching navigation"})}}));export{s as default};
//# sourceMappingURL=navigation.get.mjs.map
