import{executeAsync as e}from"file://F:/TravelinAgency/node_modules/unctx/dist/index.mjs";import{A as i,$ as o}from"./server.mjs";import{_ as n}from"./useAuth.mjs";import"file://F:/TravelinAgency/node_modules/vue/index.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue-router/dist/vue-router.node.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/vue/dist/iconify.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/cookie-es/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue-devtools-stub/dist/index.mjs";import"../_/renderer.mjs";import"file://F:/TravelinAgency/node_modules/vue-bundle-renderer/dist/runtime.mjs";import"../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/unhead/dist/server.mjs";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/unhead/dist/utils.mjs";import"file://F:/TravelinAgency/node_modules/vue/server-renderer/index.mjs";import"file://F:/TravelinAgency/node_modules/devalue/index.js";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/unhead/dist/plugins.mjs";import"file://F:/TravelinAgency/node_modules/@unhead/schema-org/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@unhead/schema-org/dist/vue.mjs";import"file://F:/TravelinAgency/node_modules/floating-vue/dist/floating-vue.mjs";const d=i((async i=>{let d,l;console.log("🚀 Admin middleware called for:",i.path);const{user:s,checkAuth:r}=n();if("/admin/login"===i.path)return void console.log("⏭️ Skipping middleware for login page");let m=s.value;if(m)console.log("✅ User already authenticated from cookie:",m.email);else{console.log("👤 No user in state, checking auth...");try{[d,l]=e((()=>r(!0))),d=await d,l(),m=d}catch(e){return console.error("❌ Auth check failed:",e),o("/admin/login")}}if(!m||!m.role||!["admin","super_admin","moderator"].includes(m.role))return console.log("❌ No authenticated admin user found, redirecting to login"),o("/admin/login");console.log("✅ User has admin privileges:",m.email,"role:",m.role),console.log("✅ Middleware completed successfully for:",i.path)}));export{d as default};
//# sourceMappingURL=admin.mjs.map
