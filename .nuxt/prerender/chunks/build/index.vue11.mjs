import{i as e}from"./AdminPageHeader.vue.mjs";import{q as t}from"./index2.mjs";import{d as s}from"./AdminStats.vue.mjs";import{ref as a,computed as r,watch as l,mergeProps as n,withCtx as i,createVNode as o,unref as d,useSSRContext as m}from"file://F:/TravelinAgency/node_modules/vue/index.mjs";import{ssrRenderAttrs as u,ssrRenderComponent as c,ssrRenderAttr as p,ssrIncludeBooleanAttr as g,ssrLooseContain as v,ssrLooseEqual as y,ssrRenderList as x,ssrRenderClass as b,ssrInterpolate as f}from"file://F:/TravelinAgency/node_modules/vue/server-renderer/index.mjs";import{C as h}from"./useMessageCounter.mjs";import{H as w}from"./server.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/css/icon.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/vue/dist/iconify.mjs";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unctx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue-router/dist/vue-router.node.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/cookie-es/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue-devtools-stub/dist/index.mjs";import"../_/renderer.mjs";import"file://F:/TravelinAgency/node_modules/vue-bundle-renderer/dist/runtime.mjs";import"../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"node:fs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/unhead/dist/server.mjs";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/unhead/dist/utils.mjs";import"file://F:/TravelinAgency/node_modules/devalue/index.js";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/unhead/dist/plugins.mjs";import"file://F:/TravelinAgency/node_modules/@unhead/schema-org/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@unhead/schema-org/dist/vue.mjs";import"file://F:/TravelinAgency/node_modules/floating-vue/dist/floating-vue.mjs";const A={__name:"index",__ssrInlineRender:!0,setup(m){const A=a([]),_=a(!0),j=a(""),T=a(""),$=a(""),F=a(""),k=a(1),C=r((()=>{let e=A.value;if(j.value&&(e=e.filter((e=>e.name.toLowerCase().includes(j.value.toLowerCase())||e.email.toLowerCase().includes(j.value.toLowerCase())||e.message.toLowerCase().includes(j.value.toLowerCase())))),T.value&&(e=e.filter((e=>e.type===T.value))),$.value&&(e=e.filter((e=>"read"===$.value?e.is_read:!e.is_read))),F.value){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(s.getTime()-6048e5),r=new Date(s.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(F.value){case"today":return t>=s;case"week":return t>=a;case"month":return t>=r;default:return!0}}))}return e.slice(10*(k.value-1),10*k.value)})),D=r((()=>{let e=A.value;if(j.value&&(e=e.filter((e=>e.name.toLowerCase().includes(j.value.toLowerCase())||e.email.toLowerCase().includes(j.value.toLowerCase())||e.message.toLowerCase().includes(j.value.toLowerCase())))),T.value&&(e=e.filter((e=>e.type===T.value))),$.value&&(e=e.filter((e=>"read"===$.value?e.is_read:!e.is_read))),F.value){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(s.getTime()-6048e5),r=new Date(s.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(F.value){case"today":return t>=s;case"week":return t>=a;case"month":return t>=r;default:return!0}}))}return e.length})),L=r((()=>Math.ceil(D.value/10))),M=r((()=>A.value.length)),S=r((()=>A.value.filter((e=>e.is_read)).length)),B=r((()=>A.value.filter((e=>!e.is_read)).length)),E=r((()=>{const e=new Date;return e.setHours(0,0,0,0),A.value.filter((t=>new Date(t.created_at)>=e)).length})),H=r((()=>A.value.filter((e=>e.phone&&""!==e.phone.trim())).length)),P=r((()=>[{key:"total",label:"إجمالي الرسائل",value:M.value,icon:"material-symbols:mail",iconBg:"bg-blue-100",iconColor:"text-blue-600"},{key:"read",label:"مقروء",value:S.value,icon:"material-symbols:mark-email-read",iconBg:"bg-green-100",iconColor:"text-green-600"},{key:"unread",label:"غير مقروء",value:B.value,icon:"material-symbols:mark-email-unread",iconBg:"bg-orange-100",iconColor:"text-orange-600"},{key:"today",label:"اليوم",value:E.value,icon:"material-symbols:today",iconBg:"bg-purple-100",iconColor:"text-purple-600"},{key:"phone",label:"مع رقم هاتف",value:H.value,icon:"material-symbols:phone",iconBg:"bg-teal-100",iconColor:"text-teal-600"}])),Q=async()=>{try{const e=await $fetch("/api/contact-messages/mark-all-read",{method:"PUT"});if(e.success){A.value.forEach((e=>{e.status="read",e.is_read=!0}));const{fetchMessageCounts:t}=h();await t(),console.log(`تم تعيين ${e.affectedRows} رسالة كمقروءة`)}}catch(e){console.error("خطأ في تعيين الرسائل كمقروءة:",e)}},U=()=>{console.log("Exporting contacts...")},K=e=>({general:"bg-gray-100 text-gray-800",package:"bg-blue-100 text-blue-800",destination:"bg-green-100 text-green-800",complaint:"bg-red-100 text-red-800",suggestion:"bg-purple-100 text-purple-800"}[e]||"bg-gray-100 text-gray-800");return l([j,T,$,F],(()=>{k.value=1})),w({title:"إدارة الرسائل - Wonder Land Admin",meta:[{name:"description",content:"عرض وإدارة رسائل العملاء"},{name:"robots",content:"noindex, nofollow"}]}),(a,r,l,m)=>{const h=e,w=t,A=s;r(`<div${u(n({class:"space-y-6"},m))}><div class="h-16"></div>`),r(c(h,{title:"إدارة الرسائل",description:"عرض وإدارة رسائل العملاء"},{actions:i(((e,t,s,a)=>{if(!t)return[o("button",{onClick:Q,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[o(w,{name:"material-symbols:mark-email-read",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),o("span",{class:"hidden sm:inline"},"تعيين الكل كمقروء"),o("span",{class:"sm:hidden"},"مقروء")]),o("button",{onClick:U,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},[o(w,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),o("span",{class:"hidden sm:inline"},"تصدير البيانات"),o("span",{class:"sm:hidden"},"تصدير")])];t(`<button class="inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"${a}>`),t(c(w,{name:"material-symbols:mark-email-read",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,s,a)),t(`<span class="hidden sm:inline"${a}>تعيين الكل كمقروء</span><span class="sm:hidden"${a}>مقروء</span></button><button class="inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"${a}>`),t(c(w,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,s,a)),t(`<span class="hidden sm:inline"${a}>تصدير البيانات</span><span class="sm:hidden"${a}>تصدير</span></button>`)})),_:1},l)),r(c(A,{stats:d(P)},null,l)),r('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div class="relative">'),r(c(w,{name:"material-symbols:search",class:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"},null,l)),r(`<input${p("value",d(j))} type="text" placeholder="البحث في الرسائل..." class="w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></div><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${g(Array.isArray(d(T))?v(d(T),""):y(d(T),""))?" selected":""}>جميع الأنواع</option><option value="general"${g(Array.isArray(d(T))?v(d(T),"general"):y(d(T),"general"))?" selected":""}>عام</option><option value="package"${g(Array.isArray(d(T))?v(d(T),"package"):y(d(T),"package"))?" selected":""}>حزمة سياحية</option><option value="destination"${g(Array.isArray(d(T))?v(d(T),"destination"):y(d(T),"destination"))?" selected":""}>وجهة</option><option value="complaint"${g(Array.isArray(d(T))?v(d(T),"complaint"):y(d(T),"complaint"))?" selected":""}>شكوى</option><option value="suggestion"${g(Array.isArray(d(T))?v(d(T),"suggestion"):y(d(T),"suggestion"))?" selected":""}>اقتراح</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${g(Array.isArray(d($))?v(d($),""):y(d($),""))?" selected":""}>جميع الحالات</option><option value="read"${g(Array.isArray(d($))?v(d($),"read"):y(d($),"read"))?" selected":""}>مقروء</option><option value="unread"${g(Array.isArray(d($))?v(d($),"unread"):y(d($),"unread"))?" selected":""}>غير مقروء</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${g(Array.isArray(d(F))?v(d(F),""):y(d(F),""))?" selected":""}>جميع التواريخ</option><option value="today"${g(Array.isArray(d(F))?v(d(F),"today"):y(d(F),"today"))?" selected":""}>اليوم</option><option value="week"${g(Array.isArray(d(F))?v(d(F),"week"):y(d(F),"week"))?" selected":""}>هذا الأسبوع</option><option value="month"${g(Array.isArray(d(F))?v(d(F),"month"):y(d(F),"month"))?" selected":""}>هذا الشهر</option></select></div></div><div class="bg-white rounded-lg shadow-sm border border-gray-200">`),d(_)?(r('<div class="flex justify-center items-center py-12">'),r(c(w,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"},null,l)),r('<span class="mr-3 text-gray-600">جارٍ تحميل الرسائل...</span></div>')):d(C).length>0?(r('<div class="divide-y divide-gray-200">\x3c!--[--\x3e'),x(d(C),(e=>{r(`<div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center space-x-3 space-x-reverse"><div class="${b([e.is_read?"bg-gray-100":"bg-blue-100","p-2 rounded-full"])}">`),r(c(w,{name:e.is_read?"material-symbols:mark-email-read":"material-symbols:mark-email-unread",class:[e.is_read?"text-gray-600":"text-blue-600","h-5 w-5"]},null,l)),r(`</div><div class="flex-1"><div class="flex items-center space-x-2 space-x-reverse"><h3 class="text-sm font-medium text-gray-900">${f(e.name)}</h3><span class="${b([K(e.type),"px-2 py-1 text-xs font-medium rounded-full"])}">${f((e=>({general:"عام",package:"حزمة سياحية",destination:"وجهة",complaint:"شكوى",suggestion:"اقتراح"}[e]||e))(e.type))}</span>`),e.is_read?r("\x3c!----\x3e"):r('<span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full"> جديد </span>'),r(`</div><p class="text-sm text-gray-600 mt-1">${f(e.email)}</p>`),e.phone?(r('<p class="text-sm text-gray-600 mt-1">'),r(c(w,{name:"material-symbols:phone",class:"h-4 w-4 inline ml-1"},null,l)),r(` ${f(e.phone)}</p>`)):r("\x3c!----\x3e"),r(`<p class="text-sm text-gray-700 mt-2">${f(((e,t)=>e?e.length>t?e.substring(0,t)+"...":e:"")(e.message,100))}</p></div></div></div><div class="flex items-center space-x-2 space-x-reverse"><div class="text-right"><p class="text-sm text-gray-500">${f((e=>new Date(e).toLocaleDateString("ar-SA"))(e.created_at))}</p><p class="text-xs text-gray-400">${f((e=>new Date(e).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}))(e.created_at))}</p></div><div class="flex items-center space-x-1 space-x-reverse"><button class="${b([e.is_read?"text-orange-600 hover:text-orange-900":"text-green-600 hover:text-green-900","p-1 rounded"])}"${p("title",e.is_read?"تعيين كغير مقروء":"تعيين كمقروء")}>`),r(c(w,{name:e.is_read?"material-symbols:mark-email-unread":"material-symbols:mark-email-read",class:"h-4 w-4"},null,l)),r('</button><button class="text-red-600 hover:text-red-900 p-1 rounded" title="حذف">'),r(c(w,{name:"material-symbols:delete",class:"h-4 w-4"},null,l)),r("</button></div></div></div></div>")})),r("\x3c!--]--\x3e</div>")):(r('<div class="text-center py-12">'),r(c(w,{name:"material-symbols:mail",class:"h-16 w-16 text-gray-300 mx-auto mb-4"},null,l)),r('<h3 class="text-lg font-medium text-gray-900 mb-2">لا توجد رسائل</h3><p class="text-gray-500 mb-6">لم يتم العثور على أي رسائل</p></div>')),r("</div>"),d(L)>1?r(`<div class="flex items-center justify-between"><div class="text-sm text-gray-700"> عرض ${f(10*(d(k)-1)+1)} إلى ${f(Math.min(10*d(k),d(D)))} من أصل ${f(d(D))} رسالة </div><div class="flex space-x-1 space-x-reverse"><button${g(1===d(k))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> السابق </button><span class="px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md">${f(d(k))}</span><button${g(d(k)===d(L))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> التالي </button></div></div>`):r("\x3c!----\x3e"),r("</div>")}}},_=A.setup;A.setup=(e,t)=>{const s=m();return(s.modules||(s.modules=new Set)).add("pages/admin/contacts/index.vue"),_?_(e,t):void 0};export{A as default};
//# sourceMappingURL=index.vue11.mjs.map
