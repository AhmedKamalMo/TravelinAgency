import{i as e}from"./AdminPageHeader.vue.mjs";import{q as t}from"./index2.mjs";import{M as s}from"./nuxt-link.mjs";import{d as r}from"./AdminStats.vue.mjs";import{ref as a,computed as l,readonly as n,watch as i,mergeProps as o,withCtx as d,createVNode as u,unref as c,createTextVNode as m,useSSRContext as p}from"file://F:/TravelinAgency/node_modules/vue/index.mjs";import{ssrRenderAttrs as v,ssrRenderComponent as y,ssrRenderAttr as x,ssrIncludeBooleanAttr as f,ssrLooseContain as w,ssrLooseEqual as b,ssrRenderList as A,ssrInterpolate as _,ssrRenderClass as T}from"file://F:/TravelinAgency/node_modules/vue/server-renderer/index.mjs";import{p as F}from"./useExcelExport.mjs";import{H as $}from"./server.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/css/icon.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/vue/dist/iconify.mjs";import"F:\\TravelinAgency\\node_modules\\xlsx\\dist\\cpexcel.js";import"node:fs";import"node:stream";import"file://F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unctx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/h3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue-router/dist/vue-router.node.mjs";import"file://F:/TravelinAgency/node_modules/radix3/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import"file://F:/TravelinAgency/node_modules/klona/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/cookie-es/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/destr/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ohash/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/vue-devtools-stub/dist/index.mjs";import"../_/renderer.mjs";import"file://F:/TravelinAgency/node_modules/vue-bundle-renderer/dist/runtime.mjs";import"../_/nitro.mjs";import"file://F:/TravelinAgency/node_modules/ofetch/dist/node.mjs";import"file://F:/TravelinAgency/node_modules/node-mock-http/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/scule/dist/index.mjs";import"node:url";import"file://F:/TravelinAgency/node_modules/pathe/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@iconify/utils/lib/index.mjs";import"file://F:/TravelinAgency/node_modules/consola/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/ipx/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs.mjs";import"file:///F:/TravelinAgency/node_modules/nuxt/dist/core/runtime/nitro/utils/cache-driver.js";import"file://F:/TravelinAgency/node_modules/unstorage/drivers/fs-lite.mjs";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/unhead/dist/server.mjs";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/unhead/dist/utils.mjs";import"file://F:/TravelinAgency/node_modules/devalue/index.js";import"file://F:/TravelinAgency/node_modules/nuxt/node_modules/unhead/dist/plugins.mjs";import"file://F:/TravelinAgency/node_modules/@unhead/schema-org/dist/index.mjs";import"file://F:/TravelinAgency/node_modules/@unhead/schema-org/dist/vue.mjs";import"file://F:/TravelinAgency/node_modules/floating-vue/dist/floating-vue.mjs";const j={__name:"index",__ssrInlineRender:!0,setup(p){const{users:j,isLoading:S,userStats:D,getRoleName:L,getRoleColor:C,getStatusName:E,getStatusColor:k,formatDate:U}=(()=>{const e=a([]),t=a(null),s=a(!1),r=a(null),g=async t=>{try{s.value=!0,r.value=null;const a=new URLSearchParams;null!=t&&t.page&&a.append("page",t.page.toString()),null!=t&&t.limit&&a.append("limit",t.limit.toString()),null!=t&&t.search&&a.append("search",t.search),null!=t&&t.status&&a.append("status",t.status),null!=t&&t.role&&a.append("role",t.role);const l=await $fetch(`/api/admin/users?${a.toString()}`);if(l.success&&l.data)return e.value=l.data.users,l.data;throw new Error(l.error||"Failed to fetch users")}catch(t){throw console.error("Error fetching users:",t),r.value=t.message||"Failed to fetch users",e.value=[],t}finally{s.value=!1}},h=async(a,l)=>{var n;try{s.value=!0,r.value=null;const i=await $fetch(`/api/admin/users/${a}`,{method:"PUT",body:l});if(i.success&&i.data){const s=e.value.findIndex((e=>e.id.toString()===a.toString()));return-1!==s&&(e.value[s]=i.data),(null==(n=t.value)?void 0:n.id.toString())===a.toString()&&(t.value=i.data),i.data}throw new Error(i.error||"Failed to update user")}catch(e){throw console.error("Error updating user:",e),r.value=e.message||"Failed to update user",e}finally{s.value=!1}},i=l((()=>{const t=e.value.length,s=e.value.filter((e=>"active"===e.status)).length,r=e.value.filter((e=>"inactive"===e.status)).length,a=e.value.filter((e=>"suspended"===e.status)).length,l=new Date;l.setHours(0,0,0,0);const n=e.value.filter((e=>new Date(e.created_at)>=l)).length,i=new Date(l.getTime()-6048e5),o=e.value.filter((e=>new Date(e.created_at)>=i)).length,d=new Date(l.getTime()-2592e6);return{total:t,active:s,inactive:r,suspended:a,newToday:n,newThisWeek:o,newThisMonth:e.value.filter((e=>new Date(e.created_at)>=d)).length}}));return{users:n(e),currentUser:n(t),isLoading:n(s),error:n(r),userStats:i,fetchUsers:g,fetchUser:async e=>{try{s.value=!0,r.value=null;const a=await $fetch(`/api/admin/users/${e}`);if(a.success&&a.data)return t.value=a.data,a.data;throw new Error(a.error||"Failed to fetch user")}catch(e){throw console.error("Error fetching user:",e),r.value=e.message||"Failed to fetch user",t.value=null,e}finally{s.value=!1}},createUser:async t=>{try{s.value=!0,r.value=null;const a=await $fetch("/api/admin/users",{method:"POST",body:t});if(a.success&&a.data)return e.value.unshift(a.data),a.data;throw new Error(a.error||"Failed to create user")}catch(e){throw console.error("Error creating user:",e),r.value=e.message||"Failed to create user",e}finally{s.value=!1}},updateUser:h,deleteUser:async a=>{var l;try{s.value=!0,r.value=null;const n=await $fetch(`/api/admin/users/${a}`,{method:"DELETE"});if(n.success)return e.value=e.value.filter((e=>e.id.toString()!==a.toString())),(null==(l=t.value)?void 0:l.id.toString())===a.toString()&&(t.value=null),!0;throw new Error(n.error||"Failed to delete user")}catch(e){throw console.error("Error deleting user:",e),r.value=e.message||"Failed to delete user",e}finally{s.value=!1}},toggleUserStatus:async(e,t)=>{try{return await h(e,{status:t})}catch(e){throw console.error("Error toggling user status:",e),e}},changeUserRole:async(e,t)=>{try{return await h(e,{role:t})}catch(e){throw console.error("Error changing user role:",e),e}},searchUsers:async e=>{try{return await g({search:e})}catch(e){throw console.error("Error searching users:",e),e}},filterUsers:async e=>{try{return await g(e)}catch(e){throw console.error("Error filtering users:",e),e}},getRoleName:e=>({admin:"مدير",moderator:"مشرف",user:"مستخدم"}[e]||e),getRoleColor:e=>({admin:"bg-red-100 text-red-800",moderator:"bg-blue-100 text-blue-800",user:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),getStatusName:e=>({active:"نشط",inactive:"غير نشط",suspended:"معلق"}[e]||e),getStatusColor:e=>({active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-800",suspended:"bg-orange-100 text-orange-800"}[e]||"bg-gray-100 text-gray-800"),formatDate:e=>new Date(e).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}})(),R=a(""),M=a(""),N=a(""),P=a(""),H=a(1),I=l((()=>{let e=j.value;if(R.value&&(e=e.filter((e=>{var t,s,r;return(null==(t=e.full_name)?void 0:t.toLowerCase().includes(R.value.toLowerCase()))||(null==(s=e.name)?void 0:s.toLowerCase().includes(R.value.toLowerCase()))||e.email.toLowerCase().includes(R.value.toLowerCase())||(null==(r=e.phone)?void 0:r.toLowerCase().includes(R.value.toLowerCase()))}))),M.value&&(e=e.filter((e=>e.status===M.value))),N.value&&(e=e.filter((e=>e.role===N.value))),P.value){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(s.getTime()-6048e5),a=new Date(s.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(P.value){case"today":return t>=s;case"week":return t>=r;case"month":return t>=a;default:return!0}}))}return e.slice(10*(H.value-1),10*H.value)})),W=l((()=>{let e=j.value;if(R.value&&(e=e.filter((e=>{var t,s,r;return(null==(t=e.full_name)?void 0:t.toLowerCase().includes(R.value.toLowerCase()))||(null==(s=e.name)?void 0:s.toLowerCase().includes(R.value.toLowerCase()))||e.email.toLowerCase().includes(R.value.toLowerCase())||(null==(r=e.phone)?void 0:r.toLowerCase().includes(R.value.toLowerCase()))}))),M.value&&(e=e.filter((e=>e.status===M.value))),N.value&&(e=e.filter((e=>e.role===N.value))),P.value){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(s.getTime()-6048e5),a=new Date(s.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(P.value){case"today":return t>=s;case"week":return t>=r;case"month":return t>=a;default:return!0}}))}return e.length})),Y=l((()=>Math.ceil(W.value/10))),G=()=>{try{const{exportUsersToExcel:e}=F();e(j.value)?console.log("تم تصدير المستخدمين بنجاح"):console.error("فشل في تصدير المستخدمين")}catch(e){console.error("خطأ في تصدير المستخدمين:",e)}};return i([R,M,N,P],(()=>{H.value=1})),$({title:"إدارة المستخدمين - Wonder Land Admin",meta:[{name:"description",content:"إدارة وتحرير المستخدمين المسجلين"},{name:"robots",content:"noindex, nofollow"}]}),(a,l,n,i)=>{const p=e,F=t,$=s,j=r;l(`<div${v(o({class:"space-y-6"},i))}><div class="h-16"></div>`),l(y(p,{title:"إدارة المستخدمين",description:"إدارة وتحرير المستخدمين المسجلين"},{actions:d(((e,t,s,r)=>{if(!t)return[u("button",{onClick:G,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[u(F,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),u("span",{class:"hidden sm:inline"},"تصدير البيانات"),u("span",{class:"sm:hidden"},"تصدير")]),u($,{to:"/admin/users/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:d((()=>[u(F,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),u("span",{class:"hidden sm:inline"},"إضافة مستخدم جديد"),u("span",{class:"sm:hidden"},"إضافة")])),_:1})];t(`<button class="inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"${r}>`),t(y(F,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,s,r)),t(`<span class="hidden sm:inline"${r}>تصدير البيانات</span><span class="sm:hidden"${r}>تصدير</span></button>`),t(y($,{to:"/admin/users/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:d(((e,t,s,r)=>{if(!t)return[u(F,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),u("span",{class:"hidden sm:inline"},"إضافة مستخدم جديد"),u("span",{class:"sm:hidden"},"إضافة")];t(y(F,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,s,r)),t(`<span class="hidden sm:inline"${r}>إضافة مستخدم جديد</span><span class="sm:hidden"${r}>إضافة</span>`)})),_:1},s,r))})),_:1},n)),l(y(j,{stats:c(D)},null,n)),l('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div class="relative">'),l(y(F,{name:"material-symbols:search",class:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"},null,n)),l(`<input${x("value",c(R))} type="text" placeholder="البحث في المستخدمين..." class="w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></div><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${f(Array.isArray(c(M))?w(c(M),""):b(c(M),""))?" selected":""}>جميع الحالات</option><option value="active"${f(Array.isArray(c(M))?w(c(M),"active"):b(c(M),"active"))?" selected":""}>نشط</option><option value="inactive"${f(Array.isArray(c(M))?w(c(M),"inactive"):b(c(M),"inactive"))?" selected":""}>غير نشط</option><option value="suspended"${f(Array.isArray(c(M))?w(c(M),"suspended"):b(c(M),"suspended"))?" selected":""}>معلق</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${f(Array.isArray(c(N))?w(c(N),""):b(c(N),""))?" selected":""}>جميع الأدوار</option><option value="admin"${f(Array.isArray(c(N))?w(c(N),"admin"):b(c(N),"admin"))?" selected":""}>مدير</option><option value="moderator"${f(Array.isArray(c(N))?w(c(N),"moderator"):b(c(N),"moderator"))?" selected":""}>مشرف</option><option value="user"${f(Array.isArray(c(N))?w(c(N),"user"):b(c(N),"user"))?" selected":""}>مستخدم</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${f(Array.isArray(c(P))?w(c(P),""):b(c(P),""))?" selected":""}>جميع التواريخ</option><option value="today"${f(Array.isArray(c(P))?w(c(P),"today"):b(c(P),"today"))?" selected":""}>اليوم</option><option value="week"${f(Array.isArray(c(P))?w(c(P),"week"):b(c(P),"week"))?" selected":""}>هذا الأسبوع</option><option value="month"${f(Array.isArray(c(P))?w(c(P),"month"):b(c(P),"month"))?" selected":""}>هذا الشهر</option></select></div></div><div class="bg-white rounded-lg shadow-sm border border-gray-200">`),c(S)?(l('<div class="flex justify-center items-center py-12">'),l(y(F,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"},null,n)),l('<span class="mr-3 text-gray-600">جارٍ تحميل المستخدمين...</span></div>')):c(I).length>0?(l('<div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> المستخدم </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> البريد الإلكتروني </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الدور </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الحالة </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> تاريخ التسجيل </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الإجراءات </th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e'),A(c(I),(e=>{l('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-10 w-10"><div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center">'),l(y(F,{name:"material-symbols:person",class:"h-6 w-6 text-gray-600"},null,n)),l(`</div></div><div class="mr-4"><div class="text-sm font-medium text-gray-900">${_(e.full_name||e.name||"غير محدد")}</div><div class="text-sm text-gray-500">${_(e.phone||"لا يوجد رقم هاتف")}</div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900">${_(e.email)}</div><div class="text-sm text-gray-500">${_(e.email_verified?"مؤكد":"غير مؤكد")}</div></td><td class="px-6 py-4 whitespace-nowrap"><span class="${T([c(C)(e.role),"px-2 py-1 text-xs font-medium rounded-full"])}">${_(c(L)(e.role))}</span></td><td class="px-6 py-4 whitespace-nowrap"><span class="${T([c(k)(e.status),"px-2 py-1 text-xs font-medium rounded-full"])}">${_(c(E)(e.status))}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${_(c(U)(e.created_at))}</td><td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><div class="flex items-center space-x-2 space-x-reverse">`),l(y($,{to:`/admin/users/${e.id}`,class:"text-blue-600 hover:text-blue-900 p-1 rounded",title:"عرض"},{default:d(((e,t,s,r)=>{if(!t)return[u(F,{name:"material-symbols:visibility",class:"h-4 w-4"})];t(y(F,{name:"material-symbols:visibility",class:"h-4 w-4"},null,s,r))})),_:2},n)),l(y($,{to:`/admin/users/${e.id}/edit`,class:"text-green-600 hover:text-green-900 p-1 rounded",title:"تحرير"},{default:d(((e,t,s,r)=>{if(!t)return[u(F,{name:"material-symbols:edit",class:"h-4 w-4"})];t(y(F,{name:"material-symbols:edit",class:"h-4 w-4"},null,s,r))})),_:2},n)),l(`<button class="${T(["active"===e.status?"text-orange-600 hover:text-orange-900":"text-green-600 hover:text-green-900","p-1 rounded"])}"${x("title","active"===e.status?"إلغاء التفعيل":"تفعيل")}>`),l(y(F,{name:"active"===e.status?"material-symbols:pause":"material-symbols:play-arrow",class:"h-4 w-4"},null,n)),l('</button><button class="text-red-600 hover:text-red-900 p-1 rounded" title="حذف">'),l(y(F,{name:"material-symbols:delete",class:"h-4 w-4"},null,n)),l("</button></div></td></tr>")})),l("\x3c!--]--\x3e</tbody></table></div>")):(l('<div class="text-center py-12">'),l(y(F,{name:"material-symbols:people",class:"h-16 w-16 text-gray-300 mx-auto mb-4"},null,n)),l('<h3 class="text-lg font-medium text-gray-900 mb-2">لا يوجد مستخدمون</h3><p class="text-gray-500 mb-6">لم يتم العثور على أي مستخدمين</p>'),l(y($,{to:"/admin/users/create",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},{default:d(((e,t,s,r)=>{if(!t)return[u(F,{name:"material-symbols:add",class:"h-5 w-5 ml-2"}),m(" إضافة مستخدم جديد ")];t(y(F,{name:"material-symbols:add",class:"h-5 w-5 ml-2"},null,s,r)),t(" إضافة مستخدم جديد ")})),_:1},n)),l("</div>")),l("</div>"),c(Y)>1?l(`<div class="flex items-center justify-between"><div class="text-sm text-gray-700"> عرض ${_(10*(c(H)-1)+1)} إلى ${_(Math.min(10*c(H),c(W)))} من أصل ${_(c(W))} مستخدم </div><div class="flex space-x-1 space-x-reverse"><button${f(1===c(H))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> السابق </button><span class="px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md">${_(c(H))}</span><button${f(c(H)===c(Y))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> التالي </button></div></div>`):l("\x3c!----\x3e"),l("</div>")}}},S=j.setup;j.setup=(e,t)=>{const s=p();return(s.modules||(s.modules=new Set)).add("pages/admin/users/index.vue"),S?S(e,t):void 0};export{j as default};
//# sourceMappingURL=index.vue6.mjs.map
