{"version":3,"file":"images.vue.mjs","sources":["../../../../../../pages/admin/packages/images.vue"],"sourcesContent":["<template>\r\n  <div class=\"space-y-6\">\r\n    <!-- مساحة إضافية في الأعلى -->\r\n    <div class=\"h-16\"></div>\r\n    \r\n    <!-- رأس الصفحة -->\r\n    <div class=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\r\n      <div>\r\n        <h1 class=\"text-2xl font-bold text-gray-900\">إدارة صور الباقات</h1>\r\n        <p class=\"mt-1 text-sm text-gray-600\">رفع وإدارة صور الباقات السياحية</p>\r\n      </div>\r\n      <div class=\"mt-4 sm:mt-0\">\r\n        <NuxtLink\r\n          to=\"/admin/packages\"\r\n          class=\"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors\"\r\n        >\r\n          <Icon name=\"material-symbols:arrow-back\" class=\"h-5 w-5 ml-2\" />\r\n          العودة للباقات\r\n        </NuxtLink>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- رفع الصور -->\r\n    <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n      <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">رفع صور جديدة</h2>\r\n      \r\n      <!-- منطقة رفع الملفات -->\r\n      <div class=\"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors\">\r\n        <input\r\n          ref=\"fileInput\"\r\n          type=\"file\"\r\n          multiple\r\n          accept=\"image/*\"\r\n          @change=\"handleFileSelect\"\r\n          class=\"hidden\"\r\n        />\r\n        \r\n        <div v-if=\"!uploading\" @click=\"$refs.fileInput.click()\" class=\"cursor-pointer\">\r\n          <Icon name=\"material-symbols:cloud-upload\" class=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n          <p class=\"text-lg font-medium text-gray-900 mb-2\">انقر لرفع الصور</p>\r\n          <p class=\"text-sm text-gray-500\">أو اسحب وأفلت الملفات هنا</p>\r\n          <p class=\"text-xs text-gray-400 mt-2\">PNG, JPG, JPEG (حد أقصى 10MB لكل صورة)</p>\r\n        </div>\r\n        \r\n        <!-- حالة الرفع -->\r\n        <div v-else class=\"space-y-4\">\r\n          <Icon name=\"material-symbols:progress-activity\" class=\"animate-spin h-8 w-8 text-blue-600 mx-auto\" />\r\n          <p class=\"text-gray-600\">جاري رفع {{ selectedFiles.length }} صورة...</p>\r\n          <div class=\"w-full bg-gray-200 rounded-full h-2\">\r\n            <div class=\"bg-blue-600 h-2 rounded-full transition-all duration-300\" :style=\"{ width: uploadProgress + '%' }\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- معاينة الملفات المحددة -->\r\n      <div v-if=\"selectedFiles.length > 0 && !uploading\" class=\"mt-6\">\r\n        <h3 class=\"text-md font-medium text-gray-900 mb-3\">الملفات المحددة ({{ selectedFiles.length }})</h3>\r\n        <div class=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4\">\r\n          <div v-for=\"(file, index) in selectedFiles\" :key=\"index\" class=\"relative\">\r\n            <img\r\n              :src=\"file.preview\"\r\n              :alt=\"file.name\"\r\n              class=\"w-full h-24 object-cover rounded-lg border border-gray-200\"\r\n            />\r\n            <button\r\n              @click=\"removeFile(index)\"\r\n              class=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600\"\r\n            >\r\n              ×\r\n            </button>\r\n            <p class=\"text-xs text-gray-600 mt-1 truncate\">{{ file.name }}</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"mt-4 flex space-x-3 space-x-reverse\">\r\n          <button\r\n            @click=\"uploadFiles\"\r\n            class=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n          >\r\n            <Icon name=\"material-symbols:upload\" class=\"h-5 w-5 ml-2\" />\r\n            رفع الصور\r\n          </button>\r\n          <button\r\n            @click=\"clearFiles\"\r\n            class=\"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors\"\r\n          >\r\n            إلغاء\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- معرض الصور المرفوعة -->\r\n    <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n      <div class=\"flex items-center justify-between mb-4\">\r\n        <h2 class=\"text-lg font-semibold text-gray-900\">الصور المرفوعة</h2>\r\n        <div class=\"flex space-x-2 space-x-reverse\">\r\n          <button\r\n            @click=\"refreshImages\"\r\n            class=\"inline-flex items-center px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors\"\r\n          >\r\n            <Icon name=\"material-symbols:refresh\" class=\"h-4 w-4 ml-1\" />\r\n            تحديث\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- حالة التحميل -->\r\n      <div v-if=\"loadingImages\" class=\"flex justify-center items-center py-12\">\r\n        <Icon name=\"material-symbols:progress-activity\" class=\"animate-spin h-8 w-8 text-blue-600\" />\r\n        <span class=\"mr-3 text-gray-600\">جارٍ تحميل الصور...</span>\r\n      </div>\r\n      \r\n      <!-- معرض الصور -->\r\n      <div v-else-if=\"uploadedImages.length > 0\" class=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4\">\r\n        <div v-for=\"image in uploadedImages\" :key=\"image.filename\" class=\"relative group\">\r\n          <img\r\n            :src=\"image.path\"\r\n            :alt=\"image.originalName\"\r\n            class=\"w-full h-32 object-cover rounded-lg border border-gray-200 hover:border-blue-300 transition-colors\"\r\n          />\r\n          \r\n          <!-- معلومات الصورة -->\r\n          <div class=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 rounded-lg flex items-center justify-center\">\r\n            <div class=\"opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-white text-center\">\r\n              <p class=\"text-xs font-medium truncate px-2\">{{ image.originalName }}</p>\r\n              <p class=\"text-xs opacity-75\">{{ formatFileSize(image.size) }}</p>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- أزرار الإجراءات -->\r\n          <div class=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200\">\r\n            <div class=\"flex space-x-1 space-x-reverse\">\r\n              <button\r\n                @click=\"copyImagePath(image.path)\"\r\n                class=\"p-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors\"\r\n                title=\"نسخ المسار\"\r\n              >\r\n                <Icon name=\"material-symbols:content-copy\" class=\"h-3 w-3\" />\r\n              </button>\r\n              <button\r\n                @click=\"deleteImage(image)\"\r\n                class=\"p-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors\"\r\n                title=\"حذف\"\r\n              >\r\n                <Icon name=\"material-symbols:delete\" class=\"h-3 w-3\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- حالة عدم وجود صور -->\r\n      <div v-else class=\"text-center py-12\">\r\n        <Icon name=\"material-symbols:image-outline\" class=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\r\n        <h3 class=\"text-lg font-medium text-gray-900 mb-2\">لا توجد صور</h3>\r\n        <p class=\"text-gray-500\">لم يتم رفع أي صور بعد</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- إحصائيات -->\r\n    <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n      <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n        <div class=\"flex items-center\">\r\n          <div class=\"p-3 bg-blue-100 rounded-lg\">\r\n            <Icon name=\"material-symbols:image\" class=\"h-6 w-6 text-blue-600\" />\r\n          </div>\r\n          <div class=\"mr-4\">\r\n            <p class=\"text-sm font-medium text-gray-600\">إجمالي الصور</p>\r\n            <p class=\"text-2xl font-bold text-gray-900\">{{ uploadedImages.length }}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n        <div class=\"flex items-center\">\r\n          <div class=\"p-3 bg-green-100 rounded-lg\">\r\n            <Icon name=\"material-symbols:storage\" class=\"h-6 w-6 text-green-600\" />\r\n          </div>\r\n          <div class=\"mr-4\">\r\n            <p class=\"text-sm font-medium text-gray-600\">إجمالي الحجم</p>\r\n            <p class=\"text-2xl font-bold text-gray-900\">{{ formatFileSize(totalSize) }}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n        <div class=\"flex items-center\">\r\n          <div class=\"p-3 bg-purple-100 rounded-lg\">\r\n            <Icon name=\"material-symbols:folder\" class=\"h-6 w-6 text-purple-600\" />\r\n          </div>\r\n          <div class=\"mr-4\">\r\n            <p class=\"text-sm font-medium text-gray-600\">المجلدات</p>\r\n            <p class=\"text-2xl font-bold text-gray-900\">3</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n// إعداد الصفحة\r\ndefinePageMeta({\r\n  layout: 'admin',\r\n  middleware: 'admin'\r\n})\r\n\r\n// المتغيرات التفاعلية\r\nconst selectedFiles = ref([])\r\nconst uploadedImages = ref([])\r\nconst uploading = ref(false)\r\nconst loadingImages = ref(false)\r\nconst uploadProgress = ref(0)\r\n\r\n// المتغيرات المحسوبة\r\nconst totalSize = computed(() => {\r\n  return uploadedImages.value.reduce((total, image) => total + image.size, 0)\r\n})\r\n\r\n// اختيار الملفات\r\nconst handleFileSelect = (event) => {\r\n  const files = Array.from(event.target.files)\r\n  \r\n  files.forEach(file => {\r\n    if (file.type.startsWith('image/')) {\r\n      const reader = new FileReader()\r\n      reader.onload = (e) => {\r\n        selectedFiles.value.push({\r\n          file: file,\r\n          name: file.name,\r\n          size: file.size,\r\n          preview: e.target.result\r\n        })\r\n      }\r\n      reader.readAsDataURL(file)\r\n    }\r\n  })\r\n}\r\n\r\n// رفع الملفات\r\nconst uploadFiles = async () => {\r\n  if (selectedFiles.value.length === 0) return\r\n  \r\n  try {\r\n    uploading.value = true\r\n    uploadProgress.value = 0\r\n    \r\n    const formData = new FormData()\r\n    selectedFiles.value.forEach((fileData, index) => {\r\n      formData.append(`file_${index}`, fileData.file)\r\n    })\r\n    \r\n    const response = await $fetch('/api/images/upload', {\r\n      method: 'POST',\r\n      body: formData\r\n    })\r\n    \r\n    if (response.success) {\r\n      uploadedImages.value.unshift(...response.files)\r\n      selectedFiles.value = []\r\n      uploadProgress.value = 100\r\n      \r\n      // إشعار بالنجاح\r\n      console.log('تم رفع الصور بنجاح')\r\n    }\r\n  } catch (error) {\r\n    console.error('خطأ في رفع الصور:', error)\r\n  } finally {\r\n    uploading.value = false\r\n    uploadProgress.value = 0\r\n  }\r\n}\r\n\r\n// حذف صورة\r\nconst deleteImage = async (image) => {\r\n  if (!confirm('هل أنت متأكد من حذف هذه الصورة؟')) return\r\n  \r\n  try {\r\n    const response = await $fetch('/api/images/delete', {\r\n      method: 'POST',\r\n      body: { filename: image.filename }\r\n    })\r\n    \r\n    if (response.success) {\r\n      uploadedImages.value = uploadedImages.value.filter(img => img.filename !== image.filename)\r\n      console.log('تم حذف الصورة')\r\n    }\r\n  } catch (error) {\r\n    console.error('خطأ في حذف الصورة:', error)\r\n  }\r\n}\r\n\r\n// نسخ مسار الصورة\r\nconst copyImagePath = (path) => {\r\n  navigator.clipboard.writeText(path).then(() => {\r\n    console.log('تم نسخ مسار الصورة')\r\n  })\r\n}\r\n\r\n// مسح الملفات المحددة\r\nconst clearFiles = () => {\r\n  selectedFiles.value = []\r\n  const fileInput = document.querySelector('input[type=\"file\"]')\r\n  if (fileInput) {\r\n    fileInput.value = ''\r\n  }\r\n}\r\n\r\n// إزالة ملف من القائمة\r\nconst removeFile = (index) => {\r\n  selectedFiles.value.splice(index, 1)\r\n}\r\n\r\n// تحديث قائمة الصور\r\nconst refreshImages = () => {\r\n  loadUploadedImages()\r\n}\r\n\r\n// تحميل الصور المرفوعة\r\nconst loadUploadedImages = async () => {\r\n  try {\r\n    loadingImages.value = true\r\n    const response = await $fetch('/api/images/list')\r\n    \r\n    if (response.success) {\r\n      uploadedImages.value = response.images\r\n    } else {\r\n      uploadedImages.value = []\r\n    }\r\n  } catch (error) {\r\n    console.error('خطأ في تحميل الصور:', error)\r\n    uploadedImages.value = []\r\n  } finally {\r\n    loadingImages.value = false\r\n  }\r\n}\r\n\r\n// تنسيق حجم الملف\r\nconst formatFileSize = (bytes) => {\r\n  if (bytes === 0) return '0 Bytes'\r\n  const k = 1024\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB']\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\r\n}\r\n\r\n// تحميل البيانات عند تحميل الصفحة\r\nonMounted(() => {\r\n  loadUploadedImages()\r\n})\r\n\r\n// SEO والميتا\r\nuseHead({\r\n  title: 'إدارة صور الباقات - Wonder Land Admin',\r\n  meta: [\r\n    { name: 'description', content: 'رفع وإدارة صور الباقات السياحية' },\r\n    { name: 'robots', content: 'noindex, nofollow' }\r\n  ]\r\n})\r\n</script>\r\n"],"names":["selectedFiles","ref","uploadedImages","uploading","loadingImages","uploadProgress","totalSize","computed","total","image","formatFileSize","bytes","k","sizes","i","useHead"],"mappings":"mpBAiNM,MAAAA,EAAgBC,EAAI,EAAE,EACtBC,EAAiBD,EAAI,EAAE,EACvBE,EAAYF,EAAI,EAAK,EACrBG,EAAgBH,EAAI,EAAK,EACzBI,EAAiBJ,EAAI,CAAC,EAGtBK,EAAYC,EAAS,IAClBL,EAAe,MAAM,OAAO,CAACM,EAAOC,IAAUD,EAAQC,EAAM,KAAM,CAAC,CAC3E,EAyHKC,EAAkBC,GAAU,CAC5B,GAAAA,IAAU,EAAU,MAAA,UACxB,MAAMC,EAAI,KACJC,EAAQ,CAAC,QAAS,KAAM,KAAM,IAAI,EAClCC,EAAI,KAAK,MAAM,KAAK,IAAIH,CAAK,EAAI,KAAK,IAAIC,CAAC,CAAC,EAClD,OAAO,YAAYD,EAAQ,KAAK,IAAIC,EAAGE,CAAC,GAAG,QAAQ,CAAC,CAAC,EAAI,IAAMD,EAAMC,CAAC,CACxE,EAQQ,OAAAC,EAAA,CACN,MAAO,wCACP,KAAM,CACJ,CAAE,KAAM,cAAe,QAAS,iCAAkC,EAClE,CAAE,KAAM,SAAU,QAAS,mBAAoB,CAAA,CACjD,CACD"}