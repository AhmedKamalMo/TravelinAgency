{"version":3,"file":"index.vue.mjs","sources":["../../../../../../pages/admin/users/index.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-6\">\n    <!-- مساحة إضافية في الأعلى -->\n    <div class=\"h-16\"></div>\n    \n    <!-- رأس الصفحة -->\n    <AdminPageHeader \n      title=\"إدارة المستخدمين\"\n      description=\"إدارة وتحرير المستخدمين المسجلين\"\n    >\n      <template #actions>\n        <button\n          @click=\"exportUsers\"\n          class=\"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm\"\n        >\n          <Icon name=\"material-symbols:download\" class=\"h-4 w-4 sm:h-5 sm:w-5 ml-2\" />\n          <span class=\"hidden sm:inline\">تصدير البيانات</span>\n          <span class=\"sm:hidden\">تصدير</span>\n        </button>\n        <NuxtLink\n          to=\"/admin/users/create\"\n          class=\"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm\"\n        >\n          <Icon name=\"material-symbols:add\" class=\"h-4 w-4 sm:h-5 sm:w-5 ml-2\" />\n          <span class=\"hidden sm:inline\">إضافة مستخدم جديد</span>\n          <span class=\"sm:hidden\">إضافة</span>\n        </NuxtLink>\n      </template>\n    </AdminPageHeader>\n\n    <!-- إحصائيات سريعة -->\n    <AdminStats :stats=\"userStats\" />\n\n    <!-- شريط البحث والتصفية -->\n    <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n      <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <!-- البحث -->\n        <div class=\"relative\">\n          <Icon name=\"material-symbols:search\" class=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n          <input\n            v-model=\"searchQuery\"\n            type=\"text\"\n            placeholder=\"البحث في المستخدمين...\"\n            class=\"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          />\n        </div>\n\n        <!-- تصفية حسب الحالة -->\n        <select\n          v-model=\"statusFilter\"\n          class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n        >\n          <option value=\"\">جميع الحالات</option>\n          <option value=\"active\">نشط</option>\n          <option value=\"inactive\">غير نشط</option>\n          <option value=\"suspended\">معلق</option>\n        </select>\n\n        <!-- تصفية حسب الدور -->\n        <select\n          v-model=\"roleFilter\"\n          class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n        >\n          <option value=\"\">جميع الأدوار</option>\n          <option value=\"admin\">مدير</option>\n          <option value=\"moderator\">مشرف</option>\n          <option value=\"user\">مستخدم</option>\n        </select>\n\n        <!-- تصفية حسب التاريخ -->\n        <select\n          v-model=\"dateFilter\"\n          class=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n        >\n          <option value=\"\">جميع التواريخ</option>\n          <option value=\"today\">اليوم</option>\n          <option value=\"week\">هذا الأسبوع</option>\n          <option value=\"month\">هذا الشهر</option>\n        </select>\n      </div>\n    </div>\n\n    <!-- قائمة المستخدمين -->\n    <div class=\"bg-white rounded-lg shadow-sm border border-gray-200\">\n      <!-- حالة التحميل -->\n      <div v-if=\"isLoading\" class=\"flex justify-center items-center py-12\">\n        <Icon name=\"material-symbols:progress-activity\" class=\"animate-spin h-8 w-8 text-blue-600\" />\n        <span class=\"mr-3 text-gray-600\">جارٍ تحميل المستخدمين...</span>\n      </div>\n\n      <!-- قائمة المستخدمين -->\n      <div v-else-if=\"filteredUsers.length > 0\" class=\"overflow-x-auto\">\n        <table class=\"min-w-full divide-y divide-gray-200\">\n          <thead class=\"bg-gray-50\">\n            <tr>\n              <th class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                المستخدم\n              </th>\n              <th class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                البريد الإلكتروني\n              </th>\n              <th class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                الدور\n              </th>\n              <th class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                الحالة\n              </th>\n              <th class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                تاريخ التسجيل\n              </th>\n              <th class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                الإجراءات\n              </th>\n            </tr>\n          </thead>\n          <tbody class=\"bg-white divide-y divide-gray-200\">\n            <tr v-for=\"user in filteredUsers\" :key=\"user.id\" class=\"hover:bg-gray-50\">\n              <!-- معلومات المستخدم -->\n              <td class=\"px-6 py-4 whitespace-nowrap\">\n                <div class=\"flex items-center\">\n                  <div class=\"flex-shrink-0 h-10 w-10\">\n                    <div class=\"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center\">\n                      <Icon name=\"material-symbols:person\" class=\"h-6 w-6 text-gray-600\" />\n                    </div>\n                  </div>\n                  <div class=\"mr-4\">\n                    <div class=\"text-sm font-medium text-gray-900\">{{ user.full_name || user.name || 'غير محدد' }}</div>\n                    <div class=\"text-sm text-gray-500\">{{ user.phone || 'لا يوجد رقم هاتف' }}</div>\n                  </div>\n                </div>\n              </td>\n\n              <!-- البريد الإلكتروني -->\n              <td class=\"px-6 py-4 whitespace-nowrap\">\n                <div class=\"text-sm text-gray-900\">{{ user.email }}</div>\n                <div class=\"text-sm text-gray-500\">\n                  {{ user.email_verified ? 'مؤكد' : 'غير مؤكد' }}\n                </div>\n              </td>\n\n              <!-- الدور -->\n              <td class=\"px-6 py-4 whitespace-nowrap\">\n                <span :class=\"getRoleColor(user.role)\" class=\"px-2 py-1 text-xs font-medium rounded-full\">\n                  {{ getRoleName(user.role) }}\n                </span>\n              </td>\n\n              <!-- الحالة -->\n              <td class=\"px-6 py-4 whitespace-nowrap\">\n                <span :class=\"getStatusColor(user.status)\" class=\"px-2 py-1 text-xs font-medium rounded-full\">\n                  {{ getStatusName(user.status) }}\n                </span>\n              </td>\n\n              <!-- تاريخ التسجيل -->\n              <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                {{ formatDate(user.created_at) }}\n              </td>\n\n              <!-- الإجراءات -->\n              <td class=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                <div class=\"flex items-center space-x-2 space-x-reverse\">\n                  <NuxtLink\n                    :to=\"`/admin/users/${user.id}`\"\n                    class=\"text-blue-600 hover:text-blue-900 p-1 rounded\"\n                    title=\"عرض\"\n                  >\n                    <Icon name=\"material-symbols:visibility\" class=\"h-4 w-4\" />\n                  </NuxtLink>\n                  <NuxtLink\n                    :to=\"`/admin/users/${user.id}/edit`\"\n                    class=\"text-green-600 hover:text-green-900 p-1 rounded\"\n                    title=\"تحرير\"\n                  >\n                    <Icon name=\"material-symbols:edit\" class=\"h-4 w-4\" />\n                  </NuxtLink>\n                  <button\n                    @click=\"toggleUserStatus(user)\"\n                    :class=\"user.status === 'active' ? 'text-orange-600 hover:text-orange-900' : 'text-green-600 hover:text-green-900'\"\n                    class=\"p-1 rounded\"\n                    :title=\"user.status === 'active' ? 'إلغاء التفعيل' : 'تفعيل'\"\n                  >\n                    <Icon :name=\"user.status === 'active' ? 'material-symbols:pause' : 'material-symbols:play-arrow'\" class=\"h-4 w-4\" />\n                  </button>\n                  <button\n                    @click=\"deleteUser(user)\"\n                    class=\"text-red-600 hover:text-red-900 p-1 rounded\"\n                    title=\"حذف\"\n                  >\n                    <Icon name=\"material-symbols:delete\" class=\"h-4 w-4\" />\n                  </button>\n                </div>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n\n      <!-- حالة عدم وجود بيانات -->\n      <div v-else class=\"text-center py-12\">\n        <Icon name=\"material-symbols:people\" class=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n        <h3 class=\"text-lg font-medium text-gray-900 mb-2\">لا يوجد مستخدمون</h3>\n        <p class=\"text-gray-500 mb-6\">لم يتم العثور على أي مستخدمين</p>\n        <NuxtLink\n          to=\"/admin/users/create\"\n          class=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n        >\n          <Icon name=\"material-symbols:add\" class=\"h-5 w-5 ml-2\" />\n          إضافة مستخدم جديد\n        </NuxtLink>\n      </div>\n    </div>\n\n    <!-- التصفح -->\n    <div v-if=\"totalPages > 1\" class=\"flex items-center justify-between\">\n      <div class=\"text-sm text-gray-700\">\n        عرض {{ (currentPage - 1) * itemsPerPage + 1 }} إلى {{ Math.min(currentPage * itemsPerPage, totalItems) }} من أصل {{ totalItems }} مستخدم\n      </div>\n      <div class=\"flex space-x-1 space-x-reverse\">\n        <button\n          @click=\"currentPage = Math.max(1, currentPage - 1)\"\n          :disabled=\"currentPage === 1\"\n          class=\"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          السابق\n        </button>\n        <span class=\"px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md\">\n          {{ currentPage }}\n        </span>\n        <button\n          @click=\"currentPage = Math.min(totalPages, currentPage + 1)\"\n          :disabled=\"currentPage === totalPages\"\n          class=\"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          التالي\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\n// إعداد الصفحة\ndefinePageMeta({\n  layout: 'admin',\n  middleware: 'admin'\n})\n\n// استخدام composable المستخدمين\nconst {\n  users,\n  isLoading,\n  error,\n  userStats,\n  fetchUsers,\n  deleteUser,\n  toggleUserStatus,\n  getRoleName,\n  getRoleColor,\n  getStatusName,\n  getStatusColor,\n  formatDate\n} = useUsers()\n\n// المتغيرات التفاعلية\nconst searchQuery = ref('')\nconst statusFilter = ref('')\nconst roleFilter = ref('')\nconst dateFilter = ref('')\nconst currentPage = ref(1)\nconst itemsPerPage = 10\n\n// المتغيرات المحسوبة\nconst filteredUsers = computed(() => {\n  let filtered = users.value\n\n  // تصفية البحث\n  if (searchQuery.value) {\n    filtered = filtered.filter(user => \n      user.full_name?.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\n      user.name?.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\n      user.email.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\n      user.phone?.toLowerCase().includes(searchQuery.value.toLowerCase())\n    )\n  }\n\n  // تصفية الحالة\n  if (statusFilter.value) {\n    filtered = filtered.filter(user => user.status === statusFilter.value)\n  }\n\n  // تصفية الدور\n  if (roleFilter.value) {\n    filtered = filtered.filter(user => user.role === roleFilter.value)\n  }\n\n  // تصفية التاريخ\n  if (dateFilter.value) {\n    const now = new Date()\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())\n    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000)\n    const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000)\n\n    filtered = filtered.filter(user => {\n      const userDate = new Date(user.created_at)\n      switch (dateFilter.value) {\n        case 'today':\n          return userDate >= today\n        case 'week':\n          return userDate >= weekAgo\n        case 'month':\n          return userDate >= monthAgo\n        default:\n          return true\n      }\n    })\n  }\n\n  return filtered.slice((currentPage.value - 1) * itemsPerPage, currentPage.value * itemsPerPage)\n})\n\nconst totalItems = computed(() => {\n  let filtered = users.value\n\n  if (searchQuery.value) {\n    filtered = filtered.filter(user => \n      user.full_name?.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\n      user.name?.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\n      user.email.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\n      user.phone?.toLowerCase().includes(searchQuery.value.toLowerCase())\n    )\n  }\n\n  if (statusFilter.value) {\n    filtered = filtered.filter(user => user.status === statusFilter.value)\n  }\n\n  if (roleFilter.value) {\n    filtered = filtered.filter(user => user.role === roleFilter.value)\n  }\n\n  if (dateFilter.value) {\n    const now = new Date()\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())\n    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000)\n    const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000)\n\n    filtered = filtered.filter(user => {\n      const userDate = new Date(user.created_at)\n      switch (dateFilter.value) {\n        case 'today':\n          return userDate >= today\n        case 'week':\n          return userDate >= weekAgo\n        case 'month':\n          return userDate >= monthAgo\n        default:\n          return true\n      }\n    })\n  }\n\n  return filtered.length\n})\n\nconst totalPages = computed(() => Math.ceil(totalItems.value / itemsPerPage))\n\n// userStats is imported from useUsers() composable\n\n// تحميل المستخدمين\nconst loadUsers = async () => {\n  try {\n    await fetchUsers()\n  } catch (error) {\n    console.error('خطأ في تحميل المستخدمين:', error)\n  }\n}\n\n\n// تصدير البيانات\nconst exportUsers = () => {\n  try {\n    const { exportUsersToExcel } = useExcelExport()\n    const success = exportUsersToExcel(users.value)\n    if (success) {\n      console.log('تم تصدير المستخدمين بنجاح')\n    } else {\n      console.error('فشل في تصدير المستخدمين')\n    }\n  } catch (error) {\n    console.error('خطأ في تصدير المستخدمين:', error)\n  }\n}\n\n// دوال المساعدة\n\n// إعادة تعيين الصفحة عند تغيير الفلاتر\nwatch([searchQuery, statusFilter, roleFilter, dateFilter], () => {\n  currentPage.value = 1\n})\n\n// تحميل البيانات عند تحميل الصفحة\nonMounted(() => {\n  loadUsers()\n})\n\n// SEO والميتا\nuseHead({\n  title: 'إدارة المستخدمين - Wonder Land Admin',\n  meta: [\n    { name: 'description', content: 'إدارة وتحرير المستخدمين المسجلين' },\n    { name: 'robots', content: 'noindex, nofollow' }\n  ]\n})\n</script>\n"],"names":["itemsPerPage","users","isLoading","userStats","getRoleName","getRoleColor","getStatusName","getStatusColor","formatDate","useUsers","searchQuery","ref","statusFilter","roleFilter","dateFilter","currentPage","filteredUsers","computed","filtered","user","_a","_b","_c","now","today","weekAgo","monthAgo","userDate","totalItems","totalPages","exportUsers","exportUsersToExcel","useExcelExport","error","watch","useHead"],"mappings":"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"}