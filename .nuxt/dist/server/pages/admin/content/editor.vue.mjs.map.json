{"file":"editor.vue.mjs","mappings":"2hBA4KA,MAAMA,EAAiBC,EAAI,EAAE,EACvBC,EAAcD,EAAI,EAAK,EACvBE,EAASF,EAAI,EAAK,EAClBG,EAAkBH,EAAI,EAAE,EAGxBI,EAAsBJ,EAAI,CAC9B,CACE,KAAM,mBACN,WAAY,CACV,CACE,KAAM,OACN,KAAM,YACN,KAAM,yBACN,MAAO,CACL,MAAO,2BACP,SAAU,8BACV,gBAAiB,sBACjB,WAAY,aACZ,WAAY,WACb,CACF,EACD,CACE,KAAM,QACN,KAAM,SACN,KAAM,wBACN,MAAO,CACL,MAAO,SACP,QAAS,qDACT,MAAO,mBACR,CACF,EACD,CACE,KAAM,WACN,KAAM,UACN,KAAM,gCACN,MAAO,CACL,MAAO,UACP,SAAU;AAAA;AAAA;AAAA,UACX,CACF,EACD,CACE,KAAM,UACN,KAAM,UACN,KAAM,gCACN,MAAO,CACL,MAAO,aACP,MAAO,mBACP,MAAO,sBACP,QAAS,kCACV,CACF,CACF,CACF,CACH,CAAC,EAGKK,EAAqBC,EAAS,IAC7BH,EAAgB,MAEdC,EAAoB,MAAM,IAAIG,IAAa,CAChD,GAAGA,EACH,WAAYA,EAAS,WAAW,OAAOC,GACrCA,EAAK,KAAK,SAASL,EAAgB,KAAK,GACxCK,EAAK,KAAK,SAASL,EAAgB,KAAK,CACzC,CACL,EAAI,EAAE,OAAOI,GAAYA,EAAS,WAAW,OAAS,CAAC,EARlBH,EAAoB,KASxD,EAuND,OAAAK,EAAQ,CACN,MAAO,mCACP,KAAM,CACJ,CAAE,KAAM,cAAe,QAAS,wCAA0C,EAC1E,CAAE,KAAM,SAAU,QAAS,mBAAqB,CACjD,CACH,CAAC","names":["pageComponents","ref","previewMode","saving","componentSearch","componentCategories","filteredCategories","computed","category","comp","useHead"],"sources":["../../../../../../pages/admin/content/editor.vue"],"sourcesContent":["<template>\r\n  <div class=\"min-h-screen bg-gray-50\">\r\n    <!-- Header -->\r\n    <div class=\"bg-white shadow-sm border-b\">\r\n      <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n        <div class=\"flex justify-between items-center py-4\">\r\n          <div class=\"flex items-center\">\r\n            <h1 class=\"text-2xl font-bold text-gray-900\">محرر المحتوى</h1>\r\n          </div>\r\n          <div class=\"flex items-center space-x-4 space-x-reverse\">\r\n            <button\r\n              @click=\"savePage\"\r\n              :disabled=\"saving\"\r\n              class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors flex items-center\"\r\n            >\r\n              <Icon v-if=\"saving\" name=\"material-symbols:progress-activity\" class=\"animate-spin h-4 w-4 ml-2\" />\r\n              <Icon v-else name=\"material-symbols:save\" class=\"h-4 w-4 ml-2\" />\r\n              {{ saving ? 'جاري الحفظ...' : 'حفظ' }}\r\n            </button>\r\n            <button\r\n              @click=\"publishPage\"\r\n              :disabled=\"saving\"\r\n              class=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors flex items-center\"\r\n            >\r\n              <Icon v-if=\"saving\" name=\"material-symbols:progress-activity\" class=\"animate-spin h-4 w-4 ml-2\" />\r\n              <Icon v-else name=\"material-symbols:publish\" class=\"h-4 w-4 ml-2\" />\r\n              {{ saving ? 'جاري النشر...' : 'نشر' }}\r\n            </button>\r\n            <button\r\n              @click=\"togglePreview\"\r\n              class=\"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center\"\r\n            >\r\n              <Icon name=\"material-symbols:visibility\" class=\"h-4 w-4 ml-2\" />\r\n              {{ previewMode ? 'تحرير' : 'معاينة' }}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Main Content -->\r\n    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n      <div class=\"grid grid-cols-1 lg:grid-cols-4 gap-8\">\r\n        \r\n        <!-- Components Sidebar -->\r\n        <div class=\"lg:col-span-1\">\r\n          <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n            <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">المكونات</h2>\r\n            \r\n            <!-- Search -->\r\n            <div class=\"mb-4\">\r\n              <input\r\n                v-model=\"componentSearch\"\r\n                type=\"text\"\r\n                placeholder=\"البحث في المكونات...\"\r\n                class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              />\r\n            </div>\r\n\r\n            <!-- Component Categories -->\r\n            <div class=\"space-y-4\">\r\n              <div v-for=\"category in filteredCategories\" :key=\"category.name\" class=\"space-y-2\">\r\n                <h3 class=\"text-sm font-medium text-gray-700\">{{ category.name }}</h3>\r\n                <div class=\"space-y-1\">\r\n                  <button\r\n                    v-for=\"component in category.components\"\r\n                    :key=\"component.type\"\r\n                    @click=\"addComponent(component)\"\r\n                    class=\"w-full text-right px-3 py-2 text-sm bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors flex items-center justify-between\"\r\n                  >\r\n                    <Icon :name=\"component.icon\" class=\"h-4 w-4\" />\r\n                    {{ component.name }}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Editor Area -->\r\n        <div class=\"lg:col-span-3\">\r\n          <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 min-h-96\">\r\n            \r\n            <!-- Preview Mode -->\r\n            <div v-if=\"previewMode\" class=\"p-6\">\r\n              <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">معاينة الصفحة</h2>\r\n              <div class=\"prose max-w-none\">\r\n                <div v-for=\"(comp, index) in pageComponents\" :key=\"index\" class=\"mb-6\">\r\n                  <div class=\"text-center py-8 border border-gray-200 rounded-lg\">\r\n                    <p class=\"text-lg font-medium\">{{ comp.type }}</p>\r\n                    <p class=\"text-sm text-gray-500\">مكون محمل من قاعدة البيانات</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Edit Mode -->\r\n            <div v-else class=\"p-6\">\r\n              <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">تحرير الصفحة</h2>\r\n              \r\n              <!-- Empty State -->\r\n              <div v-if=\"pageComponents.length === 0\" class=\"text-center py-12\">\r\n                <Icon name=\"material-symbols:add-box\" class=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\r\n                <h3 class=\"text-lg font-medium text-gray-900 mb-2\">ابدأ بإنشاء صفحتك</h3>\r\n                <p class=\"text-gray-500 mb-6\">اسحب المكونات من الشريط الجانبي لبدء التصميم</p>\r\n                <button\r\n                  @click=\"addDefaultComponents\"\r\n                  class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n                >\r\n                  إضافة مكونات افتراضية\r\n                </button>\r\n              </div>\r\n\r\n              <!-- Components -->\r\n              <div v-else class=\"space-y-4\">\r\n                <div v-for=\"(comp, index) in pageComponents\" :key=\"index\" class=\"border border-gray-200 rounded-lg p-4\">\r\n                  <div class=\"flex justify-between items-center mb-2\">\r\n                    <h4 class=\"font-medium text-gray-900\">{{ comp.type }}</h4>\r\n                    <div class=\"flex space-x-2 space-x-reverse\">\r\n                      <button\r\n                        @click=\"moveComponent(index, 'up')\"\r\n                        :disabled=\"index === 0\"\r\n                        class=\"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50\"\r\n                        title=\"نقل لأعلى\"\r\n                      >\r\n                        <Icon name=\"material-symbols:keyboard-arrow-up\" class=\"h-4 w-4\" />\r\n                      </button>\r\n                      <button\r\n                        @click=\"moveComponent(index, 'down')\"\r\n                        :disabled=\"index === pageComponents.length - 1\"\r\n                        class=\"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50\"\r\n                        title=\"نقل لأسفل\"\r\n                      >\r\n                        <Icon name=\"material-symbols:keyboard-arrow-down\" class=\"h-4 w-4\" />\r\n                      </button>\r\n                      <button\r\n                        @click=\"duplicateComponent(index)\"\r\n                        class=\"p-1 text-blue-400 hover:text-blue-600\"\r\n                        title=\"نسخ\"\r\n                      >\r\n                        <Icon name=\"material-symbols:content-copy\" class=\"h-4 w-4\" />\r\n                      </button>\r\n                      <button\r\n                        @click=\"deleteComponent(index)\"\r\n                        class=\"p-1 text-red-400 hover:text-red-600\"\r\n                        title=\"حذف\"\r\n                      >\r\n                        <Icon name=\"material-symbols:delete\" class=\"h-4 w-4\" />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"text-center py-4 bg-gray-50 rounded\">\r\n                    <p class=\"text-sm text-gray-600\">{{ comp.type }} - مكون محمل من قاعدة البيانات</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n// إعداد الصفحة\r\ndefinePageMeta({\r\n  layout: 'admin',\r\n  middleware: 'admin'\r\n})\r\n\r\n// المتغيرات التفاعلية\r\nconst pageComponents = ref([])\r\nconst previewMode = ref(false)\r\nconst saving = ref(false)\r\nconst componentSearch = ref('')\r\n\r\n// تعريف المكونات المتاحة\r\nconst componentCategories = ref([\r\n  {\r\n    name: 'العناصر الأساسية',\r\n    components: [\r\n      {\r\n        type: 'hero',\r\n        name: 'قسم البطل',\r\n        icon: 'material-symbols:image',\r\n        props: {\r\n          title: 'مرحباً بك في Wonder Land',\r\n          subtitle: 'اكتشف أجمل الوجهات السياحية',\r\n          backgroundImage: '/images/hero-bg.jpg',\r\n          buttonText: 'اكتشف الآن',\r\n          buttonLink: '/packages'\r\n        }\r\n      },\r\n      {\r\n        type: 'about',\r\n        name: 'من نحن',\r\n        icon: 'material-symbols:info',\r\n        props: {\r\n          title: 'من نحن',\r\n          content: 'نحن وكالة سفر رائدة في المملكة العربية السعودية...',\r\n          image: '/images/about.jpg'\r\n        }\r\n      },\r\n      {\r\n        type: 'services',\r\n        name: 'الخدمات',\r\n        icon: 'material-symbols:room-service',\r\n        props: {\r\n          title: 'خدماتنا',\r\n          services: 'حج وعمرة\\nرحلات سياحية\\nتذاكر طيران\\nحجز فنادق'\r\n        }\r\n      },\r\n      {\r\n        type: 'contact',\r\n        name: 'التواصل',\r\n        icon: 'material-symbols:contact-mail',\r\n        props: {\r\n          title: 'تواصل معنا',\r\n          phone: '+966 50 123 4567',\r\n          email: 'info@wonderland.com',\r\n          address: 'الرياض، المملكة العربية السعودية'\r\n        }\r\n      }\r\n    ]\r\n  }\r\n])\r\n\r\n// المكونات المفلترة\r\nconst filteredCategories = computed(() => {\r\n  if (!componentSearch.value) return componentCategories.value\r\n  \r\n  return componentCategories.value.map(category => ({\r\n    ...category,\r\n    components: category.components.filter(comp => \r\n      comp.name.includes(componentSearch.value) || \r\n      comp.type.includes(componentSearch.value)\r\n    )\r\n  })).filter(category => category.components.length > 0)\r\n})\r\n\r\n// إضافة مكون\r\nconst addComponent = (componentTemplate) => {\r\n  const newComponent = {\r\n    id: Date.now(),\r\n    type: componentTemplate.type,\r\n    props: { ...componentTemplate.props },\r\n    classes: 'mb-6'\r\n  }\r\n  pageComponents.value.push(newComponent)\r\n}\r\n\r\n// إضافة مكونات افتراضية\r\nconst addDefaultComponents = () => {\r\n  const defaultComponents = [\r\n    {\r\n      type: 'hero',\r\n      props: {\r\n        title: 'مرحباً بك في Wonder Land',\r\n        subtitle: 'اكتشف أجمل الوجهات السياحية',\r\n        backgroundImage: '/images/hero-bg.jpg',\r\n        buttonText: 'اكتشف الآن',\r\n        buttonLink: '/packages'\r\n      }\r\n    },\r\n    {\r\n      type: 'about',\r\n      props: {\r\n        title: 'من نحن',\r\n        content: 'نحن وكالة سفر رائدة في المملكة العربية السعودية...',\r\n        image: '/images/about.jpg'\r\n      }\r\n    }\r\n  ]\r\n  \r\n  defaultComponents.forEach(componentTemplate => {\r\n    addComponent(componentTemplate)\r\n  })\r\n}\r\n\r\n// نقل مكون\r\nconst moveComponent = (index, direction) => {\r\n  if (direction === 'up' && index > 0) {\r\n    const temp = pageComponents.value[index]\r\n    pageComponents.value[index] = pageComponents.value[index - 1]\r\n    pageComponents.value[index - 1] = temp\r\n  } else if (direction === 'down' && index < pageComponents.value.length - 1) {\r\n    const temp = pageComponents.value[index]\r\n    pageComponents.value[index] = pageComponents.value[index + 1]\r\n    pageComponents.value[index + 1] = temp\r\n  }\r\n}\r\n\r\n// حذف مكون\r\nconst deleteComponent = (index) => {\r\n  pageComponents.value.splice(index, 1)\r\n}\r\n\r\n// تبديل المعاينة\r\nconst togglePreview = () => {\r\n  previewMode.value = !previewMode.value\r\n}\r\n\r\n// حفظ الصفحة\r\nconst savePage = async () => {\r\n  try {\r\n    saving.value = true\r\n    const route = useRoute()\r\n    const pageId = route.query.page\r\n    \r\n    const pageData = {\r\n      title_ar: 'صفحة جديدة',\r\n      title_en: 'New Page',\r\n      content_ar: '',\r\n      content_en: '',\r\n      components: pageComponents.value,\r\n      status: 'draft',\r\n      template: 'default'\r\n    }\r\n    \r\n    if (pageId) {\r\n      // تحديث صفحة موجودة\r\n      const response = await $fetch(`/api/cms/editor/${pageId}`, {\r\n        method: 'PUT',\r\n        body: pageData\r\n      })\r\n      \r\n      if (response.success) {\r\n        console.log('Page saved successfully')\r\n        await navigateTo(`/admin/content/editor?page=${pageId}`)\r\n      }\r\n    } else {\r\n      // إنشاء صفحة جديدة\r\n      const response = await $fetch('/api/cms/editor', {\r\n        method: 'POST',\r\n        body: pageData\r\n      })\r\n      \r\n      if (response.success) {\r\n        console.log('Page created successfully')\r\n        await navigateTo(`/admin/content/editor?page=${response.id}`)\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Error saving page:', error)\r\n  } finally {\r\n    saving.value = false\r\n  }\r\n}\r\n\r\n// نشر الصفحة\r\nconst publishPage = async () => {\r\n  try {\r\n    saving.value = true\r\n    const route = useRoute()\r\n    const pageId = route.query.page\r\n    \r\n    const pageData = {\r\n      title_ar: 'صفحة جديدة',\r\n      title_en: 'New Page',\r\n      content_ar: '',\r\n      content_en: '',\r\n      components: pageComponents.value,\r\n      status: 'published',\r\n      template: 'default'\r\n    }\r\n    \r\n    if (pageId) {\r\n      // تحديث صفحة موجودة ونشرها\r\n      const response = await $fetch(`/api/cms/editor/${pageId}`, {\r\n        method: 'PUT',\r\n        body: pageData\r\n      })\r\n      \r\n      if (response.success) {\r\n        console.log('Page published successfully')\r\n        await navigateTo(`/admin/content/editor?page=${pageId}`)\r\n      }\r\n    } else {\r\n      // إنشاء صفحة جديدة ونشرها\r\n      const response = await $fetch('/api/cms/editor', {\r\n        method: 'POST',\r\n        body: pageData\r\n      })\r\n      \r\n      if (response.success) {\r\n        console.log('Page created and published successfully')\r\n        await navigateTo(`/admin/content/editor?page=${response.id}`)\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Error publishing page:', error)\r\n  } finally {\r\n    saving.value = false\r\n  }\r\n}\r\n\r\n// تحميل الصفحة الحالية\r\nconst loadCurrentPage = async () => {\r\n  const route = useRoute()\r\n  const pageId = route.query.page\r\n  \r\n  if (pageId) {\r\n    try {\r\n      console.log('Loading page with ID:', pageId)\r\n      const response = await $fetch(`/api/cms/editor/${pageId}`)\r\n      console.log('API Response:', response)\r\n      \r\n      if (response.success && response.page) {\r\n        // تحميل المكونات الموجودة\r\n        if (response.page.components && Array.isArray(response.page.components) && response.page.components.length > 0) {\r\n          console.log('Loading existing components:', response.page.components)\r\n          pageComponents.value = response.page.components\r\n        } else {\r\n          console.log('No components found, adding default components')\r\n          // إذا لم تكن هناك مكونات، أضف مكونات افتراضية\r\n          addDefaultComponents()\r\n        }\r\n      } else {\r\n        console.log('No page data found, adding default components')\r\n        addDefaultComponents()\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading page:', error)\r\n      addDefaultComponents()\r\n    }\r\n  } else {\r\n    // صفحة جديدة - تحقق من وجود قالب\r\n    const templateId = route.query.template\r\n    if (templateId) {\r\n      console.log('Loading template:', templateId)\r\n      addDefaultComponents()\r\n    }\r\n  }\r\n}\r\n\r\n// نسخ المكون\r\nconst duplicateComponent = (index) => {\r\n  if (index >= 0 && index < pageComponents.value.length) {\r\n    const originalComponent = pageComponents.value[index]\r\n    const duplicatedComponent = {\r\n      ...originalComponent,\r\n      id: Date.now() + Math.random() // إنشاء معرف فريد\r\n    }\r\n    pageComponents.value.splice(index + 1, 0, duplicatedComponent)\r\n  }\r\n}\r\n\r\n// تحميل البيانات عند تحميل الصفحة\r\nonMounted(() => {\r\n  loadCurrentPage()\r\n})\r\n\r\n// SEO والميتا\r\nuseHead({\r\n  title: 'محرر المحتوى - Wonder Land Admin',\r\n  meta: [\r\n    { name: 'description', content: 'محرر محتوى متقدم لإنشاء وتعديل الصفحات' },\r\n    { name: 'robots', content: 'noindex, nofollow' }\r\n  ]\r\n})\r\n</script>"],"version":3}