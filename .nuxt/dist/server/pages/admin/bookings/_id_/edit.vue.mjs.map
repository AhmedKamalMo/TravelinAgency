{"version":3,"file":"edit.vue.mjs","sources":["../../../../../../../pages/admin/bookings/[id]/edit.vue"],"sourcesContent":["<template>\r\n  <div class=\"space-y-6\">\r\n    <!-- مساحة إضافية في الأعلى -->\r\n    <div class=\"h-16\"></div>\r\n    \r\n    <!-- رأس الصفحة -->\r\n    <div class=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\r\n      <div>\r\n        <h1 class=\"text-2xl font-bold text-gray-900\">تحرير الحجز</h1>\r\n        <p class=\"mt-1 text-sm text-gray-600\">تعديل تفاصيل الحجز</p>\r\n      </div>\r\n      <div class=\"mt-4 sm:mt-0 flex space-x-3 space-x-reverse\">\r\n        <NuxtLink\r\n          :to=\"`/admin/bookings/${bookingId}`\"\r\n          class=\"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors\"\r\n        >\r\n          <Icon name=\"material-symbols:visibility\" class=\"h-5 w-5 ml-2\" />\r\n          عرض\r\n        </NuxtLink>\r\n        <NuxtLink\r\n          to=\"/admin/bookings\"\r\n          class=\"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors\"\r\n        >\r\n          <Icon name=\"material-symbols:arrow-back\" class=\"h-5 w-5 ml-2\" />\r\n          العودة\r\n        </NuxtLink>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- حالة التحميل -->\r\n    <div v-if=\"loading\" class=\"flex justify-center items-center py-12\">\r\n      <Icon name=\"material-symbols:progress-activity\" class=\"animate-spin h-8 w-8 text-blue-600\" />\r\n      <span class=\"mr-3 text-gray-600\">جارٍ تحميل الحجز...</span>\r\n    </div>\r\n\r\n    <!-- نموذج التحرير -->\r\n    <form v-else @submit.prevent=\"updateBooking\" class=\"space-y-6\">\r\n      <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n        <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          <!-- العمود الرئيسي -->\r\n          <div class=\"lg:col-span-2 space-y-6\">\r\n            <!-- معلومات العميل -->\r\n            <div>\r\n              <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">معلومات العميل</h2>\r\n              <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">اسم العميل *</label>\r\n                  <input\r\n                    v-model=\"form.customer_name\"\r\n                    type=\"text\"\r\n                    required\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"أدخل اسم العميل\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">البريد الإلكتروني *</label>\r\n                  <input\r\n                    v-model=\"form.customer_email\"\r\n                    type=\"email\"\r\n                    required\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"أدخل البريد الإلكتروني\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">رقم الهاتف *</label>\r\n                  <input\r\n                    v-model=\"form.customer_phone\"\r\n                    type=\"tel\"\r\n                    required\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"+966501234567\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">عدد الضيوف *</label>\r\n                  <input\r\n                    v-model.number=\"form.guests_count\"\r\n                    type=\"number\"\r\n                    min=\"1\"\r\n                    required\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- تفاصيل الباقة -->\r\n            <div>\r\n              <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">تفاصيل الباقة</h2>\r\n              <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">اختيار الباقة *</label>\r\n                  <select\r\n                    v-model=\"form.package_id\"\r\n                    required\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    @change=\"onPackageChange\"\r\n                  >\r\n                    <option value=\"\">اختر الباقة</option>\r\n                    <option v-for=\"pkg in packages\" :key=\"pkg.id\" :value=\"pkg.id\">\r\n                      {{ pkg.title_ar || pkg.title_en || pkg.title }} - {{ formatPrice(pkg.price) }}\r\n                    </option>\r\n                  </select>\r\n                </div>\r\n                <div v-if=\"selectedPackage\">\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">مدة الرحلة</label>\r\n                  <input\r\n                    :value=\"selectedPackage.duration_days + ' أيام'\"\r\n                    type=\"text\"\r\n                    readonly\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">تاريخ المغادرة *</label>\r\n                  <input\r\n                    v-model=\"form.departure_date\"\r\n                    type=\"date\"\r\n                    required\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">تاريخ العودة</label>\r\n                  <input\r\n                    v-model=\"form.return_date\"\r\n                    type=\"date\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              <!-- عرض تفاصيل الباقة المختارة -->\r\n              <div v-if=\"selectedPackage\" class=\"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200\">\r\n                <h3 class=\"text-sm font-medium text-blue-900 mb-2\">تفاصيل الباقة المختارة</h3>\r\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-800\">\r\n                  <div>\r\n                    <span class=\"font-medium\">العنوان:</span> {{ selectedPackage.title_ar || selectedPackage.title_en || selectedPackage.title }}\r\n                  </div>\r\n                  <div>\r\n                    <span class=\"font-medium\">السعر:</span> {{ formatPrice(selectedPackage.price) }}\r\n                  </div>\r\n                  <div>\r\n                    <span class=\"font-medium\">المدة:</span> {{ selectedPackage.duration_days }} أيام\r\n                  </div>\r\n                  <div>\r\n                    <span class=\"font-medium\">الوجهة:</span> {{ selectedPackage.location || selectedPackage.travel_period }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- تفاصيل الدفع -->\r\n            <div>\r\n              <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">تفاصيل الدفع</h2>\r\n              <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">المبلغ الإجمالي *</label>\r\n                  <input\r\n                    v-model.number=\"form.total_amount\"\r\n                    type=\"number\"\r\n                    min=\"0\"\r\n                    step=\"0.01\"\r\n                    required\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"0.00\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">المبلغ المدفوع</label>\r\n                  <input\r\n                    v-model.number=\"form.paid_amount\"\r\n                    type=\"number\"\r\n                    min=\"0\"\r\n                    step=\"0.01\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"0.00\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">العملة</label>\r\n                  <select\r\n                    v-model=\"form.currency\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  >\r\n                    <option value=\"SAR\">ريال سعودي (SAR)</option>\r\n                    <option value=\"USD\">دولار أمريكي (USD)</option>\r\n                    <option value=\"EUR\">يورو (EUR)</option>\r\n                    <option value=\"AED\">درهم إماراتي (AED)</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">طريقة الدفع</label>\r\n                  <select\r\n                    v-model=\"form.payment_method\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  >\r\n                    <option value=\"\">اختر طريقة الدفع</option>\r\n                    <option value=\"cash\">نقداً</option>\r\n                    <option value=\"bank_transfer\">تحويل بنكي</option>\r\n                    <option value=\"credit_card\">بطاقة ائتمان</option>\r\n                    <option value=\"online\">دفع إلكتروني</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">مرجع الدفع</label>\r\n                  <input\r\n                    v-model=\"form.payment_reference\"\r\n                    type=\"text\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"رقم المرجع أو المعاملة\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- طلبات خاصة وملاحظات -->\r\n            <div>\r\n              <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">طلبات خاصة وملاحظات</h2>\r\n              <div class=\"space-y-4\">\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">طلبات خاصة</label>\r\n                  <textarea\r\n                    v-model=\"form.special_requests\"\r\n                    rows=\"3\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"أي طلبات خاصة من العميل\"\r\n                  ></textarea>\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">ملاحظات إدارية</label>\r\n                  <textarea\r\n                    v-model=\"form.notes\"\r\n                    rows=\"3\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"ملاحظات إدارية أو تفاصيل إضافية\"\r\n                  ></textarea>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- العمود الجانبي -->\r\n          <div class=\"space-y-6\">\r\n            <!-- حالة الحجز -->\r\n            <div class=\"bg-gray-50 rounded-lg p-4\">\r\n              <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">حالة الحجز</h3>\r\n              <div class=\"space-y-4\">\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">حالة الحجز *</label>\r\n                  <select\r\n                    v-model=\"form.booking_status\"\r\n                    required\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  >\r\n                    <option value=\"pending\">في الانتظار</option>\r\n                    <option value=\"confirmed\">مؤكدة</option>\r\n                    <option value=\"cancelled\">ملغية</option>\r\n                    <option value=\"completed\">مكتملة</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">حالة الدفع *</label>\r\n                  <select\r\n                    v-model=\"form.payment_status\"\r\n                    required\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  >\r\n                    <option value=\"pending\">في الانتظار</option>\r\n                    <option value=\"partial\">مدفوع جزئياً</option>\r\n                    <option value=\"paid\">مدفوع بالكامل</option>\r\n                    <option value=\"refunded\">مسترد</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- ملخص الحجز -->\r\n            <div class=\"bg-blue-50 rounded-lg border border-blue-200 p-4\">\r\n              <h3 class=\"text-lg font-semibold text-blue-900 mb-3\">ملخص الحجز</h3>\r\n              <div class=\"space-y-2 text-sm text-blue-800\">\r\n                <div class=\"flex justify-between\">\r\n                  <span>العميل:</span>\r\n                  <span>{{ form.customer_name || 'غير محدد' }}</span>\r\n                </div>\r\n                <div class=\"flex justify-between\">\r\n                  <span>عدد الضيوف:</span>\r\n                  <span>{{ form.guests_count || 0 }}</span>\r\n                </div>\r\n                <div class=\"flex justify-between\">\r\n                  <span>تاريخ المغادرة:</span>\r\n                  <span>{{ form.departure_date || 'غير محدد' }}</span>\r\n                </div>\r\n                <div class=\"flex justify-between\">\r\n                  <span>المبلغ الإجمالي:</span>\r\n                  <span>{{ formatPrice(form.total_amount) }}</span>\r\n                </div>\r\n                <div class=\"flex justify-between\">\r\n                  <span>المبلغ المدفوع:</span>\r\n                  <span>{{ formatPrice(form.paid_amount) }}</span>\r\n                </div>\r\n                <div class=\"flex justify-between\">\r\n                  <span>المتبقي:</span>\r\n                  <span>{{ formatPrice(form.total_amount - form.paid_amount) }}</span>\r\n                </div>\r\n                <div class=\"flex justify-between\">\r\n                  <span>حالة الحجز:</span>\r\n                  <span>{{ getStatusName(form.booking_status) }}</span>\r\n                </div>\r\n                <div class=\"flex justify-between\">\r\n                  <span>حالة الدفع:</span>\r\n                  <span>{{ getPaymentStatusName(form.payment_status) }}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- معلومات إضافية -->\r\n            <div class=\"bg-gray-50 rounded-lg p-4\">\r\n              <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">معلومات إضافية</h3>\r\n              <div class=\"space-y-3\">\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">رقم الحجز</label>\r\n                  <input\r\n                    v-model=\"form.booking_number\"\r\n                    type=\"text\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"رقم الحجز\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">تاريخ التأكيد</label>\r\n                  <input\r\n                    v-model=\"form.confirmed_at\"\r\n                    type=\"datetime-local\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  />\r\n                </div>\r\n                <div v-if=\"form.booking_status === 'cancelled'\">\r\n                  <label class=\"block text-sm font-medium text-gray-700 mb-2\">سبب الإلغاء</label>\r\n                  <textarea\r\n                    v-model=\"form.cancellation_reason\"\r\n                    rows=\"2\"\r\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"سبب إلغاء الحجز\"\r\n                  ></textarea>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- أزرار الإجراءات -->\r\n        <div class=\"flex justify-end space-x-3 space-x-reverse pt-6 border-t border-gray-200\">\r\n          <NuxtLink\r\n            :to=\"`/admin/bookings/${bookingId}`\"\r\n            class=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n          >\r\n            إلغاء\r\n          </NuxtLink>\r\n          <button\r\n            type=\"submit\"\r\n            :disabled=\"saving || !isFormValid\"\r\n            class=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\r\n          >\r\n            <Icon v-if=\"saving\" name=\"material-symbols:progress-activity\" class=\"animate-spin h-4 w-4 ml-2 inline\" />\r\n            {{ saving ? 'جاري الحفظ...' : 'حفظ التغييرات' }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n// إعداد الصفحة\r\ndefinePageMeta({\r\n  layout: 'admin',\r\n  middleware: 'admin'\r\n})\r\n\r\n// الحصول على معرف الحجز من الرابط\r\nconst route = useRoute()\r\nconst bookingId = route.params.id\r\n\r\n// المتغيرات التفاعلية\r\nconst loading = ref(true)\r\nconst saving = ref(false)\r\nconst packages = ref([])\r\nconst selectedPackage = ref(null)\r\n\r\n// نموذج البيانات\r\nconst form = ref({\r\n  customer_name: '',\r\n  customer_email: '',\r\n  customer_phone: '',\r\n  package_id: '',\r\n  guests_count: 1,\r\n  departure_date: '',\r\n  return_date: '',\r\n  total_amount: 0,\r\n  paid_amount: 0,\r\n  currency: 'SAR',\r\n  payment_method: '',\r\n  payment_reference: '',\r\n  booking_status: 'pending',\r\n  payment_status: 'pending',\r\n  special_requests: '',\r\n  notes: '',\r\n  booking_number: '',\r\n  confirmed_at: '',\r\n  cancellation_reason: ''\r\n})\r\n\r\n// التحقق من صحة النموذج\r\nconst isFormValid = computed(() => {\r\n  return form.value.customer_name && \r\n         form.value.customer_email && \r\n         form.value.customer_phone &&\r\n         form.value.package_id &&\r\n         form.value.departure_date &&\r\n         form.value.total_amount > 0\r\n})\r\n\r\n// تحميل الباقات\r\nconst loadPackages = async () => {\r\n  try {\r\n    const result = await $fetch('/api/packages')\r\n    packages.value = result?.data || result || []\r\n  } catch (error) {\r\n    console.error('خطأ في تحميل الباقات:', error)\r\n    packages.value = []\r\n  }\r\n}\r\n\r\n// تحميل بيانات الحجز\r\nconst loadBooking = async () => {\r\n  try {\r\n    loading.value = true\r\n    const result = await $fetch(`/api/bookings/${bookingId}`)\r\n    const bookingData = result?.data || result\r\n    \r\n    if (bookingData) {\r\n      form.value = {\r\n        customer_name: bookingData.customer_name || '',\r\n        customer_email: bookingData.customer_email || '',\r\n        customer_phone: bookingData.customer_phone || '',\r\n        package_id: bookingData.package_id || '',\r\n        guests_count: bookingData.guests_count || 1,\r\n        departure_date: bookingData.departure_date || '',\r\n        return_date: bookingData.return_date || '',\r\n        total_amount: bookingData.total_amount || 0,\r\n        paid_amount: bookingData.paid_amount || 0,\r\n        currency: bookingData.currency || 'SAR',\r\n        payment_method: bookingData.payment_method || '',\r\n        payment_reference: bookingData.payment_reference || '',\r\n        booking_status: bookingData.booking_status || 'pending',\r\n        payment_status: bookingData.payment_status || 'pending',\r\n        special_requests: bookingData.special_requests || '',\r\n        notes: bookingData.notes || '',\r\n        booking_number: bookingData.booking_number || '',\r\n        confirmed_at: bookingData.confirmed_at || '',\r\n        cancellation_reason: bookingData.cancellation_reason || ''\r\n      }\r\n      \r\n      // تحديث الباقة المختارة\r\n      onPackageChange()\r\n    }\r\n  } catch (error) {\r\n    console.error('خطأ في تحميل الحجز:', error)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// عند تغيير الباقة\r\nconst onPackageChange = () => {\r\n  selectedPackage.value = packages.value.find(pkg => pkg.id == form.value.package_id)\r\n  if (selectedPackage.value) {\r\n    // تحديث المبلغ الإجمالي بناءً على عدد الضيوف\r\n    form.value.total_amount = selectedPackage.value.price * form.value.guests_count\r\n    \r\n    // تحديث تاريخ العودة بناءً على مدة الرحلة\r\n    if (form.value.departure_date && selectedPackage.value.duration_days) {\r\n      const departureDate = new Date(form.value.departure_date)\r\n      const returnDate = new Date(departureDate)\r\n      returnDate.setDate(returnDate.getDate() + selectedPackage.value.duration_days)\r\n      form.value.return_date = returnDate.toISOString().split('T')[0]\r\n    }\r\n  }\r\n}\r\n\r\n// تحديث الحجز\r\nconst updateBooking = async () => {\r\n  try {\r\n    saving.value = true\r\n    \r\n    // تنظيف البيانات\r\n    const bookingData = {\r\n      ...form.value,\r\n      // تحويل التواريخ إلى الصيغة المطلوبة\r\n      departure_date: form.value.departure_date,\r\n      return_date: form.value.return_date || null,\r\n      confirmed_at: form.value.confirmed_at || null,\r\n      // تحويل package_id إلى رقم\r\n      package_id: parseInt(form.value.package_id)\r\n    }\r\n    \r\n    // إزالة الحقول الفارغة\r\n    Object.keys(bookingData).forEach(key => {\r\n      if (bookingData[key] === '' || bookingData[key] === null) {\r\n        delete bookingData[key]\r\n      }\r\n    })\r\n    \r\n    const result = await $fetch(`/api/bookings/${bookingId}`, {\r\n      method: 'PUT',\r\n      body: bookingData\r\n    })\r\n    \r\n    console.log('تم تحديث الحجز بنجاح:', result)\r\n    await navigateTo(`/admin/bookings/${bookingId}`)\r\n  } catch (error) {\r\n    console.error('خطأ في تحديث الحجز:', error)\r\n    // يمكن إضافة إشعار خطأ هنا\r\n  } finally {\r\n    saving.value = false\r\n  }\r\n}\r\n\r\n// دوال المساعدة\r\nconst formatPrice = (price) => {\r\n  if (!price) return '0.00 ر.س'\r\n  return new Intl.NumberFormat('ar-SA', {\r\n    style: 'currency',\r\n    currency: 'SAR'\r\n  }).format(price)\r\n}\r\n\r\nconst getStatusName = (status) => {\r\n  const statuses = {\r\n    confirmed: 'مؤكدة',\r\n    pending: 'في الانتظار',\r\n    cancelled: 'ملغية',\r\n    completed: 'مكتملة'\r\n  }\r\n  return statuses[status] || status\r\n}\r\n\r\nconst getPaymentStatusName = (status) => {\r\n  const statuses = {\r\n    paid: 'مدفوع',\r\n    partial: 'مدفوع جزئياً',\r\n    pending: 'في الانتظار',\r\n    refunded: 'مسترد'\r\n  }\r\n  return statuses[status] || status\r\n}\r\n\r\n// مراقبة تغيير عدد الضيوف لتحديث المبلغ\r\nwatch(() => form.value.guests_count, () => {\r\n  if (selectedPackage.value) {\r\n    form.value.total_amount = selectedPackage.value.price * form.value.guests_count\r\n  }\r\n})\r\n\r\n// مراقبة تغيير تاريخ المغادرة لتحديث تاريخ العودة\r\nwatch(() => form.value.departure_date, () => {\r\n  if (form.value.departure_date && selectedPackage.value?.duration_days) {\r\n    const departureDate = new Date(form.value.departure_date)\r\n    const returnDate = new Date(departureDate)\r\n    returnDate.setDate(returnDate.getDate() + selectedPackage.value.duration_days)\r\n    form.value.return_date = returnDate.toISOString().split('T')[0]\r\n  }\r\n})\r\n\r\n// تحميل البيانات عند تحميل الصفحة\r\nonMounted(async () => {\r\n  await Promise.all([loadPackages(), loadBooking()])\r\n})\r\n\r\n// SEO والميتا\r\nuseHead({\r\n  title: 'تحرير الحجز - Wonder Land Admin',\r\n  meta: [\r\n    { name: 'description', content: 'تحرير تفاصيل الحجز' },\r\n    { name: 'robots', content: 'noindex, nofollow' }\r\n  ]\r\n})\r\n</script>\r\n"],"names":["bookingId","useRoute","loading","ref","saving","packages","selectedPackage","form","isFormValid","computed","formatPrice","price","getStatusName","status","getPaymentStatusName","watch","_a","departureDate","returnDate","useHead"],"mappings":"6yBAgYM,MAAAA,EADQC,EAAS,EACC,OAAO,GAGzBC,EAAUC,EAAI,EAAI,EAClBC,EAASD,EAAI,EAAK,EAClBE,EAAWF,EAAI,EAAE,EACjBG,EAAkBH,EAAI,IAAI,EAG1BI,EAAOJ,EAAI,CACf,cAAe,GACf,eAAgB,GAChB,eAAgB,GAChB,WAAY,GACZ,aAAc,EACd,eAAgB,GAChB,YAAa,GACb,aAAc,EACd,YAAa,EACb,SAAU,MACV,eAAgB,GAChB,kBAAmB,GACnB,eAAgB,UAChB,eAAgB,UAChB,iBAAkB,GAClB,MAAO,GACP,eAAgB,GAChB,aAAc,GACd,oBAAqB,EAAA,CACtB,EAGKK,EAAcC,EAAS,IACpBF,EAAK,MAAM,eACXA,EAAK,MAAM,gBACXA,EAAK,MAAM,gBACXA,EAAK,MAAM,YACXA,EAAK,MAAM,gBACXA,EAAK,MAAM,aAAe,CAClC,EA6GKG,EAAeC,GACdA,EACE,IAAI,KAAK,aAAa,QAAS,CACpC,MAAO,WACP,SAAU,KAAA,CACX,EAAE,OAAOA,CAAK,EAJI,WAOfC,EAAiBC,IACJ,CACf,UAAW,QACX,QAAS,cACT,UAAW,QACX,UAAW,QACb,GACgBA,CAAM,GAAKA,EAGvBC,EAAwBD,IACX,CACf,KAAM,QACN,QAAS,eACT,QAAS,cACT,SAAU,OACZ,GACgBA,CAAM,GAAKA,EAI7B,OAAAE,EAAM,IAAMR,EAAK,MAAM,aAAc,IAAM,CACrCD,EAAgB,QAClBC,EAAK,MAAM,aAAeD,EAAgB,MAAM,MAAQC,EAAK,MAAM,aACrE,CACD,EAGDQ,EAAM,IAAMR,EAAK,MAAM,eAAgB,IAAM,OAC3C,GAAIA,EAAK,MAAM,kBAAkBS,EAAAV,EAAgB,QAAhB,MAAAU,EAAuB,eAAe,CACrE,MAAMC,EAAgB,IAAI,KAAKV,EAAK,MAAM,cAAc,EAClDW,EAAa,IAAI,KAAKD,CAAa,EACzCC,EAAW,QAAQA,EAAW,QAAY,EAAAZ,EAAgB,MAAM,aAAa,EACxEC,EAAA,MAAM,YAAcW,EAAW,YAAA,EAAc,MAAM,GAAG,EAAE,CAAC,CAAA,CAChE,CACD,EAQOC,EAAA,CACN,MAAO,kCACP,KAAM,CACJ,CAAE,KAAM,cAAe,QAAS,oBAAqB,EACrD,CAAE,KAAM,SAAU,QAAS,mBAAoB,CAAA,CACjD,CACD"}