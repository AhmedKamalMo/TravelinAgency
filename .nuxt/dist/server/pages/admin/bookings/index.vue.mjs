import ne from"../../../components/admin/AdminPageHeader.vue.mjs";import oe from"../../../node_modules/_nuxt/icon/dist/runtime/components/index2.mjs";import re from"../../../node_modules/nuxt/dist/app/components/nuxt-link.mjs";import ie from"../../../components/admin/AdminStats.vue.mjs";import de from"../../../components/admin/AdminFilters.vue.mjs";import ce from"../../../components/admin/AdminSearchInput.vue.mjs";import me from"../../../components/admin/AdminSelect.vue.mjs";import{ref as V,computed as p,watch as ue,mergeProps as xe,withCtx as k,createVNode as i,unref as a,isRef as C,createTextVNode as ge,useSSRContext as pe}from"vue";import{ssrRenderAttrs as ve,ssrRenderComponent as r,ssrRenderList as ye,ssrInterpolate as u,ssrRenderClass as E,ssrIncludeBooleanAttr as O}from"vue/server-renderer";import"F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import{useExcelExport as be}from"../../../composables/useExcelExport.mjs";import{useHead as fe}from"../../../node_modules/nuxt/dist/head/runtime/composables/v3.mjs";const D=10,Y={__name:"index",__ssrInlineRender:!0,setup(U){const h=V([]),A=V(!0),d=V(""),v=V(""),y=V(""),b=V(""),$=V(1),R=p(()=>{let t=h.value;if(d.value&&(t=t.filter(e=>{var s,f,w,l;return((s=e.customer_name)==null?void 0:s.toLowerCase().includes(d.value.toLowerCase()))||((f=e.customer_email)==null?void 0:f.toLowerCase().includes(d.value.toLowerCase()))||((w=e.booking_number)==null?void 0:w.toLowerCase().includes(d.value.toLowerCase()))||((l=e.package_title)==null?void 0:l.toLowerCase().includes(d.value.toLowerCase()))})),v.value&&(t=t.filter(e=>e.status===v.value)),y.value&&(t=t.filter(e=>e.payment_status===y.value)),b.value){const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),f=new Date(s.getTime()-7*24*60*60*1e3),w=new Date(s.getTime()-30*24*60*60*1e3);t=t.filter(l=>{const g=new Date(l.created_at);switch(b.value){case"today":return g>=s;case"week":return g>=f;case"month":return g>=w;default:return!0}})}return t.slice(($.value-1)*D,$.value*D)}),S=p(()=>{let t=h.value;if(d.value&&(t=t.filter(e=>{var s,f,w,l;return((s=e.customer_name)==null?void 0:s.toLowerCase().includes(d.value.toLowerCase()))||((f=e.customer_email)==null?void 0:f.toLowerCase().includes(d.value.toLowerCase()))||((w=e.booking_number)==null?void 0:w.toLowerCase().includes(d.value.toLowerCase()))||((l=e.package_title)==null?void 0:l.toLowerCase().includes(d.value.toLowerCase()))})),v.value&&(t=t.filter(e=>e.status===v.value)),y.value&&(t=t.filter(e=>e.payment_status===y.value)),b.value){const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),f=new Date(s.getTime()-7*24*60*60*1e3),w=new Date(s.getTime()-30*24*60*60*1e3);t=t.filter(l=>{const g=new Date(l.created_at);switch(b.value){case"today":return g>=s;case"week":return g>=f;case"month":return g>=w;default:return!0}})}return t.length}),P=p(()=>Math.ceil(S.value/D)),Q=p(()=>h.value.length),W=p(()=>h.value.filter(t=>t.status==="confirmed").length),q=p(()=>h.value.filter(t=>t.status==="pending").length),z=p(()=>h.value.filter(t=>t.status==="cancelled").length),G=p(()=>h.value.reduce((t,e)=>t+(e.total_amount||0),0)),J=p(()=>[{key:"total",label:"إجمالي الحجوزات",value:Q.value,icon:"material-symbols:book-online",iconBg:"bg-blue-100",iconColor:"text-blue-600"},{key:"confirmed",label:"مؤكدة",value:W.value,icon:"material-symbols:check-circle",iconBg:"bg-green-100",iconColor:"text-green-600"},{key:"pending",label:"في الانتظار",value:q.value,icon:"material-symbols:schedule",iconBg:"bg-orange-100",iconColor:"text-orange-600"},{key:"cancelled",label:"ملغية",value:z.value,icon:"material-symbols:cancel",iconBg:"bg-red-100",iconColor:"text-red-600"},{key:"revenue",label:"إجمالي المبيعات",value:M(G.value),icon:"material-symbols:attach-money",iconBg:"bg-purple-100",iconColor:"text-purple-600"}]),F=p(()=>[{value:"confirmed",label:"مؤكدة"},{value:"pending",label:"في الانتظار"},{value:"cancelled",label:"ملغية"},{value:"completed",label:"مكتملة"}]),N=p(()=>[{value:"paid",label:"مدفوع"},{value:"pending",label:"في الانتظار"},{value:"failed",label:"فشل"}]),T=p(()=>[{value:"today",label:"اليوم"},{value:"week",label:"هذا الأسبوع"},{value:"month",label:"هذا الشهر"}]),K=()=>{try{const{exportBookingsToExcel:t}=be();t(h.value)?console.log("تم تصدير الحجوزات بنجاح"):console.error("فشل في تصدير الحجوزات")}catch(t){console.error("خطأ في تصدير الحجوزات:",t)}},X=t=>new Date(t).toLocaleDateString("ar-SA"),M=t=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR"}).format(t),Z=t=>({confirmed:"مؤكدة",pending:"في الانتظار",cancelled:"ملغية",completed:"مكتملة"})[t]||t,I=t=>({confirmed:"bg-green-100 text-green-800",pending:"bg-orange-100 text-orange-800",cancelled:"bg-red-100 text-red-800",completed:"bg-blue-100 text-blue-800"})[t]||"bg-gray-100 text-gray-800",ee=t=>({paid:"مدفوع",pending:"في الانتظار",failed:"فشل"})[t]||t,te=t=>({paid:"bg-green-100 text-green-800",pending:"bg-orange-100 text-orange-800",failed:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800";return ue([d,v,y,b],()=>{$.value=1}),fe({title:"إدارة الحجوزات - Wonder Land Admin",meta:[{name:"description",content:"عرض وإدارة حجوزات العملاء"},{name:"robots",content:"noindex, nofollow"}]}),(t,e,s,f)=>{const w=ne,l=oe,g=re,ae=ie,le=de,j=ce,L=me;e(`<div${ve(xe({class:"space-y-6"},f))}><div class="h-16"></div>`),e(r(w,{title:"إدارة الحجوزات",description:"عرض وإدارة حجوزات العملاء"},{actions:k((n,c,x,m)=>{if(c)c(`<button class="inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"${m}>`),c(r(l,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,x,m)),c(`<span class="hidden sm:inline"${m}>تصدير البيانات</span><span class="sm:hidden"${m}>تصدير</span></button>`),c(r(g,{to:"/admin/bookings/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:k((o,_,se,B)=>{if(_)_(r(l,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,se,B)),_(`<span class="hidden sm:inline"${B}>إضافة حجز جديد</span><span class="sm:hidden"${B}>إضافة</span>`);else return[i(l,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),i("span",{class:"hidden sm:inline"},"إضافة حجز جديد"),i("span",{class:"sm:hidden"},"إضافة")]}),_:1},x,m));else return[i("button",{onClick:K,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[i(l,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),i("span",{class:"hidden sm:inline"},"تصدير البيانات"),i("span",{class:"sm:hidden"},"تصدير")]),i(g,{to:"/admin/bookings/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:k(()=>[i(l,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),i("span",{class:"hidden sm:inline"},"إضافة حجز جديد"),i("span",{class:"sm:hidden"},"إضافة")]),_:1})]}),_:1},s)),e(r(ae,{stats:a(J)},null,s)),e(r(le,null,{default:k((n,c,x,m)=>{if(c)c(r(j,{modelValue:a(d),"onUpdate:modelValue":o=>C(d)?d.value=o:null,placeholder:"البحث في الحجوزات..."},null,x,m)),c(r(L,{modelValue:a(v),"onUpdate:modelValue":o=>C(v)?v.value=o:null,options:a(F),placeholder:"جميع الحالات"},null,x,m)),c(r(L,{modelValue:a(y),"onUpdate:modelValue":o=>C(y)?y.value=o:null,options:a(N),placeholder:"جميع أنواع الدفع"},null,x,m)),c(r(L,{modelValue:a(b),"onUpdate:modelValue":o=>C(b)?b.value=o:null,options:a(T),placeholder:"جميع التواريخ"},null,x,m));else return[i(j,{modelValue:a(d),"onUpdate:modelValue":o=>C(d)?d.value=o:null,placeholder:"البحث في الحجوزات..."},null,8,["modelValue","onUpdate:modelValue"]),i(L,{modelValue:a(v),"onUpdate:modelValue":o=>C(v)?v.value=o:null,options:a(F),placeholder:"جميع الحالات"},null,8,["modelValue","onUpdate:modelValue","options"]),i(L,{modelValue:a(y),"onUpdate:modelValue":o=>C(y)?y.value=o:null,options:a(N),placeholder:"جميع أنواع الدفع"},null,8,["modelValue","onUpdate:modelValue","options"]),i(L,{modelValue:a(b),"onUpdate:modelValue":o=>C(b)?b.value=o:null,options:a(T),placeholder:"جميع التواريخ"},null,8,["modelValue","onUpdate:modelValue","options"])]}),_:1},s)),e('<div class="bg-white rounded-lg shadow-sm border border-gray-200">'),a(A)?(e('<div class="flex justify-center items-center py-12">'),e(r(l,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"},null,s)),e('<span class="mr-3 text-gray-600">جارٍ تحميل الحجوزات...</span></div>')):a(R).length>0?(e('<div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الحجز </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> العميل </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الباقة </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الحالة </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> المبلغ </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> تاريخ الحجز </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الإجراءات </th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><!--[-->'),ye(a(R),n=>{e('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-10 w-10"><div class="h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center">'),e(r(l,{name:"material-symbols:book-online",class:"h-6 w-6 text-blue-600"},null,s)),e(`</div></div><div class="mr-4"><div class="text-sm font-medium text-gray-900">#${u(n.booking_number||n.id)}</div><div class="text-sm text-gray-500">${u(n.adults+n.children)} أشخاص</div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${u(n.customer_name)}</div><div class="text-sm text-gray-500">${u(n.customer_email)}</div><div class="text-sm text-gray-500">${u(n.customer_phone)}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${u(n.package_title)}</div><div class="text-sm text-gray-500">${u(n.travel_date)}</div></td><td class="px-6 py-4 whitespace-nowrap"><span class="${E([I(n.status),"px-2 py-1 text-xs font-medium rounded-full"])}">${u(Z(n.status))}</span>`),n.payment_status?e(`<div class="mt-1"><span class="${E([te(n.payment_status),"px-2 py-1 text-xs font-medium rounded-full"])}">${u(ee(n.payment_status))}</span></div>`):e("<!---->"),e(`</td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${u(M(n.total_amount))}</div><div class="text-sm text-gray-500">${u(n.currency||"SAR")}</div></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${u(X(n.created_at))}</td><td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><div class="flex items-center space-x-2 space-x-reverse">`),e(r(g,{to:`/admin/bookings/${n.id}`,class:"text-blue-600 hover:text-blue-900 p-1 rounded",title:"عرض"},{default:k((c,x,m,o)=>{if(x)x(r(l,{name:"material-symbols:visibility",class:"h-4 w-4"},null,m,o));else return[i(l,{name:"material-symbols:visibility",class:"h-4 w-4"})]}),_:2},s)),e(r(g,{to:`/admin/bookings/${n.id}/edit`,class:"text-green-600 hover:text-green-900 p-1 rounded",title:"تحرير"},{default:k((c,x,m,o)=>{if(x)x(r(l,{name:"material-symbols:edit",class:"h-4 w-4"},null,m,o));else return[i(l,{name:"material-symbols:edit",class:"h-4 w-4"})]}),_:2},s)),e('<button class="text-red-600 hover:text-red-900 p-1 rounded" title="حذف">'),e(r(l,{name:"material-symbols:delete",class:"h-4 w-4"},null,s)),e("</button></div></td></tr>")}),e("<!--]--></tbody></table></div>")):(e('<div class="text-center py-12">'),e(r(l,{name:"material-symbols:book-online",class:"h-16 w-16 text-gray-300 mx-auto mb-4"},null,s)),e('<h3 class="text-lg font-medium text-gray-900 mb-2">لا توجد حجوزات</h3><p class="text-gray-500 mb-6">لم يتم العثور على أي حجوزات</p>'),e(r(g,{to:"/admin/bookings/create",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},{default:k((n,c,x,m)=>{if(c)c(r(l,{name:"material-symbols:add",class:"h-5 w-5 ml-2"},null,x,m)),c(" إضافة حجز جديد ");else return[i(l,{name:"material-symbols:add",class:"h-5 w-5 ml-2"}),ge(" إضافة حجز جديد ")]}),_:1},s)),e("</div>")),e("</div>"),a(P)>1?e(`<div class="flex items-center justify-between"><div class="text-sm text-gray-700"> عرض ${u((a($)-1)*D+1)} إلى ${u(Math.min(a($)*D,a(S)))} من أصل ${u(a(S))} حجز </div><div class="flex space-x-1 space-x-reverse"><button${O(a($)===1)?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> السابق </button><span class="px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md">${u(a($))}</span><button${O(a($)===a(P))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> التالي </button></div></div>`):e("<!---->"),e("</div>")}}},H=Y.setup;Y.setup=(U,h)=>{const A=pe();return(A.modules||(A.modules=new Set)).add("pages/admin/bookings/index.vue"),H?H(U,h):void 0};export{Y as default};
//# sourceMappingURL=index.vue.mjs.map
