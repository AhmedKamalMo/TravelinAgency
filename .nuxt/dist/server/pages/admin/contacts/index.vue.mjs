import O from"../../../components/admin/AdminPageHeader.vue.mjs";import X from"../../../node_modules/_nuxt/icon/dist/runtime/components/index2.mjs";import Z from"../../../components/admin/AdminStats.vue.mjs";import{ref as h,computed as v,watch as I,mergeProps as _,withCtx as ee,createVNode as w,unref as t,useSSRContext as te}from"vue";import{ssrRenderAttrs as ae,ssrRenderComponent as m,ssrRenderAttr as B,ssrIncludeBooleanAttr as i,ssrLooseContain as c,ssrLooseEqual as u,ssrRenderList as se,ssrRenderClass as M,ssrInterpolate as g}from"vue/server-renderer";import"F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import{useMessageCounter as re}from"../../../composables/useMessageCounter.mjs";import{useHead as oe}from"../../../node_modules/nuxt/dist/head/runtime/composables/v3.mjs";const C=10,j={__name:"index",__ssrInlineRender:!0,setup(T){const p=h([]),D=h(!0),y=h(""),s=h(""),d=h(""),o=h(""),x=h(1),R=v(()=>{let a=p.value;if(y.value&&(a=a.filter(e=>e.name.toLowerCase().includes(y.value.toLowerCase())||e.email.toLowerCase().includes(y.value.toLowerCase())||e.message.toLowerCase().includes(y.value.toLowerCase()))),s.value&&(a=a.filter(e=>e.type===s.value)),d.value&&(a=a.filter(e=>d.value==="read"?e.is_read:!e.is_read)),o.value){const e=new Date,r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),A=new Date(r.getTime()-7*24*60*60*1e3),k=new Date(r.getTime()-30*24*60*60*1e3);a=a.filter(l=>{const b=new Date(l.created_at);switch(o.value){case"today":return b>=r;case"week":return b>=A;case"month":return b>=k;default:return!0}})}return a.slice((x.value-1)*C,x.value*C)}),L=v(()=>{let a=p.value;if(y.value&&(a=a.filter(e=>e.name.toLowerCase().includes(y.value.toLowerCase())||e.email.toLowerCase().includes(y.value.toLowerCase())||e.message.toLowerCase().includes(y.value.toLowerCase()))),s.value&&(a=a.filter(e=>e.type===s.value)),d.value&&(a=a.filter(e=>d.value==="read"?e.is_read:!e.is_read)),o.value){const e=new Date,r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),A=new Date(r.getTime()-7*24*60*60*1e3),k=new Date(r.getTime()-30*24*60*60*1e3);a=a.filter(l=>{const b=new Date(l.created_at);switch(o.value){case"today":return b>=r;case"week":return b>=A;case"month":return b>=k;default:return!0}})}return a.length}),S=v(()=>Math.ceil(L.value/C)),E=v(()=>p.value.length),H=v(()=>p.value.filter(a=>a.is_read).length),N=v(()=>p.value.filter(a=>!a.is_read).length),W=v(()=>{const a=new Date;return a.setHours(0,0,0,0),p.value.filter(e=>new Date(e.created_at)>=a).length}),Y=v(()=>p.value.filter(a=>a.phone&&a.phone.trim()!=="").length),q=v(()=>[{key:"total",label:"إجمالي الرسائل",value:E.value,icon:"material-symbols:mail",iconBg:"bg-blue-100",iconColor:"text-blue-600"},{key:"read",label:"مقروء",value:H.value,icon:"material-symbols:mark-email-read",iconBg:"bg-green-100",iconColor:"text-green-600"},{key:"unread",label:"غير مقروء",value:N.value,icon:"material-symbols:mark-email-unread",iconBg:"bg-orange-100",iconColor:"text-orange-600"},{key:"today",label:"اليوم",value:W.value,icon:"material-symbols:today",iconBg:"bg-purple-100",iconColor:"text-purple-600"},{key:"phone",label:"مع رقم هاتف",value:Y.value,icon:"material-symbols:phone",iconBg:"bg-teal-100",iconColor:"text-teal-600"}]),Q=async()=>{try{const a=await $fetch("/api/contact-messages/mark-all-read",{method:"PUT"});if(a.success){p.value.forEach(r=>{r.status="read",r.is_read=!0});const{fetchMessageCounts:e}=re();await e(),console.log(`تم تعيين ${a.affectedRows} رسالة كمقروءة`)}}catch(a){console.error("خطأ في تعيين الرسائل كمقروءة:",a)}},U=()=>{console.log("Exporting contacts...")},V=a=>new Date(a).toLocaleDateString("ar-SA"),z=a=>new Date(a).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}),G=(a,e)=>a?a.length>e?a.substring(0,e)+"...":a:"",J=a=>({general:"عام",package:"حزمة سياحية",destination:"وجهة",complaint:"شكوى",suggestion:"اقتراح"})[a]||a,K=a=>({general:"bg-gray-100 text-gray-800",package:"bg-blue-100 text-blue-800",destination:"bg-green-100 text-green-800",complaint:"bg-red-100 text-red-800",suggestion:"bg-purple-100 text-purple-800"})[a]||"bg-gray-100 text-gray-800";return I([y,s,d,o],()=>{x.value=1}),oe({title:"إدارة الرسائل - Wonder Land Admin",meta:[{name:"description",content:"عرض وإدارة رسائل العملاء"},{name:"robots",content:"noindex, nofollow"}]}),(a,e,r,A)=>{const k=O,l=X,b=Z;e(`<div${ae(_({class:"space-y-6"},A))}><div class="h-16"></div>`),e(m(k,{title:"إدارة الرسائل",description:"عرض وإدارة رسائل العملاء"},{actions:ee((n,$,P,f)=>{if($)$(`<button class="inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"${f}>`),$(m(l,{name:"material-symbols:mark-email-read",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,P,f)),$(`<span class="hidden sm:inline"${f}>تعيين الكل كمقروء</span><span class="sm:hidden"${f}>مقروء</span></button><button class="inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"${f}>`),$(m(l,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,P,f)),$(`<span class="hidden sm:inline"${f}>تصدير البيانات</span><span class="sm:hidden"${f}>تصدير</span></button>`);else return[w("button",{onClick:Q,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[w(l,{name:"material-symbols:mark-email-read",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),w("span",{class:"hidden sm:inline"},"تعيين الكل كمقروء"),w("span",{class:"sm:hidden"},"مقروء")]),w("button",{onClick:U,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},[w(l,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),w("span",{class:"hidden sm:inline"},"تصدير البيانات"),w("span",{class:"sm:hidden"},"تصدير")])]}),_:1},r)),e(m(b,{stats:t(q)},null,r)),e('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div class="relative">'),e(m(l,{name:"material-symbols:search",class:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"},null,r)),e(`<input${B("value",t(y))} type="text" placeholder="البحث في الرسائل..." class="w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></div><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${i(Array.isArray(t(s))?c(t(s),""):u(t(s),""))?" selected":""}>جميع الأنواع</option><option value="general"${i(Array.isArray(t(s))?c(t(s),"general"):u(t(s),"general"))?" selected":""}>عام</option><option value="package"${i(Array.isArray(t(s))?c(t(s),"package"):u(t(s),"package"))?" selected":""}>حزمة سياحية</option><option value="destination"${i(Array.isArray(t(s))?c(t(s),"destination"):u(t(s),"destination"))?" selected":""}>وجهة</option><option value="complaint"${i(Array.isArray(t(s))?c(t(s),"complaint"):u(t(s),"complaint"))?" selected":""}>شكوى</option><option value="suggestion"${i(Array.isArray(t(s))?c(t(s),"suggestion"):u(t(s),"suggestion"))?" selected":""}>اقتراح</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${i(Array.isArray(t(d))?c(t(d),""):u(t(d),""))?" selected":""}>جميع الحالات</option><option value="read"${i(Array.isArray(t(d))?c(t(d),"read"):u(t(d),"read"))?" selected":""}>مقروء</option><option value="unread"${i(Array.isArray(t(d))?c(t(d),"unread"):u(t(d),"unread"))?" selected":""}>غير مقروء</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${i(Array.isArray(t(o))?c(t(o),""):u(t(o),""))?" selected":""}>جميع التواريخ</option><option value="today"${i(Array.isArray(t(o))?c(t(o),"today"):u(t(o),"today"))?" selected":""}>اليوم</option><option value="week"${i(Array.isArray(t(o))?c(t(o),"week"):u(t(o),"week"))?" selected":""}>هذا الأسبوع</option><option value="month"${i(Array.isArray(t(o))?c(t(o),"month"):u(t(o),"month"))?" selected":""}>هذا الشهر</option></select></div></div><div class="bg-white rounded-lg shadow-sm border border-gray-200">`),t(D)?(e('<div class="flex justify-center items-center py-12">'),e(m(l,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"},null,r)),e('<span class="mr-3 text-gray-600">جارٍ تحميل الرسائل...</span></div>')):t(R).length>0?(e('<div class="divide-y divide-gray-200"><!--[-->'),se(t(R),n=>{e(`<div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center space-x-3 space-x-reverse"><div class="${M([n.is_read?"bg-gray-100":"bg-blue-100","p-2 rounded-full"])}">`),e(m(l,{name:n.is_read?"material-symbols:mark-email-read":"material-symbols:mark-email-unread",class:[n.is_read?"text-gray-600":"text-blue-600","h-5 w-5"]},null,r)),e(`</div><div class="flex-1"><div class="flex items-center space-x-2 space-x-reverse"><h3 class="text-sm font-medium text-gray-900">${g(n.name)}</h3><span class="${M([K(n.type),"px-2 py-1 text-xs font-medium rounded-full"])}">${g(J(n.type))}</span>`),n.is_read?e("<!---->"):e('<span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full"> جديد </span>'),e(`</div><p class="text-sm text-gray-600 mt-1">${g(n.email)}</p>`),n.phone?(e('<p class="text-sm text-gray-600 mt-1">'),e(m(l,{name:"material-symbols:phone",class:"h-4 w-4 inline ml-1"},null,r)),e(` ${g(n.phone)}</p>`)):e("<!---->"),e(`<p class="text-sm text-gray-700 mt-2">${g(G(n.message,100))}</p></div></div></div><div class="flex items-center space-x-2 space-x-reverse"><div class="text-right"><p class="text-sm text-gray-500">${g(V(n.created_at))}</p><p class="text-xs text-gray-400">${g(z(n.created_at))}</p></div><div class="flex items-center space-x-1 space-x-reverse"><button class="${M([n.is_read?"text-orange-600 hover:text-orange-900":"text-green-600 hover:text-green-900","p-1 rounded"])}"${B("title",n.is_read?"تعيين كغير مقروء":"تعيين كمقروء")}>`),e(m(l,{name:n.is_read?"material-symbols:mark-email-unread":"material-symbols:mark-email-read",class:"h-4 w-4"},null,r)),e('</button><button class="text-red-600 hover:text-red-900 p-1 rounded" title="حذف">'),e(m(l,{name:"material-symbols:delete",class:"h-4 w-4"},null,r)),e("</button></div></div></div></div>")}),e("<!--]--></div>")):(e('<div class="text-center py-12">'),e(m(l,{name:"material-symbols:mail",class:"h-16 w-16 text-gray-300 mx-auto mb-4"},null,r)),e('<h3 class="text-lg font-medium text-gray-900 mb-2">لا توجد رسائل</h3><p class="text-gray-500 mb-6">لم يتم العثور على أي رسائل</p></div>')),e("</div>"),t(S)>1?e(`<div class="flex items-center justify-between"><div class="text-sm text-gray-700"> عرض ${g((t(x)-1)*C+1)} إلى ${g(Math.min(t(x)*C,t(L)))} من أصل ${g(t(L))} رسالة </div><div class="flex space-x-1 space-x-reverse"><button${i(t(x)===1)?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> السابق </button><span class="px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md">${g(t(x))}</span><button${i(t(x)===t(S))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> التالي </button></div></div>`):e("<!---->"),e("</div>")}}},F=j.setup;j.setup=(T,p)=>{const D=te();return(D.modules||(D.modules=new Set)).add("pages/admin/contacts/index.vue"),F?F(T,p):void 0};export{j as default};
//# sourceMappingURL=index.vue.mjs.map
