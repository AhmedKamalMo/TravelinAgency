{"file":"homepage.vue.mjs","mappings":"ifAgUM,MAAAA,EAAUC,EAAI,EAAI,EAClBC,EAAQD,EAAI,EAAK,EACjBE,EAASF,EAAI,EAAK,EAClBG,EAAeH,EAAI,IAAI,EACvBI,EAAWJ,EAAI,EAAE,EACjBK,EAAsBL,EAAI,EAAK,EAC/BM,EAAuBN,EAAI,EAAK,EAChCO,EAAiBP,EAAI,IAAI,EAEzBQ,EAAaR,EAAI,CACrB,aAAc,OACd,MAAO,GACP,SAAU,GACV,QAAS,GACT,iBAAkB,UAClB,WAAY,UACZ,YAAa,CAAA,CACd,EAGKS,EAAiBC,IACH,CAChB,UAAW,QACX,MAAO,QACP,SAAU,OACZ,GACiBA,CAAM,GAAKA,EAGxBC,EAAkBC,IACR,CACZ,KAAM,wBACN,MAAO,wBACP,SAAU,wBACV,aAAc,wBACd,QAAS,gCACT,QAAS,0BACX,GACaA,CAAI,GAAK,2BAGlBC,EAAsBD,IACZ,CACZ,KAAM,YACN,MAAO,SACP,SAAU,UACV,aAAc,WACd,QAAS,UACT,QAAS,SACX,GACaA,CAAI,GAAKA,EAGlBE,EAAe,CAACC,EAAMC,IAAW,CACjC,GAAA,CAACD,EAAa,MAAA,GAClB,MAAME,EAAOF,EAAK,QAAQ,WAAY,EAAE,EACjC,OAAAE,EAAK,OAASD,EAASC,EAAK,UAAU,EAAGD,CAAM,EAAI,MAAQC,CACpE","names":["loading","ref","error","saving","homepagePage","sections","showAddSectionModal","showEditSectionModal","editingSection","newSection","getStatusText","status","getSectionIcon","type","getSectionTypeName","truncateHtml","html","length","text"],"sources":["../../../../../../pages/admin/cms/homepage.vue"],"sourcesContent":["<template>\r\n  <div class=\"space-y-6\">\r\n    <!-- مساحة إضافية في الأعلى -->\r\n    <div class=\"h-16\"></div>\r\n    \r\n    <!-- Header -->\r\n    <div class=\"flex justify-between items-center\">\r\n      <div>\r\n        <h1 class=\"text-2xl font-bold text-gray-900\">إدارة الصفحة الرئيسية</h1>\r\n        <p class=\"text-gray-600\">تعديل محتوى وعرض الصفحة الرئيسية</p>\r\n      </div>\r\n      <div class=\"flex space-x-3 space-x-reverse\">\r\n        <button\r\n          @click=\"previewHomepage\"\r\n          class=\"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center\"\r\n        >\r\n          <Icon name=\"material-symbols:visibility\" class=\"h-5 w-5 ml-2\" />\r\n          معاينة\r\n        </button>\r\n        <button\r\n          @click=\"saveAllChanges\"\r\n          :disabled=\"saving\"\r\n          class=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50\"\r\n        >\r\n          <Icon v-if=\"saving\" name=\"material-symbols:refresh\" class=\"h-5 w-5 ml-2 animate-spin\" />\r\n          <Icon v-else name=\"material-symbols:save\" class=\"h-5 w-5 ml-2\" />\r\n          {{ saving ? 'جاري الحفظ...' : 'حفظ التغييرات' }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Loading State -->\r\n    <div v-if=\"loading\" class=\"text-center py-12\">\r\n      <Icon name=\"material-symbols:refresh\" class=\"h-12 w-12 text-blue-600 animate-spin mx-auto mb-4\" />\r\n      <p class=\"text-gray-600\">جاري تحميل محتوى الصفحة الرئيسية...</p>\r\n    </div>\r\n\r\n    <!-- Error State -->\r\n    <div v-else-if=\"error\" class=\"text-center py-12\">\r\n      <Icon name=\"material-symbols:error\" class=\"h-12 w-12 text-red-600 mx-auto mb-4\" />\r\n      <p class=\"text-gray-600 mb-4\">حدث خطأ في تحميل المحتوى</p>\r\n      <button \r\n        @click=\"loadHomepageContent\"\r\n        class=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors\"\r\n      >\r\n        إعادة المحاولة\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Content Management -->\r\n    <div v-else class=\"space-y-6\">\r\n      <!-- Homepage Info -->\r\n      <div class=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200\">\r\n        <div class=\"flex items-center justify-between mb-4\">\r\n          <h2 class=\"text-lg font-semibold text-gray-900\">معلومات الصفحة الرئيسية</h2>\r\n          <span\r\n            :class=\"[\r\n              'px-3 py-1 text-sm font-medium rounded-full',\r\n              homepagePage?.status === 'published' ? 'bg-green-100 text-green-800' :\r\n              homepagePage?.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :\r\n              'bg-gray-100 text-gray-800'\r\n            ]\"\r\n          >\r\n            {{ getStatusText(homepagePage?.status) }}\r\n          </span>\r\n        </div>\r\n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div>\r\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">عنوان الصفحة</label>\r\n            <input\r\n              v-model=\"homepagePage.title\"\r\n              type=\"text\"\r\n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              placeholder=\"عنوان الصفحة الرئيسية\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">حالة النشر</label>\r\n            <select\r\n              v-model=\"homepagePage.status\"\r\n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            >\r\n              <option value=\"draft\">مسودة</option>\r\n              <option value=\"published\">منشور</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Sections Management -->\r\n      <div class=\"bg-white rounded-xl shadow-sm border border-gray-200\">\r\n        <div class=\"p-6 border-b border-gray-200\">\r\n          <div class=\"flex justify-between items-center\">\r\n            <h2 class=\"text-lg font-semibold text-gray-900\">أقسام الصفحة الرئيسية</h2>\r\n            <button\r\n              @click=\"showAddSectionModal = true\"\r\n              class=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center\"\r\n            >\r\n              <Icon name=\"material-symbols:add\" class=\"h-5 w-5 ml-2\" />\r\n              إضافة قسم\r\n            </button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"p-6\">\r\n          <div v-if=\"sections.length === 0\" class=\"text-center py-8\">\r\n            <Icon name=\"material-symbols:add-box\" class=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n            <p class=\"text-gray-600 mb-4\">لا توجد أقسام بعد</p>\r\n            <button\r\n              @click=\"showAddSectionModal = true\"\r\n              class=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors\"\r\n            >\r\n              إضافة أول قسم\r\n            </button>\r\n          </div>\r\n\r\n          <div v-else class=\"space-y-4\">\r\n            <div\r\n              v-for=\"(section, index) in sections\"\r\n              :key=\"section.id\"\r\n              class=\"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\"\r\n            >\r\n              <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"flex items-center\">\r\n                  <div class=\"p-2 bg-blue-100 rounded-lg ml-3\">\r\n                    <Icon :name=\"getSectionIcon(section.section_type)\" class=\"h-5 w-5 text-blue-600\" />\r\n                  </div>\r\n                  <div>\r\n                    <h3 class=\"font-medium text-gray-900\">{{ section.title || getSectionTypeName(section.section_type) }}</h3>\r\n                    <p class=\"text-sm text-gray-600\">{{ getSectionTypeName(section.section_type) }}</p>\r\n                  </div>\r\n                </div>\r\n                <div class=\"flex items-center space-x-2 space-x-reverse\">\r\n                  <button\r\n                    @click=\"toggleSectionActive(section)\"\r\n                    :class=\"[\r\n                      'px-3 py-1 text-xs font-medium rounded-full',\r\n                      section.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'\r\n                    ]\"\r\n                  >\r\n                    {{ section.is_active ? 'نشط' : 'غير نشط' }}\r\n                  </button>\r\n                  <button\r\n                    @click=\"editSection(section)\"\r\n                    class=\"text-blue-600 hover:text-blue-700 text-sm font-medium\"\r\n                  >\r\n                    تعديل\r\n                  </button>\r\n                  <button\r\n                    @click=\"deleteSection(section)\"\r\n                    class=\"text-red-600 hover:text-red-700 text-sm font-medium\"\r\n                  >\r\n                    حذف\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <!-- Section Preview -->\r\n              <div class=\"bg-gray-50 rounded-lg p-4\">\r\n                <div class=\"text-sm text-gray-600 mb-2\">معاينة القسم:</div>\r\n                <div class=\"text-sm\">\r\n                  <div v-if=\"section.title\" class=\"font-medium text-gray-900 mb-1\">{{ section.title }}</div>\r\n                  <div v-if=\"section.subtitle\" class=\"text-gray-600 mb-2\">{{ section.subtitle }}</div>\r\n                  <div v-if=\"section.content\" class=\"text-gray-500 text-xs\" v-html=\"truncateHtml(section.content, 100)\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Add Section Modal -->\r\n    <div v-if=\"showAddSectionModal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div class=\"bg-white rounded-xl p-6 w-full max-w-md mx-4\">\r\n        <div class=\"flex justify-between items-center mb-4\">\r\n          <h3 class=\"text-lg font-semibold text-gray-900\">إضافة قسم جديد</h3>\r\n          <button @click=\"showAddSectionModal = false\" class=\"text-gray-400 hover:text-gray-600\">\r\n            <Icon name=\"material-symbols:close\" class=\"h-6 w-6\" />\r\n          </button>\r\n        </div>\r\n        \r\n        <div class=\"space-y-4\">\r\n          <div>\r\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">نوع القسم</label>\r\n            <select\r\n              v-model=\"newSection.section_type\"\r\n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            >\r\n              <option value=\"hero\">قسم البطل (Hero)</option>\r\n              <option value=\"about\">من نحن</option>\r\n              <option value=\"services\">الخدمات</option>\r\n              <option value=\"testimonials\">الشهادات</option>\r\n              <option value=\"contact\">التواصل</option>\r\n              <option value=\"generic\">قسم عام</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <div>\r\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">عنوان القسم</label>\r\n            <input\r\n              v-model=\"newSection.title\"\r\n              type=\"text\"\r\n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              placeholder=\"عنوان القسم\"\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"flex justify-end space-x-3 space-x-reverse mt-6\">\r\n          <button\r\n            @click=\"showAddSectionModal = false\"\r\n            class=\"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors\"\r\n          >\r\n            إلغاء\r\n          </button>\r\n          <button\r\n            @click=\"addSection\"\r\n            class=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors\"\r\n          >\r\n            إضافة\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Edit Section Modal -->\r\n    <div v-if=\"showEditSectionModal && editingSection\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div class=\"bg-white rounded-xl p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto\">\r\n        <div class=\"flex justify-between items-center mb-4\">\r\n          <h3 class=\"text-lg font-semibold text-gray-900\">تعديل القسم</h3>\r\n          <button @click=\"showEditSectionModal = false\" class=\"text-gray-400 hover:text-gray-600\">\r\n            <Icon name=\"material-symbols:close\" class=\"h-6 w-6\" />\r\n          </button>\r\n        </div>\r\n        \r\n        <div class=\"space-y-4\">\r\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div>\r\n              <label class=\"block text-sm font-medium text-gray-700 mb-2\">عنوان القسم</label>\r\n              <input\r\n                v-model=\"editingSection.title\"\r\n                type=\"text\"\r\n                class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label class=\"block text-sm font-medium text-gray-700 mb-2\">العنوان الفرعي</label>\r\n              <input\r\n                v-model=\"editingSection.subtitle\"\r\n                type=\"text\"\r\n                class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              />\r\n            </div>\r\n          </div>\r\n          \r\n          <div>\r\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">محتوى القسم</label>\r\n            <textarea\r\n              v-model=\"editingSection.content\"\r\n              rows=\"4\"\r\n              class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              placeholder=\"محتوى القسم...\"\r\n            ></textarea>\r\n          </div>\r\n          \r\n          <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <label class=\"block text-sm font-medium text-gray-700 mb-2\">لون الخلفية</label>\r\n              <input\r\n                v-model=\"editingSection.background_color\"\r\n                type=\"color\"\r\n                class=\"w-full h-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label class=\"block text-sm font-medium text-gray-700 mb-2\">لون النص</label>\r\n              <input\r\n                v-model=\"editingSection.text_color\"\r\n                type=\"color\"\r\n                class=\"w-full h-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label class=\"block text-sm font-medium text-gray-700 mb-2\">ترتيب القسم</label>\r\n              <input\r\n                v-model.number=\"editingSection.order_index\"\r\n                type=\"number\"\r\n                class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"flex justify-end space-x-3 space-x-reverse mt-6\">\r\n          <button\r\n            @click=\"showEditSectionModal = false\"\r\n            class=\"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors\"\r\n          >\r\n            إلغاء\r\n          </button>\r\n          <button\r\n            @click=\"saveSection\"\r\n            class=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors\"\r\n          >\r\n            حفظ التغييرات\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\ndefinePageMeta({\r\n  layout: 'admin',\r\n  middleware: 'admin'\r\n})\r\n\r\n// State\r\nconst loading = ref(true)\r\nconst error = ref(false)\r\nconst saving = ref(false)\r\nconst homepagePage = ref(null)\r\nconst sections = ref([])\r\nconst showAddSectionModal = ref(false)\r\nconst showEditSectionModal = ref(false)\r\nconst editingSection = ref(null)\r\n\r\nconst newSection = ref({\r\n  section_type: 'hero',\r\n  title: '',\r\n  subtitle: '',\r\n  content: '',\r\n  background_color: '#1e40af',\r\n  text_color: '#ffffff',\r\n  order_index: 0\r\n})\r\n\r\n// Methods\r\nconst getStatusText = (status) => {\r\n  const statusMap = {\r\n    published: 'منشور',\r\n    draft: 'مسودة',\r\n    archived: 'مؤرشف'\r\n  }\r\n  return statusMap[status] || status\r\n}\r\n\r\nconst getSectionIcon = (type) => {\r\n  const icons = {\r\n    hero: 'material-symbols:home',\r\n    about: 'material-symbols:info',\r\n    services: 'material-symbols:work',\r\n    testimonials: 'material-symbols:star',\r\n    contact: 'material-symbols:contact-mail',\r\n    generic: 'material-symbols:article'\r\n  }\r\n  return icons[type] || 'material-symbols:article'\r\n}\r\n\r\nconst getSectionTypeName = (type) => {\r\n  const names = {\r\n    hero: 'قسم البطل',\r\n    about: 'من نحن',\r\n    services: 'الخدمات',\r\n    testimonials: 'الشهادات',\r\n    contact: 'التواصل',\r\n    generic: 'قسم عام'\r\n  }\r\n  return names[type] || type\r\n}\r\n\r\nconst truncateHtml = (html, length) => {\r\n  if (!html) return ''\r\n  const text = html.replace(/<[^>]*>/g, '')\r\n  return text.length > length ? text.substring(0, length) + '...' : text\r\n}\r\n\r\nconst loadHomepageContent = async () => {\r\n  try {\r\n    loading.value = true\r\n    error.value = false\r\n    \r\n    // Load homepage page\r\n    const pageResponse = await $fetch('/api/cms/pages/home')\r\n    if (pageResponse.success) {\r\n      homepagePage.value = pageResponse.data.page\r\n      sections.value = pageResponse.data.sections || []\r\n    } else {\r\n      // Create homepage page if it doesn't exist\r\n      await createHomepagePage()\r\n    }\r\n  } catch (err) {\r\n    console.error('Error loading homepage content:', err)\r\n    error.value = true\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst createHomepagePage = async () => {\r\n  try {\r\n    const response = await $fetch('/api/cms/pages', {\r\n      method: 'POST',\r\n      body: {\r\n        slug: 'home',\r\n        title: 'الصفحة الرئيسية',\r\n        status: 'published'\r\n      }\r\n    })\r\n    \r\n    if (response.success) {\r\n      homepagePage.value = response.data.page\r\n      sections.value = []\r\n    }\r\n  } catch (err) {\r\n    console.error('Error creating homepage page:', err)\r\n  }\r\n}\r\n\r\nconst addSection = async () => {\r\n  try {\r\n    const response = await $fetch('/api/cms/sections', {\r\n      method: 'POST',\r\n      body: {\r\n        page_id: homepagePage.value.id,\r\n        ...newSection.value\r\n      }\r\n    })\r\n    \r\n    if (response.success) {\r\n      sections.value.push(response.data.section)\r\n      showAddSectionModal.value = false\r\n      resetNewSection()\r\n    }\r\n  } catch (err) {\r\n    console.error('Error adding section:', err)\r\n  }\r\n}\r\n\r\nconst editSection = (section) => {\r\n  editingSection.value = { ...section }\r\n  showEditSectionModal.value = true\r\n}\r\n\r\nconst saveSection = async () => {\r\n  try {\r\n    const response = await $fetch(`/api/cms/sections/${editingSection.value.id}`, {\r\n      method: 'PUT',\r\n      body: editingSection.value\r\n    })\r\n    \r\n    if (response.success) {\r\n      const index = sections.value.findIndex(s => s.id === editingSection.value.id)\r\n      if (index !== -1) {\r\n        sections.value[index] = response.data.section\r\n      }\r\n      showEditSectionModal.value = false\r\n      editingSection.value = null\r\n    }\r\n  } catch (err) {\r\n    console.error('Error saving section:', err)\r\n  }\r\n}\r\n\r\nconst deleteSection = async (section) => {\r\n  if (!confirm('هل أنت متأكد من حذف هذا القسم؟')) return\r\n  \r\n  try {\r\n    await $fetch(`/api/cms/sections/${section.id}`, {\r\n      method: 'DELETE'\r\n    })\r\n    \r\n    sections.value = sections.value.filter(s => s.id !== section.id)\r\n  } catch (err) {\r\n    console.error('Error deleting section:', err)\r\n  }\r\n}\r\n\r\nconst toggleSectionActive = async (section) => {\r\n  try {\r\n    const response = await $fetch(`/api/cms/sections/${section.id}`, {\r\n      method: 'PUT',\r\n      body: {\r\n        is_active: !section.is_active\r\n      }\r\n    })\r\n    \r\n    if (response.success) {\r\n      const index = sections.value.findIndex(s => s.id === section.id)\r\n      if (index !== -1) {\r\n        sections.value[index].is_active = !sections.value[index].is_active\r\n      }\r\n    }\r\n  } catch (err) {\r\n    console.error('Error toggling section:', err)\r\n  }\r\n}\r\n\r\nconst saveAllChanges = async () => {\r\n  try {\r\n    saving.value = true\r\n    \r\n    // Save page info\r\n    if (homepagePage.value) {\r\n      await $fetch(`/api/cms/pages/${homepagePage.value.id}`, {\r\n        method: 'PUT',\r\n        body: {\r\n          title: homepagePage.value.title,\r\n          status: homepagePage.value.status\r\n        }\r\n      })\r\n    }\r\n    \r\n    // Show success message\r\n    alert('تم حفظ جميع التغييرات بنجاح!')\r\n  } catch (err) {\r\n    console.error('Error saving changes:', err)\r\n    alert('حدث خطأ في حفظ التغييرات')\r\n  } finally {\r\n    saving.value = false\r\n  }\r\n}\r\n\r\nconst previewHomepage = () => {\r\n  window.open('/', '_blank')\r\n}\r\n\r\nconst resetNewSection = () => {\r\n  newSection.value = {\r\n    section_type: 'hero',\r\n    title: '',\r\n    subtitle: '',\r\n    content: '',\r\n    background_color: '#1e40af',\r\n    text_color: '#ffffff',\r\n    order_index: 0\r\n  }\r\n}\r\n\r\n// Load data on mount\r\nonMounted(() => {\r\n  loadHomepageContent()\r\n})\r\n</script>\r\n"],"version":3}