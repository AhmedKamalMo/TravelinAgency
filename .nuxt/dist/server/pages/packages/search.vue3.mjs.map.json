{"file":"search.vue3.mjs","mappings":"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","names":["useRoute","router","useRouter","t","locale","useI18n","packages","pending","error","usePackages","filters","searchQuery","filterOptions","usePackageSearch","destinationNames","computed","_a","id","destination","_b","d","_c","hasActiveFilters","_d","_e","formatPriceRange","range","formatDurationRange","filteredPackages","package_","searchLower","titleMatch","descMatch","_f","packagePeriod","_g","period","selectedPeriod","_i","_h","_k","_j","_m","_l","_o","_n","_p","watch","newFilters","newSearchQuery"],"sources":["../../../../../pages/packages/search.vue"],"sourcesContent":["\r\n<template>\r\n  <div class=\"min-h-screen bg-gray-50\">\r\n    <!-- Hero Section with Active Filters -->\r\n    <section class=\"relative bg-cover bg-center py-20\">\r\n      <div class=\"absolute inset-0\">\r\n        <NuxtImg\r\n          src=\"/images/packages/home/packages-hero-bg.jpeg\"\r\n          alt=\"Stunning beachfront villa with private pool and ocean views\"\r\n          width=\"1920\"\r\n          height=\"1080\"\r\n          loading=\"eager\"\r\n          format=\"webp\"\r\n          quality=\"90\"\r\n          class=\"w-full h-full object-cover\"\r\n          placeholder\r\n        />\r\n        <div class=\"absolute inset-0 bg-gradient-to-b from-black/50 via-black/30 to-black/50\"></div>\r\n      </div>\r\n      <div class=\"container relative z-10 mx-auto px-4 text-center text-white\">\r\n        <h1 class=\"text-2xl md:text-3xl font-bold mb-4\">{{ t('search.results.title') }}</h1>\r\n        <div class=\"flex items-center justify-center text-1xl gap-2 text-sm md:text-base mb-6 w-full\">\r\n          <span v-if=\"filteredPackages.length > 0\">\r\n            {{ t('search.results.count', { count: filteredPackages.length }) }}\r\n          </span>\r\n          <span v-else>\r\n            {{ t('search.results.empty') }}\r\n          </span>\r\n        </div>\r\n        <!-- Active Filters Summary -->\r\n        <div class=\"flex flex-wrap justify-center gap-3 mb-8\">\r\n          <!-- Destination Filter -->\r\n          <div v-if=\"filters?.destinations && filters.destinations.length\" class=\"flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path fill-rule=\"evenodd\" d=\"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z\" clip-rule=\"evenodd\" />\r\n            </svg>\r\n            <span>{{ destinationNames.join(', ') }}</span>\r\n          </div>\r\n\r\n          <!-- Price Range Filter -->\r\n          <div v-if=\"filters.priceRange.min !== 0 || filters.priceRange.max !== Infinity\" class=\"flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full\">\r\n            <SaudiRyialSymbol :size=\"20\" class=\"text-white\" />\r\n            <span>{{ formatPriceRange(filters.priceRange) }}</span>\r\n          </div>\r\n\r\n          <!-- Duration Filter -->\r\n          <div v-if=\"filters.duration.min !== 0 || filters.duration.max !== Infinity\" class=\"flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clip-rule=\"evenodd\" />\r\n            </svg>\r\n            <span>{{ formatDurationRange(filters.duration) }}</span>\r\n          </div>\r\n\r\n          <!-- Travelers Filter -->\r\n          <div v-if=\"filters.travelers > 1\" class=\"flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path d=\"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z\" />\r\n            </svg>\r\n            <span>{{ filters.travelers }} {{ t('search.travelers_count', { count: filters.travelers }) }}</span>\r\n          </div>\r\n\r\n          <!-- Clear All Filters -->\r\n          <button \r\n            v-if=\"hasActiveFilters\" \r\n            @click=\"clearFilters\"\r\n            class=\"flex items-center gap-2 bg-primary/20 hover:bg-primary/30 backdrop-blur-sm px-4 py-2 rounded-full transition-colors\"\r\n          >\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path fill-rule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clip-rule=\"evenodd\" />\r\n            </svg>\r\n            {{ t('search.active_filters.clear_filters') }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <!-- Search Results Grid -->\r\n    <section class=\"py-16\">\r\n      <div class=\"container mx-auto px-4\">\r\n        <div v-if=\"pending\" class=\"flex justify-center items-center min-h-[400px]\">\r\n          <div class=\"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent\"></div>\r\n        </div>\r\n        <div v-else-if=\"error\" class=\"text-center text-red-500 py-16\">\r\n          <div class=\"max-w-md mx-auto\">\r\n            <Icon name=\"material-symbols:error-outline\" class=\"h-16 w-16 mx-auto mb-4 text-red-400\" />\r\n            <h3 class=\"text-lg font-medium mb-2\">{{ t('common.error') }}</h3>\r\n            <p class=\"text-gray-500\">{{ error.message || 'An error occurred while loading packages' }}</p>\r\n          </div>\r\n        </div>\r\n        <div v-else-if=\"packages.length === 0\" class=\"text-center text-gray-500 py-16\">\r\n          <div class=\"max-w-md mx-auto\">\r\n            <Icon name=\"material-symbols:package-2-outline\" class=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\r\n            <h3 class=\"text-lg font-medium mb-2\">{{ t('packages.no_packages') }}</h3>\r\n            <p class=\"text-gray-500\">{{ t('packages.no_packages_description') }}</p>\r\n          </div>\r\n        </div>\r\n        <div v-else-if=\"filteredPackages.length === 0\" class=\"text-center py-16\">\r\n          <div class=\"max-w-md mx-auto\">\r\n            <Icon name=\"material-symbols:search-off\" class=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\r\n            <h3 class=\"text-lg font-medium mb-2\">{{ t('search.results.empty') }}</h3>\r\n            <p class=\"text-gray-500 mb-6\">{{ t('search.results.empty_description') }}</p>\r\n            <button \r\n              @click=\"clearFilters\"\r\n              class=\"px-6 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors\"\r\n            >\r\n              {{ t('search.actions.clear_filters') }}\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <div v-else class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n          <PackageCard\r\n            v-for=\"package_ in filteredPackages\"\r\n            :key=\"package_.id\"\r\n            :package_=\"package_\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, onMounted, watch } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { usePackages } from '~/composables/usePackages'\r\nimport { usePackageSearch } from '~/composables/usePackageSearch'\r\nimport type { Package } from '~/composables/usePackages'\r\nimport SaudiRyialSymbol from '~/components/ui/icons/SaudiRyialSymbol.vue'\r\nimport PackageCard from '~/components/packages/PackageCard.vue'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst { t, locale } = useI18n()\r\nconst { packages, pending, error } = usePackages()\r\nconst { filters, searchQuery, filterOptions, resetFilters } = usePackageSearch()\r\n\r\n// Initialize filters from URL parameters\r\nonMounted(() => {\r\n  const query = route.query\r\n\r\n  // Reset filters first\r\n  resetFilters()\r\n\r\n  // Set search query\r\n  if (query.q) {\r\n    searchQuery.value = String(query.q)\r\n  }\r\n\r\n  // Set travel periods\r\n  if (query.periods) {\r\n    const periods = Array.isArray(query.periods) \r\n      ? query.periods \r\n      : query.periods.split(',')\r\n    filters.value.destinations = periods.map(p => String(p))\r\n  }\r\n\r\n  // Set budget range from URL\r\n  if (query.budget) {\r\n    const budget = String(query.budget)\r\n    switch (budget) {\r\n      case 'low':\r\n        filters.value.priceRange = { min: 0, max: 1000 }\r\n        break\r\n      case 'medium':\r\n        filters.value.priceRange = { min: 1000, max: 3000 }\r\n        break\r\n      case 'high':\r\n        filters.value.priceRange = { min: 3000, max: 5000 }\r\n        break\r\n      case 'luxury':\r\n        filters.value.priceRange = { min: 5000, max: Infinity }\r\n        break\r\n    }\r\n  }\r\n  // If no budget but has price range\r\n  else if (query.priceMin || query.priceMax) {\r\n    filters.value.priceRange = {\r\n      min: parseInt(query.priceMin as string) || 0,\r\n      max: query.priceMax ? parseInt(query.priceMax as string) : Infinity\r\n    }\r\n  }\r\n\r\n  // Set duration range\r\n  if (query.durationMin || query.durationMax) {\r\n    filters.value.duration = {\r\n      min: parseInt(query.durationMin as string) || 0,\r\n      max: query.durationMax ? parseInt(query.durationMax as string) : Infinity\r\n    }\r\n  }\r\n\r\n  // Set travelers\r\n  if (query.travelers) {\r\n    filters.value.travelers = parseInt(query.travelers as string) || 1\r\n  }\r\n\r\n})\r\n\r\n// Get destination names for display\r\nconst destinationNames = computed(() => {\r\n  if (!filters.value?.destinations) return []\r\n  return filters.value.destinations.map(id => {\r\n    const destination = filterOptions.value?.destinations?.find(d => d.id === id)\r\n    return destination?.name?.[locale.value] || id\r\n  })\r\n})\r\n\r\n// Check if any filters are active\r\nconst hasActiveFilters = computed(() => {\r\n  if (!filters.value) return false\r\n  return (filters.value.destinations?.length || 0) > 0 ||\r\n    (filters.value.priceRange?.min || 0) !== 0 ||\r\n    (filters.value.priceRange?.max || Infinity) !== Infinity ||\r\n    (filters.value.duration?.min || 0) !== 0 ||\r\n    (filters.value.duration?.max || Infinity) !== Infinity ||\r\n    (filters.value.travelers || 1) > 1\r\n})\r\n\r\n// Clear all filters and navigate\r\nconst clearFilters = () => {\r\n  resetFilters()\r\n  router.push({ path: route.path })\r\n}\r\n\r\n// Format price range for display\r\nconst formatPriceRange = (range: { min: number, max: number }) => {\r\n  if (range.max === Infinity) {\r\n    return `${t('common.from')} ${range.min.toLocaleString()}`\r\n  }\r\n  return `${range.min.toLocaleString()} - ${range.max.toLocaleString()}`\r\n}\r\n\r\n// Format duration range for display\r\nconst formatDurationRange = (range: { min: number, max: number }) => {\r\n  if (range.max === Infinity) {\r\n    return `${t('common.from')} ${range.min} ${t('common.days')}`\r\n  }\r\n  return `${range.min} - ${range.max} ${t('common.days')}`\r\n}\r\n\r\n// Filter packages based on current filters\r\nconst filteredPackages = computed(() => {\r\n  if (!packages.value) return []\r\n\r\n  return packages.value.filter(package_ => {\r\n    // Filter by search query\r\n    if (searchQuery.value) {\r\n      const searchLower = searchQuery.value.toLowerCase()\r\n      const titleMatch = package_.title_en?.toLowerCase().includes(searchLower) || \r\n                        package_.title_ar?.toLowerCase().includes(searchLower)\r\n      const descMatch = package_.description_en?.toLowerCase().includes(searchLower) || \r\n                       package_.description_ar?.toLowerCase().includes(searchLower)\r\n      if (!titleMatch && !descMatch) {\r\n        return false\r\n      }\r\n    }\r\n\r\n    // Filter by travel periods if any are selected\r\n    if (filters.value?.destinations?.length > 0) {\r\n      // Get the package's travel period and convert to lowercase\r\n      const packagePeriod = package_?.travel_period?.toLowerCase()\r\n      if (!packagePeriod) return false\r\n\r\n      // Check if the package period includes ANY of the selected periods\r\n      const matches = filters.value.destinations.some(period => {\r\n        // Convert both to lowercase for case-insensitive comparison\r\n        const selectedPeriod = period.toLowerCase()\r\n        // Check if the package period contains this month\r\n        return packagePeriod.includes(selectedPeriod)\r\n      })\r\n\r\n      if (!matches) return false\r\n    }\r\n\r\n    // Filter by price range\r\n    if (package_?.price_per_person < (filters.value?.priceRange?.min || 0) || \r\n        (filters.value?.priceRange?.max !== Infinity && package_?.price_per_person > filters.value.priceRange.max)) {\r\n      return false\r\n    }\r\n\r\n    // Filter by duration\r\n    if (package_?.duration_days < (filters.value?.duration?.min || 0) || \r\n        (filters.value?.duration?.max !== Infinity && package_?.duration_days > filters.value.duration.max)) {\r\n      return false\r\n    }\r\n\r\n    // Filter by travelers\r\n    if ((filters.value?.travelers || 1) > 1 && package_?.max_persons < filters.value.travelers) {\r\n      return false\r\n    }\r\n\r\n    return true\r\n  })\r\n})\r\n\r\n// Watch for changes in filters and update URL\r\nwatch([filters, searchQuery], ([newFilters, newSearchQuery]) => {\r\n  // Update URL with current filters\r\n  router.replace({\r\n    query: {\r\n      ...(newSearchQuery && { q: newSearchQuery }),\r\n      ...(newFilters.destinations?.length && { periods: newFilters.destinations.join(',') }),\r\n      ...(newFilters.priceRange.min > 0 && { priceMin: newFilters.priceRange.min }),\r\n      ...(newFilters.priceRange.max < Infinity && { priceMax: newFilters.priceRange.max }),\r\n      ...(newFilters.duration.min > 0 && { durationMin: newFilters.duration.min }),\r\n      ...(newFilters.duration.max < Infinity && { durationMax: newFilters.duration.max }),\r\n      ...(newFilters.travelers > 1 && { travelers: newFilters.travelers })\r\n    }\r\n  })\r\n}, { deep: true })\r\n\r\ndefinePageMeta({\r\n  layout: 'default'\r\n})\r\n</script>"],"version":3}