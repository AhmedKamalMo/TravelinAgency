import{defu as I}from"F:/TravelinAgency/node_modules/defu/dist/defu.mjs";import{withLeadingSlash as z,hasProtocol as $,joinURL as H,parseURL as N}from"../../../../ufo/dist/index.mjs";import{imageMeta as U}from"./utils/meta.mjs";import{parseSize as p,parseSizes as b,parseDensities as x,checkDensities as D}from"./utils/index.mjs";import{prerenderStaticImages as E}from"./utils/prerender.mjs";function K(i){const e={options:i},r=(s,n={})=>{const o=k(e,s,n);return import.meta.prerender&&E(o.url),o},t=(s,n={},o={})=>r(s,{...o,modifiers:I(n,o.modifiers||{})}).url;for(const s in i.presets)t[s]=(n,o,d)=>t(n,o,{...i.presets[s],...d});return t.options=i,t.getImage=r,t.getMeta=(s,n)=>L(e,s,n),t.getSizes=(s,n)=>R(e,s,n),e.$img=t,t}async function L(i,e,r){const t=k(i,e,{...r});return typeof t.getMeta=="function"?await t.getMeta():await U(i,t.url)}function k(i,e,r){var a,g;if(e&&typeof e!="string")throw new TypeError(`input must be a string (received ${typeof e}: ${JSON.stringify(e)})`);if(!e||e.startsWith("data:"))return{url:e};const{provider:t,defaults:s}=P(i,r.provider||i.options.provider),n=F(i,r.preset);if(e=$(e)?e:z(e),!t.supportsAlias){for(const m in i.options.alias)if(e.startsWith(m)){const l=i.options.alias[m];l&&(e=H(l,e.slice(m.length)))}}if(t.validateDomains&&$(e)){const m=N(e).host;if(!i.options.domains.find(l=>l===m))return{url:e}}const o=I(r,n,s);o.modifiers={...o.modifiers};const d=o.modifiers.format;(a=o.modifiers)!=null&&a.width&&(o.modifiers.width=p(o.modifiers.width)),(g=o.modifiers)!=null&&g.height&&(o.modifiers.height=p(o.modifiers.height));const c=t.getImage(e,o,i);return c.format=c.format||d||"",c}function P(i,e){const r=i.options.providers[e];if(!r)throw new Error("Unknown provider: "+e);return r}function F(i,e){if(!e)return{};if(!i.options.presets[e])throw new Error("Unknown preset: "+e);return i.options.presets[e]}function R(i,e,r){var w,v,W,M,S;const t=p((w=r.modifiers)==null?void 0:w.width),s=p((v=r.modifiers)==null?void 0:v.height),n=b(r.sizes),o=(W=r.densities)!=null&&W.trim()?x(r.densities.trim()):i.options.densities;D(o);const d=t&&s?s/t:0,c=[],a=[];if(Object.keys(n).length>=1){for(const f in n){const h=y(f,String(n[f]),s,d,i);if(h!==void 0){c.push({size:h.size,screenMaxWidth:h.screenMaxWidth,media:`(max-width: ${h.screenMaxWidth}px)`});for(const u of o)a.push({width:h._cWidth*u,src:_(i,e,r,h,u)})}}A(c)}else for(const f of o){const h=Object.keys(n)[0];let u=h?y(h,String(n[h]),s,d,i):void 0;u===void 0&&(u={size:"",screenMaxWidth:0,_cWidth:(M=r.modifiers)==null?void 0:M.width,_cHeight:(S=r.modifiers)==null?void 0:S.height}),a.push({width:f,src:_(i,e,r,u,f)})}J(a);const g=a[a.length-1],m=c.length?c.map(f=>`${f.media?f.media+" ":""}${f.size}`).join(", "):void 0,l=m?"w":"x",j=a.map(f=>`${f.src} ${f.width}${l}`).join(", ");return{sizes:m,srcset:j,src:g==null?void 0:g.src}}function y(i,e,r,t,s){const n=s.options.screens&&s.options.screens[i]||Number.parseInt(i),o=e.endsWith("vw");if(!o&&/^\d+$/.test(e)&&(e=e+"px"),!o&&!e.endsWith("px"))return;let d=Number.parseInt(e);if(!n||!d)return;o&&(d=Math.round(d/100*n));const c=t?Math.round(d*t):r;return{size:e,screenMaxWidth:n,_cWidth:d,_cHeight:c}}function _(i,e,r,t,s){return i.$img(e,{...r.modifiers,width:t._cWidth?t._cWidth*s:void 0,height:t._cHeight?t._cHeight*s:void 0},r)}function A(i){var r;i.sort((t,s)=>t.screenMaxWidth-s.screenMaxWidth);let e=null;for(let t=i.length-1;t>=0;t--){const s=i[t];s.media===e&&i.splice(t,1),e=s.media}for(let t=0;t<i.length;t++)i[t].media=((r=i[t+1])==null?void 0:r.media)||""}function J(i){i.sort((r,t)=>r.width-t.width);let e=null;for(let r=i.length-1;r>=0;r--){const t=i[r];t.width===e&&i.splice(r,1),e=t.width}}export{K as createImage};
//# sourceMappingURL=image.mjs.map
