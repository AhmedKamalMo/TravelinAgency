import{defineComponent as b,useAttrs as _,ref as f,computed as o,mergeProps as S,unref as u}from"vue";import{ssrRenderAttrs as I,ssrRenderSlot as x}from"vue/server-renderer";import{useImage as P}from"../composables.mjs";import{parseSize as v}from"../utils/index.mjs";import{prerenderStaticImages as R}from"../utils/prerender.mjs";import{imgProps as w,useBaseImage as $}from"./_base.mjs";import{useNuxtApp as k}from"../../../../../nuxt/dist/app/nuxt.mjs";import{useHead as C}from"../../../../../nuxt/dist/head/runtime/composables/v3.mjs";const G=b({__name:"NuxtImg",__ssrInlineRender:!0,props:w,emits:["load","error"],setup(g,{emit:E}){const r=g,c=_(),p=!0,n=P(),i=$(r),a=f(!1),h=f(),t=o(()=>n.getSizes(r.src,{...i.options.value,sizes:r.sizes,densities:r.densities,modifiers:{...i.modifiers.value,width:v(r.width),height:v(r.height)}})),d=o(()=>{const e={...i.attrs.value,"data-nuxt-img":""};return(!r.placeholder||a.value)&&(e.sizes=t.value.sizes,e.srcset=t.value.srcset),e}),m=o(()=>{let e=r.placeholder;if(e===""&&(e=!0),!e||a.value)return!1;if(typeof e=="string")return e;const s=Array.isArray(e)?e:typeof e=="number"?[e,e]:[10,10];return n(r.src,{...i.modifiers.value,width:s[0],height:s[1],quality:s[2]||50,blur:s[3]||3},i.options.value)}),y=o(()=>r.sizes?t.value.src:n(r.src,i.modifiers.value,i.options.value)),l=o(()=>m.value?m.value:y.value);if(r.preload){const e=Object.values(t.value).every(s=>s);C({link:[{rel:"preload",as:"image",nonce:r.nonce,...e?{href:t.value.src,imagesizes:t.value.sizes,imagesrcset:t.value.srcset}:{href:l.value},...typeof r.preload!="boolean"&&r.preload.fetchPriority?{fetchpriority:r.preload.fetchPriority}:{}}]})}return import.meta.prerender&&R(l.value,t.value.srcset),k().isHydrating,(e,s,z,A)=>{e.custom?x(e.$slots,"default",{...u(p)?{onerror:"this.setAttribute('data-error', 1)"}:{},imgAttrs:{...d.value,...u(c)},isLoaded:a.value,src:l.value},null,s,z):s(`<img${I(S({ref_key:"imgEl",ref:h,class:m.value&&!a.value?e.placeholderClass:void 0},{...u(p)?{onerror:"this.setAttribute('data-error', 1)"}:{},...d.value,...u(c)},{src:l.value},A))}>`)}}});export{G as default,w as imgProps};
//# sourceMappingURL=NuxtImg.vue2.mjs.map
