import{joinURL as I,isEqual as x}from"../../../../ufo/dist/index.mjs";import{isFunction as R,isString as k,isObject as U}from"../../../../_intlify/shared/dist/shared.mjs";import{normalizedLocales as A,localeLoaders as y,isSSG as G,NUXT_I18N_MODULE_ID as H}from"../../../../../.nuxt/i18n.options.mjs";import{runtimeDetectBrowserLanguage as w,detectBrowserLanguage as W,DetectFailure as j,getLocaleDomain as E,defineGetter as L,wrapComposable as $,getDomainFromLocale as N,getVueI18nPropertyValue as M,getHost as T,callVueI18nInterfaces as C}from"./internal.mjs";import{makeFallbackLocaleCodes as V,loadLocale as F}from"./messages.mjs";import{getRouteBaseName as z,localePath as q,localeRoute as X,switchLocalePath as _,DefaultSwitchLocalePathIntercepter as J,DefaultPrefixable as K}from"./routing/compatibles/routing.mjs";import{localeHead as Q}from"./routing/compatibles/head.mjs";import{getI18nTarget as Y,getLocale as Z,getLocaleCodes as ee,setLocale as te}from"./routing/utils.mjs";import{createLocaleFromRouteGetter as oe}from"./routing/extends/router.mjs";import{useRouter as ne,navigateTo as ae}from"../../../../nuxt/dist/app/composables/router.mjs";import{useNuxtApp as D,useRuntimeConfig as v}from"../../../../nuxt/dist/app/nuxt.mjs";import{useState as B}from"../../../../nuxt/dist/app/composables/state.mjs";function re(e,t){return C(e,"setLocaleCookie",t)}function ie(e,t,o){return C(e,"mergeLocaleMessage",t,o)}async function ce(e,t,o,i,s){return C(e,"onBeforeLanguageSwitch",t,o,i,s)}function le(e,t,o){return C(e,"onLanguageSwitched",t,o)}function se(e){return{i18n:e??D().$i18n,router:ne(),runtimeConfig:v(),metaState:B("nuxt-i18n-meta",()=>({}))}}async function ke(e,t,o,i=!1){const{differentDomains:s,skipSettingLocaleOnNavigate:a,lazy:c}=o,l=w(o),d=D(),f=Z(t),r=ee(t);function u(n=f){l===!1||!l.useCookie||a||re(t,n)}if(!e||!i&&s||f===e)return u(),!1;const m=await ce(t,f,e,i,d);if(m&&r.includes(m)){if(f===m)return u(),!1;e=m}if(c){const n=M(t,"fallbackLocale"),p=(g,h)=>ie(t,g,h);if(n){const g=V(n,[e]);await Promise.all(g.map(h=>F(h,y,p)))}await F(e,y,p)}return a?!1:(u(e),te(t,e),await le(t,f,e),!0)}function fe(e){return{log:console.log.bind(console,`${e}:`)}}function ve(e,t,o,i,s){const{strategy:a,defaultLocale:c,differentDomains:l,multiDomainLocales:d}=s,{localeCookie:f}=i,r=w(s);fe("detectLocale");const u=R(o)?o():o,m=W(e,i,u);if(m.reason===j.SSG_IGNORE)return u;if(m.locale&&m.from!=null)return m.locale;let n="";l||d?n||(n=E(A,a,e)):a!=="no_prefix"&&(n||(n=t(e)));const p=r&&r.useCookie&&f;return n||(n=p||u||c||""),n}function xe({route:e,targetLocale:t,routeLocaleGetter:o,calledWithRouting:i=!1}){const s=D(),a=se(),{strategy:c,differentDomains:l}=a.runtimeConfig.public.i18n;let d="";const{fullPath:f}=e.to;if(!l&&(i||c!=="no_prefix")&&o(e.to)!==t){const r=s.$switchLocalePath(t)||s.$localePath(f,t);k(r)&&r&&!x(r,f)&&!r.startsWith("//")&&(d=e.from&&e.from.fullPath===r?"":r)}if((l||G)&&o(e.to)!==t){const r=_(a,t,e.to);k(r)&&r&&!x(r,f)&&!r.startsWith("//")&&(d=r)}return d}function ue(e){return U(e)&&"path"in e&&"statusCode"in e}const me=()=>B(H+":redirect",()=>"");function P(e,t){return ae(e,{redirectCode:t})}async function ye(e,{status:t=302,enableNavigate:o=!1}={}){const{nuxtApp:i,i18n:s,locale:a,route:c}=e,{rootRedirect:l,differentDomains:d,multiDomainLocales:f,skipSettingLocaleOnNavigate:r,configLocales:u,strategy:m}=i.$config.public.i18n;let{redirectPath:n}=e;if(c.path==="/"&&l)return k(l)?n="/"+l:ue(l)&&(n="/"+l.path,t=l.statusCode),n=i.$localePath(n,a),P(n,t);if(f&&m==="prefix_except_default"){const p=T(),g=u.find(S=>{var b;return typeof S!="string"?(b=S.defaultForDomains)==null?void 0:b.find(O=>O===p):!1}),h=typeof g!="string"?g==null?void 0:g.code:void 0;if(c.path.startsWith(`/${h}`))return P(c.path.replace(`/${h}`,""),t);if(!c.path.startsWith(`/${a}`)&&a!==h){const b=oe()(c.path);return P(b!==""?`/${a+c.path.replace(`/${b}`,"")}`:`/${a+(c.path==="/"?"":c.path)}`,t)}else if(n&&c.path!==n)return P(n,t);return}if(d){const p=me();p.value&&p.value!==n&&(p.value=n)}else if(n)return P(n,t)}function Fe(e,t){L(e,"$i18n",Y(t)),L(e,"$getRouteBaseName",$(z)),L(e,"$localePath",$(q)),L(e,"$localeRoute",$(X)),L(e,"$switchLocalePath",$(_)),L(e,"$localeHead",$(Q))}function we(e=v()){return t=>K(t)&&!e.public.i18n.differentDomains}function Ne(e=v()){return(t,o)=>{if(e.public.i18n.differentDomains){const i=N(o);return i?I(i,t):t}else return J(t)}}function _e(){return()=>{const e=D(),{baseUrl:t,defaultLocale:o,differentDomains:i}=e.$config.public.i18n;if(R(t))return t(e);const s=R(o)?o():o;if(i&&s){const a=N(s);if(a)return a}return t}}export{fe as createLogger,ve as detectLocale,xe as detectRedirect,_e as extendBaseUrl,we as extendPrefixable,Ne as extendSwitchLocalePathIntercepter,se as initCommonComposableOptions,Fe as injectNuxtHelpers,ke as loadAndSetLocale,ie as mergeLocaleMessage,ye as navigate,le as onLanguageSwitched,re as setCookieLocale};
//# sourceMappingURL=utils.mjs.map
