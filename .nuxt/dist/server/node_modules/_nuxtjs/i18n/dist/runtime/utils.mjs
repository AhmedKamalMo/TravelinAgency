import{joinURL as O,isEqual as I}from"../../../../ufo/dist/index.mjs";import{isFunction as S,isString as F,isObject as U}from"../../../../_intlify/shared/dist/shared.mjs";import{normalizedLocales as A,localeLoaders as v,NUXT_I18N_MODULE_ID as G}from"../../../../../.nuxt/i18n.options.mjs";import{runtimeDetectBrowserLanguage as N,detectBrowserLanguage as H,DetectFailure as W,getLocaleDomain as j,defineGetter as h,wrapComposable as D,getDomainFromLocale as w,getVueI18nPropertyValue as E,getHost as M,callVueI18nInterfaces as R}from"./internal.mjs";import{makeFallbackLocaleCodes as T,loadLocale as y}from"./messages.mjs";import{getRouteBaseName as V,localePath as z,localeRoute as q,switchLocalePath as x,DefaultSwitchLocalePathIntercepter as X,DefaultPrefixable as J}from"./routing/compatibles/routing.mjs";import{localeHead as K}from"./routing/compatibles/head.mjs";import{getI18nTarget as Q,getLocale as Y,getLocaleCodes as Z,setLocale as ee}from"./routing/utils.mjs";import{createLocaleFromRouteGetter as te}from"./routing/extends/router.mjs";import{useRouter as oe,navigateTo as ne}from"../../../../nuxt/dist/app/composables/router.mjs";import{useNuxtApp as $,useRuntimeConfig as k}from"../../../../nuxt/dist/app/nuxt.mjs";import{useState as B}from"../../../../nuxt/dist/app/composables/state.mjs";function ae(e,t){return R(e,"setLocaleCookie",t)}function re(e,t,n){return R(e,"mergeLocaleMessage",t,n)}async function ie(e,t,n,a,s){return R(e,"onBeforeLanguageSwitch",t,n,a,s)}function ce(e,t,n){return R(e,"onLanguageSwitched",t,n)}function le(e){return{i18n:e??$().$i18n,router:oe(),runtimeConfig:k(),metaState:B("nuxt-i18n-meta",()=>({}))}}async function Se(e,t,n,a=!1){const{differentDomains:s,skipSettingLocaleOnNavigate:r,lazy:i}=n,l=N(n),g=$(),c=Y(t),b=Z(t);function f(o=c){l===!1||!l.useCookie||r||ae(t,o)}if(!e||!a&&s||c===e)return f(),!1;const u=await ie(t,c,e,a,g);if(u&&b.includes(u)){if(c===u)return f(),!1;e=u}if(i){const o=E(t,"fallbackLocale"),m=(d,p)=>re(t,d,p);if(o){const d=T(o,[e]);await Promise.all(d.map(p=>y(p,v,m)))}await y(e,v,m)}return r?!1:(f(e),ee(t,e),await ce(t,c,e),!0)}function se(e){return{log:console.log.bind(console,`${e}:`)}}function ke(e,t,n,a,s){const{strategy:r,defaultLocale:i,differentDomains:l,multiDomainLocales:g}=s,{localeCookie:c}=a,b=N(s);se("detectLocale");const f=S(n)?n():n,u=H(e,a,f);if(u.reason===W.SSG_IGNORE)return f;if(u.locale&&u.from!=null)return u.locale;let o="";l||g?o||(o=j(A,r,e)):r!=="no_prefix"&&(o||(o=t(e)));const m=b&&b.useCookie&&c;return o||(o=m||f||i||""),o}function ve({route:e,targetLocale:t,routeLocaleGetter:n,calledWithRouting:a=!1}){$();const s=le(),{strategy:r,differentDomains:i}=s.runtimeConfig.public.i18n;let l="";const{fullPath:g}=e.to;if(i&&n(e.to)!==t){const c=x(s,t,e.to);F(c)&&c&&!I(c,g)&&!c.startsWith("//")&&(l=c)}return l}function fe(e){return U(e)&&"path"in e&&"statusCode"in e}const ue=()=>B(G+":redirect",()=>"");function L(e,t){return ne(e,{redirectCode:t})}async function ye(e,{status:t=302,enableNavigate:n=!1}={}){const{nuxtApp:a,i18n:s,locale:r,route:i}=e,{rootRedirect:l,differentDomains:g,multiDomainLocales:c,skipSettingLocaleOnNavigate:b,configLocales:f,strategy:u}=a.$config.public.i18n;let{redirectPath:o}=e;if(i.path==="/"&&l)return F(l)?o="/"+l:fe(l)&&(o="/"+l.path,t=l.statusCode),o=a.$localePath(o,r),L(o,t);if(c&&u==="prefix_except_default"){const m=M(),d=f.find(P=>{var C;return typeof P!="string"?(C=P.defaultForDomains)==null?void 0:C.find(_=>_===m):!1}),p=typeof d!="string"?d==null?void 0:d.code:void 0;if(i.path.startsWith(`/${p}`))return L(i.path.replace(`/${p}`,""),t);if(!i.path.startsWith(`/${r}`)&&r!==p){const C=te()(i.path);return L(C!==""?`/${r+i.path.replace(`/${C}`,"")}`:`/${r+(i.path==="/"?"":i.path)}`,t)}else if(o&&i.path!==o)return L(o,t);return}if(g){const m=ue();m.value&&m.value!==o&&(m.value=o)}else if(o)return L(o,t)}function Fe(e,t){h(e,"$i18n",Q(t)),h(e,"$getRouteBaseName",D(V)),h(e,"$localePath",D(z)),h(e,"$localeRoute",D(q)),h(e,"$switchLocalePath",D(x)),h(e,"$localeHead",D(K))}function Ne(e=k()){return t=>J(t)&&!e.public.i18n.differentDomains}function we(e=k()){return(t,n)=>{if(e.public.i18n.differentDomains){const a=w(n);return a?O(a,t):t}else return X(t)}}function xe(){return()=>{const e=$(),{baseUrl:t,defaultLocale:n,differentDomains:a}=e.$config.public.i18n;if(S(t))return t(e);const s=S(n)?n():n;if(a&&s){const r=w(s);if(r)return r}return t}}export{se as createLogger,ke as detectLocale,ve as detectRedirect,xe as extendBaseUrl,Ne as extendPrefixable,we as extendSwitchLocalePathIntercepter,le as initCommonComposableOptions,Fe as injectNuxtHelpers,Se as loadAndSetLocale,re as mergeLocaleMessage,ye as navigate,ce as onLanguageSwitched,ae as setCookieLocale};
//# sourceMappingURL=utils.mjs.map
