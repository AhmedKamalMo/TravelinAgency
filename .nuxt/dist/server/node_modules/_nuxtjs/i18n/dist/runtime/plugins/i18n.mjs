import{executeAsync as f}from"F:/TravelinAgency/node_modules/unctx/dist/index.mjs";import{computed as D}from"vue";import{parallelPlugin as H,vueI18nConfigs as O,localeLoaders as v,localeCodes as F,normalizedLocales as V}from"../../../../../../.nuxt/i18n.options.mjs";import{loadVueI18nOptions as Q,loadInitialMessages as T,loadLocale as $}from"../messages.mjs";import{detectLocale as b,injectNuxtHelpers as j,extendBaseUrl as J,loadAndSetLocale as A,detectRedirect as z,navigate as I,mergeLocaleMessage as K}from"../utils.mjs";import{getHost as Y,runtimeDetectBrowserLanguage as Z,getI18nCookie as q,getLocaleCookie as m,getBrowserLocale as X,setLocaleCookie as ee}from"../internal.mjs";import{getComposer as te,setLocale as ae,getLocale as oe}from"../routing/utils.mjs";import{extendI18n as le}from"../routing/extends/i18n.mjs";import{createLocaleFromRouteGetter as ne}from"../routing/extends/router.mjs";import{defineNuxtPlugin as ie,useNuxtApp as re}from"../../../../../nuxt/dist/app/nuxt.mjs";import{useRoute as ce,useRouter as se,addRouteMiddleware as ge,defineNuxtRouteMiddleware as ue}from"../../../../../nuxt/dist/app/composables/router.mjs";import{createI18n as fe}from"../../../../../vue-i18n/dist/vue-i18n.mjs";const Se=ie({name:"i18n:plugin",parallel:H,async setup(L){let s,d;const C=ce(),{vueApp:M}=L,r=L,E=Y(),{configLocales:P,defaultLocale:k,multiDomainLocales:N,strategy:R}=r.$config.public.i18n,U=P.some(e=>typeof e!="string"&&Array.isArray(e.defaultForDomains));let g;if(k)g=k;else if(U){const e=P.find(t=>typeof t=="string"||!Array.isArray(t.defaultForDomains)?!1:t.defaultForDomains.includes(E??""));g=(e==null?void 0:e.code)??""}else g="";if(N&&(R==="prefix_except_default"||R==="prefix_and_default")){const e=se();e.getRoutes().forEach(t=>{var a;if((a=t.name)!=null&&a.toString().includes("___default"))if(t.name.toString().split("___")[1]!==g)e.removeRoute(t.name);else{const n=t.name.toString().replace("___default","");t.name=n}})}const o={...r.$config.public.i18n,defaultLocale:g};o.baseUrl=J();const p=Z(),c=([s,d]=f(()=>Q(O,re())),s=await s,d(),s);c.messages=c.messages||{},c.fallbackLocale=c.fallbackLocale??!1;const y=ne(),_=e=>e||c.locale||"en-US",w=q();let u=b(C,y,_(o.defaultLocale),{ssg:o.strategy==="no_prefix"?"ssg_ignore":"normal",callType:"setup",firstAccess:!0,localeCookie:m(w,p,o.defaultLocale)},o);c.messages=([s,d]=f(()=>T(c.messages,v,{localeCodes:F,initialLocale:u,lazy:o.lazy,defaultLocale:o.defaultLocale,fallbackLocale:c.fallbackLocale})),s=await s,d(),s),u=_(u);const l=fe({...c,locale:u});let h=!0;const x=e=>u!==e&&h;o.strategy,le(l,{locales:o.configLocales,localeCodes:F,baseUrl:o.baseUrl,context:r,hooks:{onExtendComposer(e){e.strategy=o.strategy,e.localeProperties=D(()=>V.find(t=>t.code===e.locale.value)||{code:e.locale.value}),e.setLocale=async t=>{const a=x(t);await A(t,l,o,a)&&a&&(h=!1);const n=await r.runWithContext(()=>z({route:{to:C},targetLocale:t,routeLocaleGetter:y}));await r.runWithContext(async()=>await I({nuxtApp:r,i18n:l,redirectPath:n,locale:t,route:C},{enableNavigate:!0}))},e.loadLocaleMessages=async t=>{await $(t,v,(i,n)=>K(l,i,n))},e.differentDomains=o.differentDomains,e.defaultLocale=o.defaultLocale,e.getBrowserLocale=()=>X(),e.getLocaleCookie=()=>m(w,p,o.defaultLocale),e.setLocaleCookie=t=>ee(w,t,p),e.onBeforeLanguageSwitch=(t,a,i,n)=>L.callHook("i18n:beforeLocaleSwitch",{oldLocale:t,newLocale:a,initialSetup:i,context:n}),e.onLanguageSwitched=(t,a)=>L.callHook("i18n:localeSwitched",{oldLocale:t,newLocale:a}),e.finalizePendingLocaleChange=async()=>{l.__pendingLocale&&(ae(l,l.__pendingLocale),l.__resolvePendingLocalePromise&&await l.__resolvePendingLocalePromise(),l.__pendingLocale=void 0)},e.waitForPendingLocaleChange=async()=>{l.__pendingLocale&&l.__pendingLocalePromise&&await l.__pendingLocalePromise}},onExtendExportedGlobal(e){return{strategy:{get(){return e.strategy}},localeProperties:{get(){return e.localeProperties.value}},setLocale:{get(){return async t=>Reflect.apply(e.setLocale,e,[t])}},differentDomains:{get(){return e.differentDomains}},defaultLocale:{get(){return e.defaultLocale}},getBrowserLocale:{get(){return()=>Reflect.apply(e.getBrowserLocale,e,[])}},getLocaleCookie:{get(){return()=>Reflect.apply(e.getLocaleCookie,e,[])}},setLocaleCookie:{get(){return t=>Reflect.apply(e.setLocaleCookie,e,[t])}},onBeforeLanguageSwitch:{get(){return(t,a,i,n)=>Reflect.apply(e.onBeforeLanguageSwitch,e,[t,a,i,n])}},onLanguageSwitched:{get(){return(t,a)=>Reflect.apply(e.onLanguageSwitched,e,[t,a])}},finalizePendingLocaleChange:{get(){return()=>Reflect.apply(e.finalizePendingLocaleChange,e,[])}},waitForPendingLocaleChange:{get(){return()=>Reflect.apply(e.waitForPendingLocaleChange,e,[])}}}},onExtendVueI18n(e){return{strategy:{get(){return e.strategy}},localeProperties:{get(){return e.localeProperties.value}},setLocale:{get(){return async t=>Reflect.apply(e.setLocale,e,[t])}},loadLocaleMessages:{get(){return async t=>Reflect.apply(e.loadLocaleMessages,e,[t])}},differentDomains:{get(){return e.differentDomains}},defaultLocale:{get(){return e.defaultLocale}},getBrowserLocale:{get(){return()=>Reflect.apply(e.getBrowserLocale,e,[])}},getLocaleCookie:{get(){return()=>Reflect.apply(e.getLocaleCookie,e,[])}},setLocaleCookie:{get(){return t=>Reflect.apply(e.setLocaleCookie,e,[t])}},onBeforeLanguageSwitch:{get(){return(t,a,i,n)=>Reflect.apply(e.onBeforeLanguageSwitch,e,[t,a,i,n])}},onLanguageSwitched:{get(){return(t,a)=>Reflect.apply(e.onLanguageSwitched,e,[t,a])}},finalizePendingLocaleChange:{get(){return()=>Reflect.apply(e.finalizePendingLocaleChange,e,[])}},waitForPendingLocaleChange:{get(){return()=>Reflect.apply(e.waitForPendingLocaleChange,e,[])}}}}}});const G={__composerExtend:e=>{const t=te(l);return e.strategy=t.strategy,e.localeProperties=D(()=>t.localeProperties.value),e.setLocale=t.setLocale,e.differentDomains=t.differentDomains,e.getBrowserLocale=t.getBrowserLocale,e.getLocaleCookie=t.getLocaleCookie,e.setLocaleCookie=t.setLocaleCookie,e.onBeforeLanguageSwitch=t.onBeforeLanguageSwitch,e.onLanguageSwitched=t.onLanguageSwitched,e.finalizePendingLocaleChange=t.finalizePendingLocaleChange,e.waitForPendingLocaleChange=t.waitForPendingLocaleChange,()=>{}}};M.use(l,G),j(r,l);let S=0;ge("locale-changing",ue(async(e,t)=>{let a,i;const n=b(e,y,()=>oe(l)||_(o.defaultLocale),{ssg:o.strategy==="no_prefix"?"ssg_ignore":"normal",callType:"routing",firstAccess:S===0,localeCookie:m(w,p,o.defaultLocale)},o),B=x(n);([a,i]=f(()=>A(n,l,o,B)),a=await a,i(),a)&&B&&(h=!1);const W=([a,i]=f(()=>r.runWithContext(()=>z({route:{to:e},targetLocale:n,routeLocaleGetter:o.strategy==="no_prefix"?()=>n:y,calledWithRouting:!0}))),a=await a,i(),a);return S++,[a,i]=f(()=>r.runWithContext(async()=>I({nuxtApp:r,i18n:l,redirectPath:W,locale:n,route:e}))),a=await a,i(),a}),{global:!0})}});export{Se as default};
//# sourceMappingURL=i18n.mjs.map
