{"file":"ImageUpload.vue.mjs","mappings":"ytBAiFA,MAAMA,EAAQC,EAoBRC,EAAOC,EAIKC,EAAI,IAAI,EACpB,MAAAC,EAAaD,EAAI,EAAK,EACtBE,EAAYF,EAAI,EAAK,EACrBG,EAAiBH,EAAI,CAAC,EACtBI,EAAQJ,EAAI,EAAE,EACdK,EAAaL,EAAI,EAAE,EACnBM,EAAkBN,EAAIJ,EAAM,UAAU,EAG5C,OAAAW,EAAM,IAAMX,EAAM,WAAaY,GAAa,CAC1CF,EAAgB,MAAQE,CAAA,CACzB,EAGKD,EAAAD,EAAkBE,GAAa,CACnCV,EAAK,oBAAqBU,CAAQ,CAAA,CACnC","names":["props","__props","emit","__emit","ref","isDragOver","uploading","uploadProgress","error","previewUrl","currentImageUrl","watch","newValue"],"sources":["../../../../../components/ui/ImageUpload.vue"],"sourcesContent":["<template>\r\n  <div class=\"space-y-4\">\r\n    <!-- معاينة الصورة الحالية -->\r\n    <div v-if=\"currentImageUrl\" class=\"relative\">\r\n      <img\r\n        :src=\"currentImageUrl\"\r\n        :alt=\"alt\"\r\n        class=\"w-full h-48 object-cover rounded-lg border border-gray-200\"\r\n      />\r\n      <button\r\n        @click=\"removeImage\"\r\n        class=\"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors\"\r\n        title=\"حذف الصورة\"\r\n      >\r\n        <Icon name=\"material-symbols:close\" class=\"h-4 w-4\" />\r\n      </button>\r\n    </div>\r\n\r\n    <!-- منطقة رفع الصورة -->\r\n    <div\r\n      @click=\"triggerFileInput\"\r\n      @dragover.prevent\r\n      @drop.prevent=\"handleDrop\"\r\n      class=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 hover:bg-blue-50 transition-colors cursor-pointer min-h-[120px] bg-gray-50\"\r\n      :class=\"{ 'border-blue-400 bg-blue-50': isDragOver }\"\r\n      style=\"border: 2px dashed #d1d5db; background-color: #f9fafb;\"\r\n    >\r\n      <input\r\n        ref=\"fileInput\"\r\n        type=\"file\"\r\n        accept=\"image/*\"\r\n        @change=\"handleFileSelect\"\r\n        class=\"hidden\"\r\n      />\r\n      \r\n      <div v-if=\"!currentImageUrl\" class=\"space-y-2\">\r\n        <Icon name=\"material-symbols:cloud-upload\" class=\"h-12 w-12 text-gray-400 mx-auto\" />\r\n        <div class=\"text-sm text-gray-600\">\r\n          <p class=\"font-medium\">اضغط لرفع صورة أو اسحبها هنا</p>\r\n          <p class=\"text-xs text-gray-500 mt-1\">PNG, JPG, JPEG حتى 5MB</p>\r\n        </div>\r\n      </div>\r\n      \r\n      <div v-else class=\"space-y-2\">\r\n        <Icon name=\"material-symbols:edit\" class=\"h-8 w-8 text-blue-500 mx-auto\" />\r\n        <p class=\"text-sm text-blue-600 font-medium\">اضغط لتغيير الصورة</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- شريط التقدم -->\r\n    <div v-if=\"uploading\" class=\"space-y-2\">\r\n      <div class=\"flex items-center justify-between text-sm text-gray-600\">\r\n        <span>جاري رفع الصورة...</span>\r\n        <span>{{ uploadProgress }}%</span>\r\n      </div>\r\n      <div class=\"w-full bg-gray-200 rounded-full h-2\">\r\n        <div\r\n          class=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n          :style=\"{ width: uploadProgress + '%' }\"\r\n        ></div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- رسائل الخطأ -->\r\n    <div v-if=\"error\" class=\"p-3 bg-red-100 border border-red-300 rounded-lg\">\r\n      <p class=\"text-sm text-red-700\">{{ error }}</p>\r\n    </div>\r\n\r\n    <!-- معاينة الصورة الجديدة -->\r\n    <div v-if=\"previewUrl && previewUrl !== currentImageUrl\" class=\"space-y-2\">\r\n      <p class=\"text-sm font-medium text-gray-700\">معاينة الصورة الجديدة:</p>\r\n      <img\r\n        :src=\"previewUrl\"\r\n        alt=\"معاينة الصورة\"\r\n        class=\"w-full h-32 object-cover rounded-lg border border-gray-200\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nconst props = defineProps({\r\n  modelValue: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  alt: {\r\n    type: String,\r\n    default: 'صورة'\r\n  },\r\n  maxSize: {\r\n    type: Number,\r\n    default: 5 * 1024 * 1024 // 5MB\r\n  },\r\n  uploadType: {\r\n    type: String,\r\n    default: 'destination', // 'destination' or 'package'\r\n    validator: (value) => ['destination', 'package'].includes(value)\r\n  }\r\n})\r\n\r\nconst emit = defineEmits(['update:modelValue', 'upload-complete', 'upload-error'])\r\n\r\n\r\n// المتغيرات التفاعلية\r\nconst fileInput = ref(null)\r\nconst isDragOver = ref(false)\r\nconst uploading = ref(false)\r\nconst uploadProgress = ref(0)\r\nconst error = ref('')\r\nconst previewUrl = ref('')\r\nconst currentImageUrl = ref(props.modelValue)\r\n\r\n// مراقبة تغيير القيمة الخارجية\r\nwatch(() => props.modelValue, (newValue) => {\r\n  currentImageUrl.value = newValue\r\n})\r\n\r\n// مراقبة تغيير الصورة الحالية\r\nwatch(currentImageUrl, (newValue) => {\r\n  emit('update:modelValue', newValue)\r\n})\r\n\r\n// تفعيل اختيار الملف\r\nconst triggerFileInput = () => {\r\n  fileInput.value?.click()\r\n}\r\n\r\n// التعامل مع اختيار الملف\r\nconst handleFileSelect = (event) => {\r\n  const file = event.target.files[0]\r\n  if (file) {\r\n    processFile(file)\r\n  }\r\n}\r\n\r\n// التعامل مع السحب والإفلات\r\nconst handleDrop = (event) => {\r\n  isDragOver.value = false\r\n  const file = event.dataTransfer.files[0]\r\n  if (file && file.type.startsWith('image/')) {\r\n    processFile(file)\r\n  }\r\n}\r\n\r\n// معالجة الملف\r\nconst processFile = async (file) => {\r\n  // التحقق من نوع الملف\r\n  if (!file.type.startsWith('image/')) {\r\n    error.value = 'يرجى اختيار ملف صورة صالح'\r\n    return\r\n  }\r\n\r\n  // التحقق من حجم الملف\r\n  if (file.size > props.maxSize) {\r\n    error.value = `حجم الملف كبير جداً. الحد الأقصى ${props.maxSize / (1024 * 1024)}MB`\r\n    return\r\n  }\r\n\r\n  // إخفاء رسالة الخطأ\r\n  error.value = ''\r\n\r\n  // إنشاء معاينة\r\n  const reader = new FileReader()\r\n  reader.onload = (e) => {\r\n    previewUrl.value = e.target.result\r\n  }\r\n  reader.readAsDataURL(file)\r\n\r\n  // رفع الصورة\r\n  await uploadImage(file)\r\n}\r\n\r\n// رفع الصورة\r\nconst uploadImage = async (file) => {\r\n  try {\r\n    uploading.value = true\r\n    uploadProgress.value = 0\r\n\r\n    // إنشاء FormData\r\n    const formData = new FormData()\r\n    formData.append('image', file)\r\n\r\n    // محاكاة شريط التقدم\r\n    const progressInterval = setInterval(() => {\r\n      if (uploadProgress.value < 90) {\r\n        uploadProgress.value += Math.random() * 10\r\n      }\r\n    }, 200)\r\n\r\n    // رفع الصورة\r\n    const apiEndpoint = props.uploadType === 'package' \r\n      ? '/api/images/upload-package' \r\n      : '/api/images/upload-destination'\r\n    \r\n    const response = await $fetch(apiEndpoint, {\r\n      method: 'POST',\r\n      body: formData\r\n    })\r\n\r\n    clearInterval(progressInterval)\r\n    uploadProgress.value = 100\r\n\r\n    if (response.success && response.data?.url) {\r\n      currentImageUrl.value = response.data.url\r\n      previewUrl.value = ''\r\n      emit('upload-complete', response.data)\r\n    } else {\r\n      throw new Error(response.message || 'فشل في رفع الصورة')\r\n    }\r\n  } catch (err) {\r\n    console.error('خطأ في رفع الصورة:', err)\r\n    error.value = err.message || 'حدث خطأ في رفع الصورة'\r\n    emit('upload-error', err)\r\n  } finally {\r\n    uploading.value = false\r\n    uploadProgress.value = 0\r\n  }\r\n}\r\n\r\n// حذف الصورة\r\nconst removeImage = () => {\r\n  currentImageUrl.value = ''\r\n  previewUrl.value = ''\r\n  error.value = ''\r\n  if (fileInput.value) {\r\n    fileInput.value.value = ''\r\n  }\r\n}\r\n\r\n// مراقبة السحب\r\nconst handleDragOver = () => {\r\n  isDragOver.value = true\r\n}\r\n\r\nconst handleDragLeave = () => {\r\n  isDragOver.value = false\r\n}\r\n\r\n// إضافة مستمعي الأحداث للسحب\r\nonMounted(() => {\r\n  document.addEventListener('dragover', handleDragOver)\r\n  document.addEventListener('dragleave', handleDragLeave)\r\n})\r\n\r\nonUnmounted(() => {\r\n  document.removeEventListener('dragover', handleDragOver)\r\n  document.removeEventListener('dragleave', handleDragLeave)\r\n})\r\n</script>\r\n"],"version":3}