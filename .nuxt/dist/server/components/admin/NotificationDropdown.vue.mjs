import N from"../../node_modules/_nuxt/icon/dist/runtime/components/index2.mjs";import R from"../../node_modules/nuxt/dist/app/components/nuxt-link.mjs";import{ref as b,computed as I,watch as D,mergeProps as S,unref as s,withCtx as j,createTextVNode as L,useSSRContext as A}from"vue";import{ssrRenderAttrs as M,ssrRenderClass as x,ssrRenderComponent as l,ssrInterpolate as d,ssrIncludeBooleanAttr as O,ssrRenderList as T}from"vue/server-renderer";import{useMessageCounter as z}from"../../composables/useMessageCounter.mjs";import"F:/TravelinAgency/node_modules/hookable/dist/index.mjs";import{onClickOutside as B}from"../../node_modules/_vueuse/core/index.mjs";/* empty css                          */import P from"../../_virtual/_plugin-vue_export-helper.mjs";const u={__name:"NotificationDropdown",__ssrInlineRender:!0,setup(p){const o=b(!1),c=b(null),f=b(!1);z();const i=b([]),v=I(()=>i.value.filter(t=>t.status==="new").length);B(c,()=>{o.value=!1}),D(o,async t=>{t&&await k()});const k=async()=>{try{f.value=!0;const t=await $fetch("/api/contact-messages");t&&t.messages&&(i.value=t.messages.filter(e=>e.status==="new").slice(0,10).map(e=>({id:e.id,type:e.type==="booking"?"booking":"contact",title:e.type==="booking"?"استفسار عن باقة":"رسالة جديدة",description:e.message.length>100?e.message.substring(0,100)+"...":e.message,name:e.name,phone:e.phone,email:e.email,is_read:e.is_read,status:e.status,created_at:e.created_at})))}catch(t){console.error("خطأ في تحميل الإشعارات:",t),i.value=[]}finally{f.value=!1}},$=t=>({contact:"material-symbols:message",booking:"material-symbols:event",package:"material-symbols:luggage",destination:"material-symbols:place"})[t]||"material-symbols:notifications",g=t=>({contact:"text-blue-600",booking:"text-green-600",package:"text-purple-600",destination:"text-orange-600"})[t]||"text-gray-600",h=t=>{const e=new Date(t),n=new Date-e;return n<6e4?"الآن":n<36e5?`${Math.floor(n/6e4)} دقيقة`:n<864e5?`${Math.floor(n/36e5)} ساعة`:e.toLocaleDateString("ar-SA")};return(t,e,r,n)=>{const m=N,C=R;e(`<div${M(S({class:"relative",ref_key:"notificationRef",ref:c},n))} data-v-f979117b><button class="${x([{"bg-pink-400/20":s(o)},"p-2 rounded-full text-white hover:text-pink-100 hover:bg-pink-400/30 transition-all duration-200 relative"])}" data-v-f979117b>`),e(l(m,{name:"material-symbols:notifications-outline",class:"h-6 w-6"},null,r)),s(v)>0?e(`<span class="absolute -top-1 -right-1 h-5 w-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-medium animate-pulse" data-v-f979117b>${d(s(v)>99?"99+":s(v))}</span>`):e("<!---->"),e("</button>"),s(o)?(e('<div class="absolute left-0 mt-2 w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 max-h-96 overflow-hidden backdrop-blur-sm" data-v-f979117b><div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between" data-v-f979117b><h3 class="text-lg font-semibold text-gray-900" data-v-f979117b>الإشعارات</h3><div class="flex items-center space-x-2 space-x-reverse" data-v-f979117b>'),s(v)>0?e('<button class="text-sm text-blue-600 hover:text-blue-800 font-medium" data-v-f979117b> تعيين الكل كمقروء </button>'):e("<!---->"),e(`<button class="p-1 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100"${O(s(f))?" disabled":""} data-v-f979117b>`),e(l(m,{name:"material-symbols:refresh",class:["h-4 w-4",{"animate-spin":s(f)}]},null,r)),e('</button></div></div><div class="max-h-80 overflow-y-auto" data-v-f979117b>'),s(f)?(e('<div class="p-4 text-center" data-v-f979117b>'),e(l(m,{name:"material-symbols:refresh",class:"h-6 w-6 animate-spin mx-auto text-gray-400"},null,r)),e('<p class="text-sm text-gray-500 mt-2" data-v-f979117b>جاري تحميل الإشعارات...</p></div>')):s(i).length===0?(e('<div class="p-4 text-center" data-v-f979117b>'),e(l(m,{name:"material-symbols:notifications-off",class:"h-8 w-8 mx-auto text-gray-400"},null,r)),e('<p class="text-sm text-gray-500 mt-2" data-v-f979117b>لا توجد إشعارات جديدة</p></div>')):(e('<div class="divide-y divide-gray-100" data-v-f979117b><!--[-->'),T(s(i),a=>{e(`<div class="${x([{"bg-gradient-to-r from-blue-50 to-purple-50 border-r-4 border-blue-500":!a.is_read},"p-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 cursor-pointer transition-all duration-200"])}" data-v-f979117b><div class="flex items-start space-x-3 space-x-reverse" data-v-f979117b><div class="flex-shrink-0" data-v-f979117b><div class="${x([g(a.type).replace("text-","bg-").replace("-600","-100"),"h-8 w-8 rounded-full flex items-center justify-center"])}" data-v-f979117b>`),e(l(m,{name:$(a.type),class:["h-4 w-4",g(a.type)]},null,r)),e(`</div></div><div class="flex-1 min-w-0" data-v-f979117b><div class="flex items-center justify-between" data-v-f979117b><p class="text-sm font-medium text-gray-900 truncate" data-v-f979117b>${d(a.title)}</p><div class="flex items-center space-x-2 space-x-reverse" data-v-f979117b><span class="text-xs text-gray-500" data-v-f979117b>${d(h(a.created_at))}</span>`),a.is_read?e("<!---->"):e('<div class="h-2 w-2 bg-blue-500 rounded-full" data-v-f979117b></div>'),e(`</div></div><p class="text-sm text-gray-600 mt-1 line-clamp-2" data-v-f979117b>${d(a.description)}</p><div class="mt-2 flex items-center text-xs text-gray-500" data-v-f979117b><span class="truncate" data-v-f979117b>${d(a.name)}</span><span class="mx-2" data-v-f979117b>•</span><span class="truncate" data-v-f979117b>${d(a.phone)}</span></div></div></div></div>`)}),e("<!--]--></div>")),e("</div>"),s(i).length>0?(e('<div class="px-4 py-3 border-t border-gray-200" data-v-f979117b>'),e(l(C,{to:"/admin/notifications",class:"block text-center text-sm text-blue-600 hover:text-blue-800 font-medium",onClick:a=>o.value=!1},{default:j((a,y,U,V)=>{if(y)y(" عرض جميع الإشعارات ");else return[L(" عرض جميع الإشعارات ")]}),_:1},r)),e("</div>")):e("<!---->"),e("</div>")):e("<!---->"),e("</div>")}}},w=u.setup;u.setup=(p,o)=>{const c=A();return(c.modules||(c.modules=new Set)).add("components/admin/NotificationDropdown.vue"),w?w(p,o):void 0};const W=P(u,[["__scopeId","data-v-f979117b"]]);export{W as default};
//# sourceMappingURL=NotificationDropdown.vue.mjs.map
