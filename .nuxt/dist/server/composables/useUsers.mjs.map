{"version":3,"file":"useUsers.mjs","sources":["../../../../composables/useUsers.ts"],"sourcesContent":["import type { User, CreateUserRequest, UpdateUserRequest, UsersResponse, UserResponse } from '~/types/user'\r\n\r\nexport const useUsers = () => {\r\n  const users = ref<User[]>([])\r\n  const currentUser = ref<User | null>(null)\r\n  const isLoading = ref(false)\r\n  const error = ref<string | null>(null)\r\n\r\n  /**\r\n   * جلب جميع المستخدمين\r\n   */\r\n  const fetchUsers = async (params?: {\r\n    page?: number\r\n    limit?: number\r\n    search?: string\r\n    status?: string\r\n    role?: string\r\n  }) => {\r\n    try {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      const queryParams = new URLSearchParams()\r\n      if (params?.page) queryParams.append('page', params.page.toString())\r\n      if (params?.limit) queryParams.append('limit', params.limit.toString())\r\n      if (params?.search) queryParams.append('search', params.search)\r\n      if (params?.status) queryParams.append('status', params.status)\r\n      if (params?.role) queryParams.append('role', params.role)\r\n\r\n      const response = await $fetch<UsersResponse>(`/api/admin/users?${queryParams.toString()}`)\r\n      \r\n      if (response.success && response.data) {\r\n        users.value = response.data.users\r\n        return response.data\r\n      } else {\r\n        throw new Error(response.error || 'Failed to fetch users')\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Error fetching users:', err)\r\n      error.value = err.message || 'Failed to fetch users'\r\n      users.value = []\r\n      throw err\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جلب مستخدم واحد\r\n   */\r\n  const fetchUser = async (userId: string | number) => {\r\n    try {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      const response = await $fetch<UserResponse>(`/api/admin/users/${userId}`)\r\n      \r\n      if (response.success && response.data) {\r\n        currentUser.value = response.data\r\n        return response.data\r\n      } else {\r\n        throw new Error(response.error || 'Failed to fetch user')\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Error fetching user:', err)\r\n      error.value = err.message || 'Failed to fetch user'\r\n      currentUser.value = null\r\n      throw err\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إنشاء مستخدم جديد\r\n   */\r\n  const createUser = async (userData: CreateUserRequest) => {\r\n    try {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      const response = await $fetch<UserResponse>('/api/admin/users', {\r\n        method: 'POST',\r\n        body: userData\r\n      })\r\n\r\n      if (response.success && response.data) {\r\n        // إضافة المستخدم الجديد إلى القائمة\r\n        users.value.unshift(response.data)\r\n        return response.data\r\n      } else {\r\n        throw new Error(response.error || 'Failed to create user')\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Error creating user:', err)\r\n      error.value = err.message || 'Failed to create user'\r\n      throw err\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث مستخدم\r\n   */\r\n  const updateUser = async (userId: string | number, userData: UpdateUserRequest) => {\r\n    try {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      const response = await $fetch<UserResponse>(`/api/admin/users/${userId}`, {\r\n        method: 'PUT',\r\n        body: userData\r\n      })\r\n\r\n      if (response.success && response.data) {\r\n        // تحديث المستخدم في القائمة\r\n        const index = users.value.findIndex(u => u.id.toString() === userId.toString())\r\n        if (index !== -1) {\r\n          users.value[index] = response.data\r\n        }\r\n        \r\n        // تحديث المستخدم الحالي إذا كان هو نفسه\r\n        if (currentUser.value?.id.toString() === userId.toString()) {\r\n          currentUser.value = response.data\r\n        }\r\n        \r\n        return response.data\r\n      } else {\r\n        throw new Error(response.error || 'Failed to update user')\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Error updating user:', err)\r\n      error.value = err.message || 'Failed to update user'\r\n      throw err\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حذف مستخدم\r\n   */\r\n  const deleteUser = async (userId: string | number) => {\r\n    try {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      const response = await $fetch<UserResponse>(`/api/admin/users/${userId}`, {\r\n        method: 'DELETE'\r\n      })\r\n\r\n      if (response.success) {\r\n        // إزالة المستخدم من القائمة\r\n        users.value = users.value.filter(u => u.id.toString() !== userId.toString())\r\n        \r\n        // مسح المستخدم الحالي إذا كان هو نفسه\r\n        if (currentUser.value?.id.toString() === userId.toString()) {\r\n          currentUser.value = null\r\n        }\r\n        \r\n        return true\r\n      } else {\r\n        throw new Error(response.error || 'Failed to delete user')\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Error deleting user:', err)\r\n      error.value = err.message || 'Failed to delete user'\r\n      throw err\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تغيير حالة المستخدم\r\n   */\r\n  const toggleUserStatus = async (userId: string | number, newStatus: 'active' | 'inactive' | 'suspended') => {\r\n    try {\r\n      return await updateUser(userId, { status: newStatus })\r\n    } catch (err: any) {\r\n      console.error('Error toggling user status:', err)\r\n      throw err\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تغيير دور المستخدم\r\n   */\r\n  const changeUserRole = async (userId: string | number, newRole: 'admin' | 'moderator' | 'user') => {\r\n    try {\r\n      return await updateUser(userId, { role: newRole })\r\n    } catch (err: any) {\r\n      console.error('Error changing user role:', err)\r\n      throw err\r\n    }\r\n  }\r\n\r\n  /**\r\n   * البحث في المستخدمين\r\n   */\r\n  const searchUsers = async (query: string) => {\r\n    try {\r\n      return await fetchUsers({ search: query })\r\n    } catch (err: any) {\r\n      console.error('Error searching users:', err)\r\n      throw err\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تصفية المستخدمين\r\n   */\r\n  const filterUsers = async (filters: {\r\n    status?: string\r\n    role?: string\r\n    page?: number\r\n    limit?: number\r\n  }) => {\r\n    try {\r\n      return await fetchUsers(filters)\r\n    } catch (err: any) {\r\n      console.error('Error filtering users:', err)\r\n      throw err\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إحصائيات المستخدمين\r\n   */\r\n  const getUserStats = computed(() => {\r\n    const total = users.value.length\r\n    const active = users.value.filter(u => u.status === 'active').length\r\n    const inactive = users.value.filter(u => u.status === 'inactive').length\r\n    const suspended = users.value.filter(u => u.status === 'suspended').length\r\n    \r\n    const today = new Date()\r\n    today.setHours(0, 0, 0, 0)\r\n    const newToday = users.value.filter(u => new Date(u.created_at) >= today).length\r\n    \r\n    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000)\r\n    const newThisWeek = users.value.filter(u => new Date(u.created_at) >= weekAgo).length\r\n    \r\n    const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000)\r\n    const newThisMonth = users.value.filter(u => new Date(u.created_at) >= monthAgo).length\r\n\r\n    return {\r\n      total,\r\n      active,\r\n      inactive,\r\n      suspended,\r\n      newToday,\r\n      newThisWeek,\r\n      newThisMonth\r\n    }\r\n  })\r\n\r\n  /**\r\n   * دوال المساعدة\r\n   */\r\n  const getRoleName = (role: string) => {\r\n    const roles = {\r\n      admin: 'مدير',\r\n      moderator: 'مشرف',\r\n      user: 'مستخدم'\r\n    }\r\n    return roles[role as keyof typeof roles] || role\r\n  }\r\n\r\n  const getRoleColor = (role: string) => {\r\n    const colors = {\r\n      admin: 'bg-red-100 text-red-800',\r\n      moderator: 'bg-blue-100 text-blue-800',\r\n      user: 'bg-gray-100 text-gray-800'\r\n    }\r\n    return colors[role as keyof typeof colors] || 'bg-gray-100 text-gray-800'\r\n  }\r\n\r\n  const getStatusName = (status: string) => {\r\n    const statuses = {\r\n      active: 'نشط',\r\n      inactive: 'غير نشط',\r\n      suspended: 'معلق'\r\n    }\r\n    return statuses[status as keyof typeof statuses] || status\r\n  }\r\n\r\n  const getStatusColor = (status: string) => {\r\n    const colors = {\r\n      active: 'bg-green-100 text-green-800',\r\n      inactive: 'bg-red-100 text-red-800',\r\n      suspended: 'bg-orange-100 text-orange-800'\r\n    }\r\n    return colors[status as keyof typeof colors] || 'bg-gray-100 text-gray-800'\r\n  }\r\n\r\n  const formatDate = (dateString: string) => {\r\n    const date = new Date(dateString)\r\n    return date.toLocaleDateString('ar-SA', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    })\r\n  }\r\n\r\n  return {\r\n    // البيانات\r\n    users: readonly(users),\r\n    currentUser: readonly(currentUser),\r\n    isLoading: readonly(isLoading),\r\n    error: readonly(error),\r\n    userStats: getUserStats,\r\n\r\n    // العمليات\r\n    fetchUsers,\r\n    fetchUser,\r\n    createUser,\r\n    updateUser,\r\n    deleteUser,\r\n    toggleUserStatus,\r\n    changeUserRole,\r\n    searchUsers,\r\n    filterUsers,\r\n\r\n    // دوال المساعدة\r\n    getRoleName,\r\n    getRoleColor,\r\n    getStatusName,\r\n    getStatusColor,\r\n    formatDate\r\n  }\r\n}\r\n\r\n\r\n"],"names":["useUsers","users","ref","currentUser","isLoading","error","fetchUsers","params","queryParams","response","err","fetchUser","userId","createUser","userData","updateUser","index","u","_a","deleteUser","toggleUserStatus","newStatus","changeUserRole","newRole","searchUsers","query","filterUsers","filters","getUserStats","computed","total","active","inactive","suspended","today","newToday","weekAgo","newThisWeek","monthAgo","newThisMonth","getRoleName","role","getRoleColor","getStatusName","status","getStatusColor","formatDate","dateString","readonly"],"mappings":"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"}