import{ref as i,computed as A,readonly as d}from"vue";const k=()=>{const s=i([]),c=i(null),n=i(!1),a=i(null),g=async e=>{try{n.value=!0,a.value=null;const t=new URLSearchParams;e!=null&&e.page&&t.append("page",e.page.toString()),e!=null&&e.limit&&t.append("limit",e.limit.toString()),e!=null&&e.search&&t.append("search",e.search),e!=null&&e.status&&t.append("status",e.status),e!=null&&e.role&&t.append("role",e.role);const r=await $fetch(`/api/admin/users?${t.toString()}`);if(r.success&&r.data)return s.value=r.data.users,r.data;throw new Error(r.error||"Failed to fetch users")}catch(t){throw console.error("Error fetching users:",t),a.value=t.message||"Failed to fetch users",s.value=[],t}finally{n.value=!1}},v=async e=>{try{n.value=!0,a.value=null;const t=await $fetch(`/api/admin/users/${e}`);if(t.success&&t.data)return c.value=t.data,t.data;throw new Error(t.error||"Failed to fetch user")}catch(t){throw console.error("Error fetching user:",t),a.value=t.message||"Failed to fetch user",c.value=null,t}finally{n.value=!1}},w=async e=>{try{n.value=!0,a.value=null;const t=await $fetch("/api/admin/users",{method:"POST",body:e});if(t.success&&t.data)return s.value.unshift(t.data),t.data;throw new Error(t.error||"Failed to create user")}catch(t){throw console.error("Error creating user:",t),a.value=t.message||"Failed to create user",t}finally{n.value=!1}},h=async(e,t)=>{var r;try{n.value=!0,a.value=null;const o=await $fetch(`/api/admin/users/${e}`,{method:"PUT",body:t});if(o.success&&o.data){const u=s.value.findIndex(f=>f.id.toString()===e.toString());return u!==-1&&(s.value[u]=o.data),((r=c.value)==null?void 0:r.id.toString())===e.toString()&&(c.value=o.data),o.data}else throw new Error(o.error||"Failed to update user")}catch(o){throw console.error("Error updating user:",o),a.value=o.message||"Failed to update user",o}finally{n.value=!1}},y=async e=>{var t;try{n.value=!0,a.value=null;const r=await $fetch(`/api/admin/users/${e}`,{method:"DELETE"});if(r.success)return s.value=s.value.filter(o=>o.id.toString()!==e.toString()),((t=c.value)==null?void 0:t.id.toString())===e.toString()&&(c.value=null),!0;throw new Error(r.error||"Failed to delete user")}catch(r){throw console.error("Error deleting user:",r),a.value=r.message||"Failed to delete user",r}finally{n.value=!1}},S=async(e,t)=>{try{return await h(e,{status:t})}catch(r){throw console.error("Error toggling user status:",r),r}},E=async(e,t)=>{try{return await h(e,{role:t})}catch(r){throw console.error("Error changing user role:",r),r}},U=async e=>{try{return await g({search:e})}catch(t){throw console.error("Error searching users:",t),t}},b=async e=>{try{return await g(e)}catch(t){throw console.error("Error filtering users:",t),t}},x=A(()=>{const e=s.value.length,t=s.value.filter(l=>l.status==="active").length,r=s.value.filter(l=>l.status==="inactive").length,o=s.value.filter(l=>l.status==="suspended").length,u=new Date;u.setHours(0,0,0,0);const f=s.value.filter(l=>new Date(l.created_at)>=u).length,p=new Date(u.getTime()-7*24*60*60*1e3),L=s.value.filter(l=>new Date(l.created_at)>=p).length,P=new Date(u.getTime()-30*24*60*60*1e3),R=s.value.filter(l=>new Date(l.created_at)>=P).length;return{total:e,active:t,inactive:r,suspended:o,newToday:f,newThisWeek:L,newThisMonth:R}}),D=e=>({admin:"مدير",moderator:"مشرف",user:"مستخدم"})[e]||e,F=e=>({admin:"bg-red-100 text-red-800",moderator:"bg-blue-100 text-blue-800",user:"bg-gray-100 text-gray-800"})[e]||"bg-gray-100 text-gray-800",$=e=>({active:"نشط",inactive:"غير نشط",suspended:"معلق"})[e]||e,T=e=>({active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-800",suspended:"bg-orange-100 text-orange-800"})[e]||"bg-gray-100 text-gray-800",m=e=>new Date(e).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return{users:d(s),currentUser:d(c),isLoading:d(n),error:d(a),userStats:x,fetchUsers:g,fetchUser:v,createUser:w,updateUser:h,deleteUser:y,toggleUserStatus:S,changeUserRole:E,searchUsers:U,filterUsers:b,getRoleName:D,getRoleColor:F,getStatusName:$,getStatusColor:T,formatDate:m}};export{k as useUsers};
//# sourceMappingURL=useUsers.mjs.map
