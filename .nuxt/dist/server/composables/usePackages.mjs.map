{"version":3,"file":"usePackages.mjs","sources":["../../../../composables/usePackages.ts"],"sourcesContent":["// import type { Database } from '~/types/supabase'\nimport { ref, onMounted, onUnmounted } from 'vue'\n\nexport interface PackageOptions {\n  flight?: boolean\n  hotel?: boolean\n  transportation?: boolean\n  hotelGrade?: number // Hotel grade (stars), e.g., 3, 4, 5\n}\n\nexport interface Package {\n  id: string\n  image_url: string\n  title_ar: string\n  title_en: string\n  description_ar: string\n  description_en: string\n  travel_period?: string\n  duration_days: number\n  price: number\n  max_persons?: number\n  featured?: boolean | number\n  included_options?: PackageOptions\n}\n\n\n\nexport function usePackages() {\n  // Create reactive state - start with pending true to ensure consistent initial state\n  const packages = ref<Package[]>([])\n  const pending = ref(true) // Start with pending true for consistent hydration\n  const error = ref<Error | null>(null)\n\n  // Fetch function\n  const fetchPackages = async () => {\n    if (pending.value && packages.value.length > 0) return // Prevent multiple simultaneous requests if we already have data\n    \n    pending.value = true\n    error.value = null\n    \n    try {\n      console.log('usePackages: Fetching packages from API...')\n      const res = await fetch('/api/packages')\n      if (!res.ok) {\n        console.error('usePackages: Failed to fetch packages:', res.status, res.statusText)\n        throw new Error('Failed to fetch packages')\n      }\n      const result = await res.json()\n      console.log('usePackages: API response:', result)\n      console.log('usePackages: Packages data:', result.data)\n      packages.value = result.data as Package[]\n    } catch (err) {\n      error.value = err as Error\n      console.error('usePackages: Error fetching packages:', err)\n    } finally {\n      pending.value = false\n    }\n  }\n\n  // Initialize data fetching\n  const initializePackages = () => {\n    fetchPackages()\n  }\n\n  // Both server and client: fetch on mount for consistency\n  if (process.client) {\n    onMounted(initializePackages)\n  } else {\n    // Server-side: Start fetching immediately\n    initializePackages()\n  }\n\n  // Listen for auto-refresh events from the plugin\n  if (process.client) {\n    onMounted(() => {\n      const handlePackagesRefresh = (event: CustomEvent) => {\n        if (packages.value) {\n          packages.value = event.detail\n          console.log('ðŸ”„ Packages updated from auto-refresh')\n        }\n      }\n      \n      window.addEventListener('packages-refreshed', handlePackagesRefresh as EventListener)\n      \n      onUnmounted(() => {\n        window.removeEventListener('packages-refreshed', handlePackagesRefresh as EventListener)\n      })\n    })\n  }\n\n  // Get all packages\n  const getPackages = () => {\n    const allPackages = packages.value || []\n    console.log('getPackages called, returning:', allPackages.length, 'packages')\n    return allPackages\n  }\n\n  // Get package by ID\n  const getPackageById = (id: string) => getPackages().find(p => p.id === id)\n\n  // Refresh function\n  const refresh = () => {\n    return fetchPackages()\n  }\n\n  return {\n    packages,\n    getPackages,\n    getPackageById,\n    pending,\n    error,\n    refresh\n  }\n}"],"names":["usePackages","packages","ref","pending","error","fetchPackages","res","result","err","getPackages","allPackages","id","p"],"mappings":"0BA2BO,SAASA,GAAc,CAEtB,MAAAC,EAAWC,EAAe,EAAE,EAC5BC,EAAUD,EAAI,EAAI,EAClBE,EAAQF,EAAkB,IAAI,EAG9BG,EAAgB,SAAY,CAChC,GAAI,EAAAF,EAAQ,OAASF,EAAS,MAAM,OAAS,GAE7C,CAAAE,EAAQ,MAAQ,GAChBC,EAAM,MAAQ,KAEV,GAAA,CACF,QAAQ,IAAI,4CAA4C,EAClD,MAAAE,EAAM,MAAM,MAAM,eAAe,EACnC,GAAA,CAACA,EAAI,GACP,cAAQ,MAAM,yCAA0CA,EAAI,OAAQA,EAAI,UAAU,EAC5E,IAAI,MAAM,0BAA0B,EAEtC,MAAAC,EAAS,MAAMD,EAAI,KAAK,EACtB,QAAA,IAAI,6BAA8BC,CAAM,EACxC,QAAA,IAAI,8BAA+BA,EAAO,IAAI,EACtDN,EAAS,MAAQM,EAAO,WACjBC,EAAK,CACZJ,EAAM,MAAQI,EACN,QAAA,MAAM,wCAAyCA,CAAG,CAAA,QAC1D,CACAL,EAAQ,MAAQ,EAAA,EAEpB,GAG2B,IAAM,CACjBE,EAAA,CAChB,GAOqB,EAsBrB,MAAMI,EAAc,IAAM,CAClB,MAAAC,EAAcT,EAAS,OAAS,CAAC,EACvC,eAAQ,IAAI,iCAAkCS,EAAY,OAAQ,UAAU,EACrEA,CACT,EAUO,MAAA,CACL,SAAAT,EACA,YAAAQ,EACA,eAVsBE,GAAeF,EAAY,EAAE,KAAKG,GAAKA,EAAE,KAAOD,CAAE,EAWxE,QAAAR,EACA,MAAAC,EACA,QAVc,IACPC,EAAc,CAUvB,CACF"}