{"version":3,"file":"admin.mjs","sources":["../../../../middleware/admin.ts"],"sourcesContent":["export default defineNuxtRouteMiddleware(async (to) => {\r\n  console.log('🚀 Admin middleware called for:', to.path)\r\n  \r\n  const { user, checkAuth } = useAuth()\r\n\r\n  // Skip middleware for login page to avoid redirect loops\r\n  if (to.path === '/admin/login') {\r\n    console.log('⏭️ Skipping middleware for login page')\r\n    return\r\n  }\r\n\r\n  // التحقق من وجود مستخدم مسجل\r\n  let currentUser = user.value\r\n  \r\n  if (!currentUser) {\r\n    console.log('👤 No user in state, checking auth...')\r\n    try {\r\n      currentUser = await checkAuth(true) // Use silent mode to avoid console noise\r\n    } catch (error) {\r\n      console.error('❌ Auth check failed:', error)\r\n      return navigateTo('/admin/login')\r\n    }\r\n  } else {\r\n    console.log('✅ User already authenticated from cookie:', currentUser.email)\r\n  }\r\n\r\n  // التحقق من المستخدم والصلاحيات مباشرة\r\n  if (!currentUser || !currentUser.role || !['admin', 'super_admin', 'moderator'].includes(currentUser.role)) {\r\n    console.log('❌ No authenticated admin user found, redirecting to login')\r\n    return navigateTo('/admin/login')\r\n  }\r\n  \r\n  console.log('✅ User has admin privileges:', currentUser.email, 'role:', currentUser.role)\r\n  console.log('✅ Middleware completed successfully for:', to.path)\r\n})\r\n"],"names":["admin","defineNuxtRouteMiddleware","to","__temp","__restore","useAuth","currentUser","user","__executeAsync","checkAuth","error","navigateTo"],"mappings":"yPACE,MAA+CA,EAAAC,EAAA,MAAAC,GAAO,CAAA,IAAAC,EAAAC,EAEtD,QAAQ,IAAA,kCAA4BF,EAAA,IAAA,EAGhC,KAAA,mBAA4B,EAAAG,EAAA,EAC9B,GAAAH,EAAA,OAAmD,eAAA,CACnD,QAAA,IAAA,uCAAA,EACF,MAGA,CAEA,IAAII,EAAcC,EAAA,MAChB,GAAAD,EASF,QAAA,IAAA,4CAAAA,EAAA,KAAA,MATqD,CAC/C,QAAA,IAAA,uCAAA,EACY,GAAA,IACA,CAAAH,EAAAC,CAAA,EAAAI,EAAA,IAAAC,EAAA,EAAA,CAAA,EAAAN,EAAA,MAAAA,EAAAC,EAAA,EAAAD,EACN,OAAAO,EAAM,CACd,4CAAgCA,CAAA,EAClCC,EAAA,cAAA,CAAA,CAEA,CAKA,GAAA,CAAAL,GAAuE,CAAAA,EAAA,MAAA,CAAA,CAAA,QAAA,cAAA,WAAA,EAAA,SAAAA,EAAA,IAAA,EACvE,8EAAgC,EAClCK,EAAA,cAAA,EAGQ,QAAA,IAAI,+BAA4CL,EAAA,MAAO,QAAAA,EAAA,IAAA,EACjE,QAAC,IAAA,2CAAAJ,EAAA,IAAA"}