import{executeAsync as c}from"F:/TravelinAgency/node_modules/unctx/dist/index.mjs";import{defineNuxtRouteMiddleware as s,navigateTo as i}from"../node_modules/nuxt/dist/app/composables/router.mjs";import{useAuth as d}from"../composables/useAuth.mjs";const f=s(async r=>{let o,l;console.log("🚀 Admin middleware called for:",r.path);const{user:n,checkAuth:t}=d();if(r.path==="/admin/login"){console.log("⏭️ Skipping middleware for login page");return}let e=n.value;if(e)console.log("✅ User already authenticated from cookie:",e.email);else{console.log("👤 No user in state, checking auth...");try{e=([o,l]=c(()=>t(!0)),o=await o,l(),o)}catch(a){return console.error("❌ Auth check failed:",a),i("/admin/login")}}if(!e||!e.role||!["admin","super_admin","moderator"].includes(e.role))return console.log("❌ No authenticated admin user found, redirecting to login"),i("/admin/login");console.log("✅ User has admin privileges:",e.email,"role:",e.role),console.log("✅ Middleware completed successfully for:",r.path)});export{f as default};
//# sourceMappingURL=admin.mjs.map
