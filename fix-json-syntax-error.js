#!/usr/bin/env node

console.log('ðŸ”§ FIXING JSON SYNTAX ERROR');
console.log('============================\n');

console.log('ðŸ“‹ FIXES FOR JSON SYNTAX ERROR:');
console.log('================================');
console.log('');
console.log('# 1. Check the current api-handler.php for syntax issues');
console.log('tail -20 api-handler.php');
console.log('');
console.log('# 2. Fix the JSON syntax error in api-handler.php');
console.log('cat > api-handler-fixed.php << "EOF"');
console.log('<?php');
console.log('header("Content-Type: application/json");');
console.log('header("Access-Control-Allow-Origin: *");');
console.log('header("Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS");');
console.log('header("Access-Control-Allow-Headers: Content-Type, Authorization");');
console.log('');
console.log('if ($_SERVER["REQUEST_METHOD"] === "OPTIONS") {');
console.log('    http_response_code(200);');
console.log('    exit;');
console.log('}');
console.log('');
console.log('$uri = $_SERVER["REQUEST_URI"];');
console.log('$path = parse_url($uri, PHP_URL_PATH);');
console.log('');
console.log('try {');
console.log('    switch ($path) {');
console.log('        case "/api/packages":');
console.log('            $packages = [');
console.log('                [');
console.log('                    "id" => 1,');
console.log('                    "title" => "Dubai Luxury Package",');
console.log('                    "description" => "Experience the luxury of Dubai with our premium package",');
console.log('                    "price" => 2500,');
console.log('                    "duration" => "7 days",');
console.log('                    "image" => "/images/packages/dubai-luxury.jpg",');
console.log('                    "featured" => true,');
console.log('                    "destination" => "Dubai, UAE"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => 2,');
console.log('                    "title" => "Bali Paradise",');
console.log('                    "description" => "Discover the beauty of Bali with our tropical package",');
console.log('                    "price" => 1800,');
console.log('                    "duration" => "5 days",');
console.log('                    "image" => "/images/packages/bali-paradise.jpg",');
console.log('                    "featured" => true,');
console.log('                    "destination" => "Bali, Indonesia"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => 3,');
console.log('                    "title" => "London Royal Experience",');
console.log('                    "description" => "Explore the royal heritage of London",');
console.log('                    "price" => 2200,');
console.log('                    "duration" => "6 days",');
console.log('                    "image" => "/images/packages/london-royal.jpg",');
console.log('                    "featured" => true,');
console.log('                    "destination" => "London, UK"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => 4,');
console.log('                    "title" => "Paris Romance",');
console.log('                    "description" => "Romantic getaway in the city of love",');
console.log('                    "price" => 2000,');
console.log('                    "duration" => "5 days",');
console.log('                    "image" => "/images/packages/paris-romance.jpg",');
console.log('                    "featured" => true,');
console.log('                    "destination" => "Paris, France"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => 5,');
console.log('                    "title" => "Maldives Luxury",');
console.log('                    "description" => "Ultimate luxury in the Maldives",');
console.log('                    "price" => 3500,');
console.log('                    "duration" => "7 days",');
console.log('                    "image" => "/images/packages/maldives-luxury.jpg",');
console.log('                    "featured" => true,');
console.log('                    "destination" => "Maldives"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => 6,');
console.log('                    "title" => "Tokyo Modern",');
console.log('                    "description" => "Experience modern Japan in Tokyo",');
console.log('                    "price" => 2800,');
console.log('                    "duration" => "8 days",');
console.log('                    "image" => "/images/packages/tokyo-modern.jpg",');
console.log('                    "featured" => true,');
console.log('                    "destination" => "Tokyo, Japan"');
console.log('                ]');
console.log('            ];');
console.log('            echo json_encode($packages, JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/cms/site-settings":');
console.log('            $publicOnly = $_GET["public_only"] ?? false;');
console.log('            $settings = [');
console.log('                "site_name" => "World Trip Agency",');
console.log('                "site_description" => "Your premier travel partner",');
console.log('                "contact_email" => "info@worldtripagency.com",');
console.log('                "contact_phone" => "+966 50 123 4567",');
console.log('                "logo_url" => "/images/logo.png",');
console.log('                "favicon_url" => "/favicon.ico",');
console.log('                "social_media" => [');
console.log('                    "facebook" => "https://facebook.com/worldtripagency",');
console.log('                    "twitter" => "https://twitter.com/worldtripagency",');
console.log('                    "instagram" => "https://instagram.com/worldtripagency"');
console.log('                ],');
console.log('                "theme" => [');
console.log('                    "primary_color" => "#40a0d8",');
console.log('                    "secondary_color" => "#2c5aa0"');
console.log('                ]');
console.log('            ];');
console.log('            echo json_encode($settings, JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/destinations":');
console.log('            $destinations = [');
console.log('                [');
console.log('                    "id" => 1,');
console.log('                    "name" => "Dubai",');
console.log('                    "country" => "UAE",');
console.log('                    "image" => "/images/destinations/dubai.jpg",');
console.log('                    "description" => "Modern city with luxury shopping and entertainment"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => 2,');
console.log('                    "name" => "Bali",');
console.log('                    "country" => "Indonesia",');
console.log('                    "image" => "/images/destinations/bali.jpg",');
console.log('                    "description" => "Tropical paradise with beautiful beaches"');
console.log('                ]');
console.log('            ];');
console.log('            echo json_encode($destinations, JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/auth/login":');
console.log('            if ($_SERVER["REQUEST_METHOD"] === "POST") {');
console.log('                $input = json_decode(file_get_contents("php://input"), true);');
console.log('                $email = $input["email"] ?? "";');
console.log('                $password = $input["password"] ?? "";');
console.log('');
console.log('                // Hardcoded admin credentials');
console.log('                $validCredentials = [');
console.log('                    "admin@worldtripagency.com" => "admin123",');
console.log('                    "admin@wonderland.com" => "admin123",');
console.log('                    "admin" => "admin"');
console.log('                ];');
console.log('');
console.log('                if (isset($validCredentials[$email]) && $validCredentials[$email] === $password) {');
console.log('                    $token = base64_encode(json_encode([');
console.log('                        "email" => $email,');
console.log('                        "exp" => time() + 3600');
console.log('                    ]));');
console.log('                    echo json_encode([');
console.log('                        "success" => true,');
console.log('                        "token" => $token,');
console.log('                        "user" => [');
console.log('                            "email" => $email,');
console.log('                            "name" => "Admin User"');
console.log('                        ]');
console.log('                    ], JSON_UNESCAPED_SLASHES);');
console.log('                } else {');
console.log('                    http_response_code(401);');
console.log('                    echo json_encode(["error" => "Invalid credentials"], JSON_UNESCAPED_SLASHES);');
console.log('                }');
console.log('            } else {');
console.log('                http_response_code(405);');
console.log('                echo json_encode(["error" => "Method not allowed"], JSON_UNESCAPED_SLASHES);');
console.log('            }');
console.log('            break;');
console.log('');
console.log('        case "/api/test":');
console.log('            echo json_encode(["message" => "API is working", "timestamp" => date("Y-m-d H:i:s")], JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        default:');
console.log('            http_response_code(404);');
console.log('            echo json_encode(["error" => "API endpoint not found", "path" => $path], JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('    }');
console.log('} catch (Exception $e) {');
console.log('    http_response_code(500);');
console.log('    echo json_encode(["error" => "Internal server error: " . $e->getMessage()], JSON_UNESCAPED_SLASHES);');
console.log('}');
console.log('?>');
console.log('EOF');
console.log('');
console.log('# 3. Replace the broken api-handler.php with the fixed version');
console.log('cp api-handler-fixed.php api-handler.php');
console.log('');
console.log('# 4. Test the fixed API endpoints');
console.log('curl -k https://worldtripagency.com/api/packages');
console.log('curl -k https://worldtripagency.com/api/cms/site-settings?public_only=true');
console.log('');
console.log('ðŸŽ¯ This will fix:');
console.log('âœ… JSON syntax error in packages API');
console.log('âœ… Missing CMS site-settings endpoint');
console.log('âœ… Clean JSON responses');
console.log('âœ… Proper error handling');
