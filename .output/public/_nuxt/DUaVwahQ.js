import G from"./CW2NxIwK.js";import{_ as J}from"./Ba-1N6ot.js";import{_ as X}from"./DrZeAxfx.js";import{_ as ee}from"./Cx7KobNI.js";import{_ as te,a as se,b as ae}from"./BbFKslBj.js";import{u as oe}from"./NS4odysN.js";import{h as f,C as m,Q as ne,m as le,u as re,c as h,o as b,a as s,b as l,f as $,d as w,i as n,Z as C,F as ie,r as ce,t as r,I as F,e as de}from"./D1nMFiHg.js";const ue={class:"space-y-6"},me={class:"bg-white rounded-lg shadow-sm border border-gray-200"},pe={key:0,class:"flex justify-center items-center py-12"},ge={key:1,class:"overflow-x-auto"},xe={class:"min-w-full divide-y divide-gray-200"},_e={class:"bg-white divide-y divide-gray-200"},ye={class:"px-6 py-4 whitespace-nowrap"},ve={class:"flex items-center"},he={class:"flex-shrink-0 h-10 w-10"},be={class:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center"},fe={class:"mr-4"},we={class:"text-sm font-medium text-gray-900"},ke={class:"text-sm text-gray-500"},Ce={class:"px-6 py-4 whitespace-nowrap"},De={class:"text-sm font-medium text-gray-900"},Le={class:"text-sm text-gray-500"},Se={class:"text-sm text-gray-500"},Be={class:"px-6 py-4 whitespace-nowrap"},Ae={class:"text-sm font-medium text-gray-900"},Ve={class:"text-sm text-gray-500"},$e={class:"px-6 py-4 whitespace-nowrap"},Fe={key:0,class:"mt-1"},Ne={class:"px-6 py-4 whitespace-nowrap"},Pe={class:"text-sm font-medium text-gray-900"},Ee={class:"text-sm text-gray-500"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Me={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Te={class:"flex items-center space-x-2 space-x-reverse"},Re=["onClick"],Oe={key:2,class:"text-center py-12"},Ue={key:0,class:"flex items-center justify-between"},je={class:"text-sm text-gray-700"},He={class:"flex space-x-1 space-x-reverse"},Ke=["disabled"],Qe={class:"px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md"},Ye=["disabled"],k=10,st={__name:"index",setup(ze){const d=f([]),D=f(!0),i=f(""),_=f(""),y=f(""),v=f(""),u=f(1),A=m(()=>{let t=d.value;if(i.value&&(t=t.filter(e=>{var o,c,p,g;return((o=e.customer_name)==null?void 0:o.toLowerCase().includes(i.value.toLowerCase()))||((c=e.customer_email)==null?void 0:c.toLowerCase().includes(i.value.toLowerCase()))||((p=e.booking_number)==null?void 0:p.toLowerCase().includes(i.value.toLowerCase()))||((g=e.package_title)==null?void 0:g.toLowerCase().includes(i.value.toLowerCase()))})),_.value&&(t=t.filter(e=>e.status===_.value)),y.value&&(t=t.filter(e=>e.payment_status===y.value)),v.value){const e=new Date,o=new Date(e.getFullYear(),e.getMonth(),e.getDate()),c=new Date(o.getTime()-7*24*60*60*1e3),p=new Date(o.getTime()-30*24*60*60*1e3);t=t.filter(g=>{const x=new Date(g.created_at);switch(v.value){case"today":return x>=o;case"week":return x>=c;case"month":return x>=p;default:return!0}})}return t.slice((u.value-1)*k,u.value*k)}),L=m(()=>{let t=d.value;if(i.value&&(t=t.filter(e=>{var o,c,p,g;return((o=e.customer_name)==null?void 0:o.toLowerCase().includes(i.value.toLowerCase()))||((c=e.customer_email)==null?void 0:c.toLowerCase().includes(i.value.toLowerCase()))||((p=e.booking_number)==null?void 0:p.toLowerCase().includes(i.value.toLowerCase()))||((g=e.package_title)==null?void 0:g.toLowerCase().includes(i.value.toLowerCase()))})),_.value&&(t=t.filter(e=>e.status===_.value)),y.value&&(t=t.filter(e=>e.payment_status===y.value)),v.value){const e=new Date,o=new Date(e.getFullYear(),e.getMonth(),e.getDate()),c=new Date(o.getTime()-7*24*60*60*1e3),p=new Date(o.getTime()-30*24*60*60*1e3);t=t.filter(g=>{const x=new Date(g.created_at);switch(v.value){case"today":return x>=o;case"week":return x>=c;case"month":return x>=p;default:return!0}})}return t.length}),S=m(()=>Math.ceil(L.value/k)),N=m(()=>d.value.length),P=m(()=>d.value.filter(t=>t.status==="confirmed").length),E=m(()=>d.value.filter(t=>t.status==="pending").length),I=m(()=>d.value.filter(t=>t.status==="cancelled").length),M=m(()=>d.value.reduce((t,e)=>t+(e.total_amount||0),0)),T=m(()=>[{key:"total",label:"إجمالي الحجوزات",value:N.value,icon:"material-symbols:book-online",iconBg:"bg-blue-100",iconColor:"text-blue-600"},{key:"confirmed",label:"مؤكدة",value:P.value,icon:"material-symbols:check-circle",iconBg:"bg-green-100",iconColor:"text-green-600"},{key:"pending",label:"في الانتظار",value:E.value,icon:"material-symbols:schedule",iconBg:"bg-orange-100",iconColor:"text-orange-600"},{key:"cancelled",label:"ملغية",value:I.value,icon:"material-symbols:cancel",iconBg:"bg-red-100",iconColor:"text-red-600"},{key:"revenue",label:"إجمالي المبيعات",value:V(M.value),icon:"material-symbols:attach-money",iconBg:"bg-purple-100",iconColor:"text-purple-600"}]),R=m(()=>[{value:"confirmed",label:"مؤكدة"},{value:"pending",label:"في الانتظار"},{value:"cancelled",label:"ملغية"},{value:"completed",label:"مكتملة"}]),O=m(()=>[{value:"paid",label:"مدفوع"},{value:"pending",label:"في الانتظار"},{value:"failed",label:"فشل"}]),U=m(()=>[{value:"today",label:"اليوم"},{value:"week",label:"هذا الأسبوع"},{value:"month",label:"هذا الشهر"}]),j=async()=>{try{D.value=!0;const t=await $fetch("/api/bookings");d.value=(t==null?void 0:t.bookings)||t||[]}catch(t){console.error("خطأ في تحميل الحجوزات:",t),d.value=[{id:1,booking_number:"BK001",customer_name:"أحمد محمد",customer_email:"ahmed@example.com",customer_phone:"+966501234567",package_title:"رحلة إلى دبي",travel_date:"2024-02-15",adults:2,children:1,status:"confirmed",payment_status:"paid",total_amount:7500,currency:"SAR",created_at:new Date().toISOString()},{id:2,booking_number:"BK002",customer_name:"فاطمة علي",customer_email:"fatima@example.com",customer_phone:"+966507654321",package_title:"عمرة رمضان",travel_date:"2024-03-01",adults:1,children:0,status:"pending",payment_status:"pending",total_amount:1800,currency:"SAR",created_at:new Date(Date.now()-864e5).toISOString()}]}finally{D.value=!1}},H=async t=>{if(confirm("هل أنت متأكد من حذف هذا الحجز؟ لا يمكن التراجع عن هذا الإجراء."))try{await $fetch(`/api/bookings/${t.id}`,{method:"DELETE"}),d.value=d.value.filter(e=>e.id!==t.id),console.log("تم حذف الحجز بنجاح")}catch(e){console.error("خطأ في حذف الحجز:",e)}},K=()=>{try{const{exportBookingsToExcel:t}=oe();t(d.value)?console.log("تم تصدير الحجوزات بنجاح"):console.error("فشل في تصدير الحجوزات")}catch(t){console.error("خطأ في تصدير الحجوزات:",t)}},Q=t=>new Date(t).toLocaleDateString("ar-SA"),V=t=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR"}).format(t),Y=t=>({confirmed:"مؤكدة",pending:"في الانتظار",cancelled:"ملغية",completed:"مكتملة"})[t]||t,z=t=>({confirmed:"bg-green-100 text-green-800",pending:"bg-orange-100 text-orange-800",cancelled:"bg-red-100 text-red-800",completed:"bg-blue-100 text-blue-800"})[t]||"bg-gray-100 text-gray-800",W=t=>({paid:"مدفوع",pending:"في الانتظار",failed:"فشل"})[t]||t,Z=t=>({paid:"bg-green-100 text-green-800",pending:"bg-orange-100 text-orange-800",failed:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800";return ne([i,_,y,v],()=>{u.value=1}),le(()=>{j()}),re({title:"إدارة الحجوزات - Wonder Land Admin",meta:[{name:"description",content:"عرض وإدارة حجوزات العملاء"},{name:"robots",content:"noindex, nofollow"}]}),(t,e)=>{const o=G,c=J,p=X,g=ee,x=te,B=se,q=ae;return b(),h("div",ue,[e[15]||(e[15]=s("div",{class:"h-16"},null,-1)),l(p,{title:"إدارة الحجوزات",description:"عرض وإدارة حجوزات العملاء"},{actions:w(()=>[s("button",{onClick:K,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[l(o,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),e[6]||(e[6]=s("span",{class:"hidden sm:inline"},"تصدير البيانات",-1)),e[7]||(e[7]=s("span",{class:"sm:hidden"},"تصدير",-1))]),l(c,{to:"/admin/bookings/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:w(()=>[l(o,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),e[8]||(e[8]=s("span",{class:"hidden sm:inline"},"إضافة حجز جديد",-1)),e[9]||(e[9]=s("span",{class:"sm:hidden"},"إضافة",-1))]),_:1})]),_:1}),l(g,{stats:n(T)},null,8,["stats"]),l(q,null,{default:w(()=>[l(x,{modelValue:n(i),"onUpdate:modelValue":e[0]||(e[0]=a=>C(i)?i.value=a:null),placeholder:"البحث في الحجوزات..."},null,8,["modelValue"]),l(B,{modelValue:n(_),"onUpdate:modelValue":e[1]||(e[1]=a=>C(_)?_.value=a:null),options:n(R),placeholder:"جميع الحالات"},null,8,["modelValue","options"]),l(B,{modelValue:n(y),"onUpdate:modelValue":e[2]||(e[2]=a=>C(y)?y.value=a:null),options:n(O),placeholder:"جميع أنواع الدفع"},null,8,["modelValue","options"]),l(B,{modelValue:n(v),"onUpdate:modelValue":e[3]||(e[3]=a=>C(v)?v.value=a:null),options:n(U),placeholder:"جميع التواريخ"},null,8,["modelValue","options"])]),_:1}),s("div",me,[n(D)?(b(),h("div",pe,[l(o,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"}),e[10]||(e[10]=s("span",{class:"mr-3 text-gray-600"},"جارٍ تحميل الحجوزات...",-1))])):n(A).length>0?(b(),h("div",ge,[s("table",xe,[e[11]||(e[11]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الحجز "),s("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," العميل "),s("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الباقة "),s("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الحالة "),s("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," المبلغ "),s("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," تاريخ الحجز "),s("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الإجراءات ")])],-1)),s("tbody",_e,[(b(!0),h(ie,null,ce(n(A),a=>(b(),h("tr",{key:a.id,class:"hover:bg-gray-50"},[s("td",ye,[s("div",ve,[s("div",he,[s("div",be,[l(o,{name:"material-symbols:book-online",class:"h-6 w-6 text-blue-600"})])]),s("div",fe,[s("div",we,"#"+r(a.booking_number||a.id),1),s("div",ke,r(a.adults+a.children)+" أشخاص",1)])])]),s("td",Ce,[s("div",De,r(a.customer_name),1),s("div",Le,r(a.customer_email),1),s("div",Se,r(a.customer_phone),1)]),s("td",Be,[s("div",Ae,r(a.package_title),1),s("div",Ve,r(a.travel_date),1)]),s("td",$e,[s("span",{class:F([z(a.status),"px-2 py-1 text-xs font-medium rounded-full"])},r(Y(a.status)),3),a.payment_status?(b(),h("div",Fe,[s("span",{class:F([Z(a.payment_status),"px-2 py-1 text-xs font-medium rounded-full"])},r(W(a.payment_status)),3)])):$("",!0)]),s("td",Ne,[s("div",Pe,r(V(a.total_amount)),1),s("div",Ee,r(a.currency||"SAR"),1)]),s("td",Ie,r(Q(a.created_at)),1),s("td",Me,[s("div",Te,[l(c,{to:`/admin/bookings/${a.id}`,class:"text-blue-600 hover:text-blue-900 p-1 rounded",title:"عرض"},{default:w(()=>[l(o,{name:"material-symbols:visibility",class:"h-4 w-4"})]),_:2},1032,["to"]),l(c,{to:`/admin/bookings/${a.id}/edit`,class:"text-green-600 hover:text-green-900 p-1 rounded",title:"تحرير"},{default:w(()=>[l(o,{name:"material-symbols:edit",class:"h-4 w-4"})]),_:2},1032,["to"]),s("button",{onClick:We=>H(a),class:"text-red-600 hover:text-red-900 p-1 rounded",title:"حذف"},[l(o,{name:"material-symbols:delete",class:"h-4 w-4"})],8,Re)])])]))),128))])])])):(b(),h("div",Oe,[l(o,{name:"material-symbols:book-online",class:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e[13]||(e[13]=s("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"لا توجد حجوزات",-1)),e[14]||(e[14]=s("p",{class:"text-gray-500 mb-6"},"لم يتم العثور على أي حجوزات",-1)),l(c,{to:"/admin/bookings/create",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},{default:w(()=>[l(o,{name:"material-symbols:add",class:"h-5 w-5 ml-2"}),e[12]||(e[12]=de(" إضافة حجز جديد "))]),_:1})]))]),n(S)>1?(b(),h("div",Ue,[s("div",je," عرض "+r((n(u)-1)*k+1)+" إلى "+r(Math.min(n(u)*k,n(L)))+" من أصل "+r(n(L))+" حجز ",1),s("div",He,[s("button",{onClick:e[4]||(e[4]=a=>u.value=Math.max(1,n(u)-1)),disabled:n(u)===1,class:"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," السابق ",8,Ke),s("span",Qe,r(n(u)),1),s("button",{onClick:e[5]||(e[5]=a=>u.value=Math.min(n(S),n(u)+1)),disabled:n(u)===n(S),class:"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," التالي ",8,Ye)])])):$("",!0)])}}};export{st as default};
