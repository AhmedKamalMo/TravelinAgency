import J from"./CBGl2SH_.js";import{_ as K}from"./tiFSQdHd.js";import{_ as X}from"./mu1kNXz8.js";import{g as x,B as v,R as ee,m as te,E as se,c as y,o as b,b as s,a as m,e as N,k as ae,h as r,i as k,v as oe,Z as C,T,G as ne,F as re,r as ie,H as D,t as g,l as le,w as A}from"./CvlND2yj.js";import{u as S}from"./DwWwhVQy.js";import{u as ce}from"./D6hYrwdZ.js";import{s as de}from"./x_rD_Ya3.js";import{u as ue}from"./0ltj-c_F.js";const me=()=>{const{playNotificationSound:$}=ce(),n=async()=>{try{const i=await $fetch("/api/contact-messages");if(i.messages&&i.messages.length>0){const l=i.messages.filter(p=>!p.is_read);l.length>0&&($(),Notification.permission==="granted"&&new Notification("رسالة جديدة",{body:`لديك ${l.length} رسالة جديدة`,icon:"/favicon.ico",tag:"new-message"}))}}catch(i){console.error("Error checking for new messages:",i)}};return{checkForNewMessages:n,requestNotificationPermission:async()=>"Notification"in window?Notification.permission==="default"?await Notification.requestPermission()==="granted":Notification.permission==="granted":!1,startRealTimeChecking:()=>{{const i=de(n,3e4),l=()=>{document.hidden||n()};return document.addEventListener("visibilitychange",l),()=>{clearInterval(i),document.removeEventListener("visibilitychange",l)}}}}},ge={class:"space-y-6"},pe={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ve={class:"relative"},ye={class:"bg-white rounded-lg shadow-sm border border-gray-200"},be={key:0,class:"flex justify-center items-center py-12"},he={key:1,class:"divide-y divide-gray-200"},xe=["onClick"],we={class:"flex items-start justify-between"},_e={class:"flex-1"},ke={class:"flex items-center space-x-3 space-x-reverse"},Ce={class:"flex-1"},De={class:"flex items-center space-x-2 space-x-reverse"},Me={class:"text-sm font-medium text-gray-900"},Le={key:0,class:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full"},Ne={class:"text-sm text-gray-600 mt-1"},Te={key:0,class:"text-sm text-gray-600 mt-1"},Se={class:"text-sm text-gray-700 mt-2"},$e={class:"flex items-center space-x-2 space-x-reverse"},Pe={class:"text-right"},Ae={class:"text-sm text-gray-500"},Ve={class:"text-xs text-gray-400"},Ee={class:"flex items-center space-x-1 space-x-reverse"},Be=["onClick","title"],Re=["onClick"],Fe={key:2,class:"text-center py-12"},Ie={key:0,class:"flex items-center justify-between"},Ue={class:"text-sm text-gray-700"},qe={class:"flex space-x-1 space-x-reverse"},He=["disabled"],je={class:"px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md"},Oe=["disabled"],w=10,Xe={__name:"index",setup($){const n=x([]),_=x(!0),c=x(""),i=x(""),l=x(""),p=x(""),d=x(1),P=v(()=>{let t=n.value;if(c.value&&(t=t.filter(e=>e.name.toLowerCase().includes(c.value.toLowerCase())||e.email.toLowerCase().includes(c.value.toLowerCase())||e.message.toLowerCase().includes(c.value.toLowerCase()))),i.value&&(t=t.filter(e=>e.type===i.value)),l.value&&(t=t.filter(e=>l.value==="read"?e.is_read:!e.is_read)),p.value){const e=new Date,o=new Date(e.getFullYear(),e.getMonth(),e.getDate()),u=new Date(o.getTime()-7*24*60*60*1e3),h=new Date(o.getTime()-30*24*60*60*1e3);t=t.filter(a=>{const f=new Date(a.created_at);switch(p.value){case"today":return f>=o;case"week":return f>=u;case"month":return f>=h;default:return!0}})}return t.slice((d.value-1)*w,d.value*w)}),M=v(()=>{let t=n.value;if(c.value&&(t=t.filter(e=>e.name.toLowerCase().includes(c.value.toLowerCase())||e.email.toLowerCase().includes(c.value.toLowerCase())||e.message.toLowerCase().includes(c.value.toLowerCase()))),i.value&&(t=t.filter(e=>e.type===i.value)),l.value&&(t=t.filter(e=>l.value==="read"?e.is_read:!e.is_read)),p.value){const e=new Date,o=new Date(e.getFullYear(),e.getMonth(),e.getDate()),u=new Date(o.getTime()-7*24*60*60*1e3),h=new Date(o.getTime()-30*24*60*60*1e3);t=t.filter(a=>{const f=new Date(a.created_at);switch(p.value){case"today":return f>=o;case"week":return f>=u;case"month":return f>=h;default:return!0}})}return t.length}),L=v(()=>Math.ceil(M.value/w)),V=v(()=>n.value.length),E=v(()=>n.value.filter(t=>t.is_read).length),B=v(()=>n.value.filter(t=>!t.is_read).length),R=v(()=>{const t=new Date;return t.setHours(0,0,0,0),n.value.filter(e=>new Date(e.created_at)>=t).length}),F=v(()=>n.value.filter(t=>t.phone&&t.phone.trim()!=="").length),I=v(()=>[{key:"total",label:"إجمالي الرسائل",value:V.value,icon:"material-symbols:mail",iconBg:"bg-blue-100",iconColor:"text-blue-600"},{key:"read",label:"مقروء",value:E.value,icon:"material-symbols:mark-email-read",iconBg:"bg-green-100",iconColor:"text-green-600"},{key:"unread",label:"غير مقروء",value:B.value,icon:"material-symbols:mark-email-unread",iconBg:"bg-orange-100",iconColor:"text-orange-600"},{key:"today",label:"اليوم",value:R.value,icon:"material-symbols:today",iconBg:"bg-purple-100",iconColor:"text-purple-600"},{key:"phone",label:"مع رقم هاتف",value:F.value,icon:"material-symbols:phone",iconBg:"bg-teal-100",iconColor:"text-teal-600"}]),U=async()=>{try{_.value=!0;const t=await $fetch("/api/contact-messages");if(t.messages){n.value=t.messages;const{updateCounts:e}=S(),o=n.value.filter(u=>!u.is_read).length;e(n.value.length,o)}else n.value=[]}catch(t){console.error("خطأ في تحميل الرسائل:",t),n.value=[{id:1,name:"أحمد محمد",email:"ahmed@example.com",phone:"+966501234567",type:"package",message:"أريد الاستفسار عن الباقات السياحية المتاحة لتركيا",is_read:!1,created_at:new Date().toISOString()},{id:2,name:"فاطمة علي",email:"fatima@example.com",phone:"+966507654321",type:"general",message:"شكراً لكم على الخدمة الممتازة",is_read:!0,created_at:new Date(Date.now()-864e5).toISOString()}]}finally{_.value=!1}},q=t=>{console.log("Viewing message:",t)},H=async t=>{try{const e=!t.is_read;if((await $fetch(`/api/contact-messages/${t.id}`,{method:"PUT",body:{is_read:e,status:e?"read":"new"}})).success){const u=n.value.findIndex(a=>a.id===t.id);u!==-1&&(n.value[u].status=e?"read":"new",n.value[u].is_read=e);const{fetchMessageCounts:h}=S();await h(),console.log(`تم ${e?"تعيين":"إلغاء تعيين"} الرسالة كمقروءة`)}}catch(e){console.error("خطأ في تغيير حالة الرسالة:",e)}},j=async t=>{if(confirm("هل أنت متأكد من حذف هذه الرسالة؟ لا يمكن التراجع عن هذا الإجراء."))try{await $fetch(`/api/contact-messages/${t.id}`,{method:"DELETE"}),n.value=n.value.filter(e=>e.id!==t.id),console.log("تم حذف الرسالة بنجاح")}catch(e){console.error("خطأ في حذف الرسالة:",e)}},O=async()=>{try{const t=await $fetch("/api/contact-messages/mark-all-read",{method:"PUT"});if(t.success){n.value.forEach(o=>{o.status="read",o.is_read=!0});const{fetchMessageCounts:e}=S();await e(),console.log(`تم تعيين ${t.affectedRows} رسالة كمقروءة`)}}catch(t){console.error("خطأ في تعيين الرسائل كمقروءة:",t)}},W=()=>{console.log("Exporting contacts...")},Y=t=>new Date(t).toLocaleDateString("ar-SA"),z=t=>new Date(t).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}),G=(t,e)=>t?t.length>e?t.substring(0,e)+"...":t:"",Q=t=>({general:"عام",package:"حزمة سياحية",destination:"وجهة",complaint:"شكوى",suggestion:"اقتراح"})[t]||t,Z=t=>({general:"bg-gray-100 text-gray-800",package:"bg-blue-100 text-blue-800",destination:"bg-green-100 text-green-800",complaint:"bg-red-100 text-red-800",suggestion:"bg-purple-100 text-purple-800"})[t]||"bg-gray-100 text-gray-800";return ee([c,i,l,p],()=>{d.value=1}),te(async()=>{U();const{requestNotificationPermission:t,startRealTimeChecking:e}=me();await t();const o=e();se(()=>{o&&o()})}),ue({title:"إدارة الرسائل - Wonder Land Admin",meta:[{name:"description",content:"عرض وإدارة رسائل العملاء"},{name:"robots",content:"noindex, nofollow"}]}),(t,e)=>{const o=J,u=K,h=X;return b(),y("div",ge,[e[16]||(e[16]=s("div",{class:"h-16"},null,-1)),m(u,{title:"إدارة الرسائل",description:"عرض وإدارة رسائل العملاء"},{actions:ae(()=>[s("button",{onClick:O,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[m(o,{name:"material-symbols:mark-email-read",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),e[6]||(e[6]=s("span",{class:"hidden sm:inline"},"تعيين الكل كمقروء",-1)),e[7]||(e[7]=s("span",{class:"sm:hidden"},"مقروء",-1))]),s("button",{onClick:W,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},[m(o,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),e[8]||(e[8]=s("span",{class:"hidden sm:inline"},"تصدير البيانات",-1)),e[9]||(e[9]=s("span",{class:"sm:hidden"},"تصدير",-1))])]),_:1}),m(h,{stats:r(I)},null,8,["stats"]),s("div",pe,[s("div",fe,[s("div",ve,[m(o,{name:"material-symbols:search",class:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),k(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>C(c)?c.value=a:null),type:"text",placeholder:"البحث في الرسائل...",class:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[oe,r(c)]])]),k(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>C(i)?i.value=a:null),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[10]||(e[10]=[ne('<option value="">جميع الأنواع</option><option value="general">عام</option><option value="package">حزمة سياحية</option><option value="destination">وجهة</option><option value="complaint">شكوى</option><option value="suggestion">اقتراح</option>',6)]),512),[[T,r(i)]]),k(s("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>C(l)?l.value=a:null),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[11]||(e[11]=[s("option",{value:""},"جميع الحالات",-1),s("option",{value:"read"},"مقروء",-1),s("option",{value:"unread"},"غير مقروء",-1)]),512),[[T,r(l)]]),k(s("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>C(p)?p.value=a:null),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[12]||(e[12]=[s("option",{value:""},"جميع التواريخ",-1),s("option",{value:"today"},"اليوم",-1),s("option",{value:"week"},"هذا الأسبوع",-1),s("option",{value:"month"},"هذا الشهر",-1)]),512),[[T,r(p)]])])]),s("div",ye,[r(_)?(b(),y("div",be,[m(o,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"}),e[13]||(e[13]=s("span",{class:"mr-3 text-gray-600"},"جارٍ تحميل الرسائل...",-1))])):r(P).length>0?(b(),y("div",he,[(b(!0),y(re,null,ie(r(P),a=>(b(),y("div",{key:a.id,class:"p-6 hover:bg-gray-50 transition-colors cursor-pointer",onClick:f=>q(a)},[s("div",we,[s("div",_e,[s("div",ke,[s("div",{class:D([a.is_read?"bg-gray-100":"bg-blue-100","p-2 rounded-full"])},[m(o,{name:a.is_read?"material-symbols:mark-email-read":"material-symbols:mark-email-unread",class:D([a.is_read?"text-gray-600":"text-blue-600","h-5 w-5"])},null,8,["name","class"])],2),s("div",Ce,[s("div",De,[s("h3",Me,g(a.name),1),s("span",{class:D([Z(a.type),"px-2 py-1 text-xs font-medium rounded-full"])},g(Q(a.type)),3),a.is_read?N("",!0):(b(),y("span",Le," جديد "))]),s("p",Ne,g(a.email),1),a.phone?(b(),y("p",Te,[m(o,{name:"material-symbols:phone",class:"h-4 w-4 inline ml-1"}),le(" "+g(a.phone),1)])):N("",!0),s("p",Se,g(G(a.message,100)),1)])])]),s("div",$e,[s("div",Pe,[s("p",Ae,g(Y(a.created_at)),1),s("p",Ve,g(z(a.created_at)),1)]),s("div",Ee,[s("button",{onClick:A(f=>H(a),["stop"]),class:D([a.is_read?"text-orange-600 hover:text-orange-900":"text-green-600 hover:text-green-900","p-1 rounded"]),title:a.is_read?"تعيين كغير مقروء":"تعيين كمقروء"},[m(o,{name:a.is_read?"material-symbols:mark-email-unread":"material-symbols:mark-email-read",class:"h-4 w-4"},null,8,["name"])],10,Be),s("button",{onClick:A(f=>j(a),["stop"]),class:"text-red-600 hover:text-red-900 p-1 rounded",title:"حذف"},[m(o,{name:"material-symbols:delete",class:"h-4 w-4"})],8,Re)])])])],8,xe))),128))])):(b(),y("div",Fe,[m(o,{name:"material-symbols:mail",class:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e[14]||(e[14]=s("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"لا توجد رسائل",-1)),e[15]||(e[15]=s("p",{class:"text-gray-500 mb-6"},"لم يتم العثور على أي رسائل",-1))]))]),r(L)>1?(b(),y("div",Ie,[s("div",Ue," عرض "+g((r(d)-1)*w+1)+" إلى "+g(Math.min(r(d)*w,r(M)))+" من أصل "+g(r(M))+" رسالة ",1),s("div",qe,[s("button",{onClick:e[4]||(e[4]=a=>d.value=Math.max(1,r(d)-1)),disabled:r(d)===1,class:"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," السابق ",8,He),s("span",je,g(r(d)),1),s("button",{onClick:e[5]||(e[5]=a=>d.value=Math.min(r(L),r(d)+1)),disabled:r(d)===r(L),class:"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," التالي ",8,Oe)])])):N("",!0)])}}};export{Xe as default};
