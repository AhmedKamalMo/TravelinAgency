import N from"./jn7r9_3C.js";import{h as d,S as I,p as P,G as U,c as i,o as u,e as y,b as a,i as s,a as x,I as G,w as S,t as D,n as T}from"./Btm4-m5n.js";import{s as j}from"./x_rD_Ya3.js";const O={class:"space-y-4"},J={key:0,class:"relative"},R=["src","alt"],W={key:0,class:"space-y-2"},$={key:1,class:"space-y-2"},A={key:1,class:"space-y-2"},q={class:"flex items-center justify-between text-sm text-gray-600"},H={class:"w-full bg-gray-200 rounded-full h-2"},K={key:2,class:"p-3 bg-red-100 border border-red-300 rounded-lg"},Q={class:"text-sm text-red-700"},X={key:3,class:"space-y-2"},Y=["src"],ae={__name:"ImageUpload",props:{modelValue:{type:String,default:""},alt:{type:String,default:"صورة"},maxSize:{type:Number,default:5*1024*1024},uploadType:{type:String,default:"destination",validator:v=>["destination","package"].includes(v)}},emits:["update:modelValue","upload-complete","upload-error"],setup(v,{emit:E}){const m=v,b=E,g=d(null),f=d(!1),h=d(!1),l=d(0),n=d(""),c=d(""),r=d(m.modelValue);I(()=>m.modelValue,t=>{r.value=t}),I(r,t=>{b("update:modelValue",t)});const V=()=>{var t;(t=g.value)==null||t.click()},z=t=>{const e=t.target.files[0];e&&_(e)},L=t=>{f.value=!1;const e=t.dataTransfer.files[0];e&&e.type.startsWith("image/")&&_(e)},_=async t=>{if(!t.type.startsWith("image/")){n.value="يرجى اختيار ملف صورة صالح";return}if(t.size>m.maxSize){n.value=`حجم الملف كبير جداً. الحد الأقصى ${m.maxSize/(1024*1024)}MB`;return}n.value="";const e=new FileReader;e.onload=o=>{c.value=o.target.result},e.readAsDataURL(t),await B(t)},B=async t=>{var e;try{h.value=!0,l.value=0;const o=new FormData;o.append("image",t);const F=j(()=>{l.value<90&&(l.value+=Math.random()*10)},200),M=m.uploadType==="package"?"/api/images/upload-package":"/api/images/upload-destination",p=await $fetch(M,{method:"POST",body:o});if(clearInterval(F),l.value=100,p.success&&((e=p.data)!=null&&e.url))r.value=p.data.url,c.value="",b("upload-complete",p.data);else throw new Error(p.message||"فشل في رفع الصورة")}catch(o){console.error("خطأ في رفع الصورة:",o),n.value=o.message||"حدث خطأ في رفع الصورة",b("upload-error",o)}finally{h.value=!1,l.value=0}},C=()=>{r.value="",c.value="",n.value="",g.value&&(g.value.value="")},w=()=>{f.value=!0},k=()=>{f.value=!1};return P(()=>{document.addEventListener("dragover",w),document.addEventListener("dragleave",k)}),U(()=>{document.removeEventListener("dragover",w),document.removeEventListener("dragleave",k)}),(t,e)=>{const o=N;return u(),i("div",O,[s(r)?(u(),i("div",J,[a("img",{src:s(r),alt:v.alt,class:"w-full h-48 object-cover rounded-lg border border-gray-200"},null,8,R),a("button",{onClick:C,class:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",title:"حذف الصورة"},[x(o,{name:"material-symbols:close",class:"h-4 w-4"})])])):y("",!0),a("div",{onClick:V,onDragover:e[0]||(e[0]=S(()=>{},["prevent"])),onDrop:S(L,["prevent"]),class:G(["border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 hover:bg-blue-50 transition-colors cursor-pointer min-h-[120px] bg-gray-50",{"border-blue-400 bg-blue-50":s(f)}]),style:{border:"2px dashed #d1d5db","background-color":"#f9fafb"}},[a("input",{ref_key:"fileInput",ref:g,type:"file",accept:"image/*",onChange:z,class:"hidden"},null,544),s(r)?(u(),i("div",$,[x(o,{name:"material-symbols:edit",class:"h-8 w-8 text-blue-500 mx-auto"}),e[2]||(e[2]=a("p",{class:"text-sm text-blue-600 font-medium"},"اضغط لتغيير الصورة",-1))])):(u(),i("div",W,[x(o,{name:"material-symbols:cloud-upload",class:"h-12 w-12 text-gray-400 mx-auto"}),e[1]||(e[1]=a("div",{class:"text-sm text-gray-600"},[a("p",{class:"font-medium"},"اضغط لرفع صورة أو اسحبها هنا"),a("p",{class:"text-xs text-gray-500 mt-1"},"PNG, JPG, JPEG حتى 5MB")],-1))]))],34),s(h)?(u(),i("div",A,[a("div",q,[e[3]||(e[3]=a("span",null,"جاري رفع الصورة...",-1)),a("span",null,D(s(l))+"%",1)]),a("div",H,[a("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:T({width:s(l)+"%"})},null,4)])])):y("",!0),s(n)?(u(),i("div",K,[a("p",Q,D(s(n)),1)])):y("",!0),s(c)&&s(c)!==s(r)?(u(),i("div",X,[e[4]||(e[4]=a("p",{class:"text-sm font-medium text-gray-700"},"معاينة الصورة الجديدة:",-1)),a("img",{src:s(c),alt:"معاينة الصورة",class:"w-full h-32 object-cover rounded-lg border border-gray-200"},null,8,Y)])):y("",!0)])}}};export{ae as _};
