import{i as e}from"./AdminPageHeader.vue.mjs";import{q as t}from"./index2.mjs";import{d as a}from"./AdminStats.vue.mjs";import{ref as s,computed as r,watch as l,mergeProps as o,withCtx as n,createVNode as i,unref as d,useSSRContext as c}from"vue";import{ssrRenderAttrs as u,ssrRenderComponent as m,ssrRenderAttr as p,ssrIncludeBooleanAttr as g,ssrLooseContain as v,ssrLooseEqual as b,ssrRenderList as y,ssrRenderClass as x,ssrInterpolate as h}from"vue/server-renderer";import{C as f}from"./useMessageCounter.mjs";import{H as w}from"./server.mjs";import"@iconify/utils/lib/css/icon";import"@iconify/vue";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"ipx";import"node:path";import"vue-router";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"unhead/utils";import"devalue";import"unhead/plugins";import"@unhead/schema-org";import"@unhead/schema-org/vue";import"floating-vue";const $={__name:"index",__ssrInlineRender:!0,setup(c){const $=s([]),A=s(!0),k=s(""),_=s(""),C=s(""),D=s(""),L=s(1),j=r((()=>{let e=$.value;if(k.value&&(e=e.filter((e=>e.name.toLowerCase().includes(k.value.toLowerCase())||e.email.toLowerCase().includes(k.value.toLowerCase())||e.message.toLowerCase().includes(k.value.toLowerCase())))),_.value&&(e=e.filter((e=>e.type===_.value))),C.value&&(e=e.filter((e=>"read"===C.value?e.is_read:!e.is_read))),D.value){const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s=new Date(a.getTime()-6048e5),r=new Date(a.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(D.value){case"today":return t>=a;case"week":return t>=s;case"month":return t>=r;default:return!0}}))}return e.slice(10*(L.value-1),10*L.value)})),M=r((()=>{let e=$.value;if(k.value&&(e=e.filter((e=>e.name.toLowerCase().includes(k.value.toLowerCase())||e.email.toLowerCase().includes(k.value.toLowerCase())||e.message.toLowerCase().includes(k.value.toLowerCase())))),_.value&&(e=e.filter((e=>e.type===_.value))),C.value&&(e=e.filter((e=>"read"===C.value?e.is_read:!e.is_read))),D.value){const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s=new Date(a.getTime()-6048e5),r=new Date(a.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(D.value){case"today":return t>=a;case"week":return t>=s;case"month":return t>=r;default:return!0}}))}return e.length})),S=r((()=>Math.ceil(M.value/10))),T=r((()=>$.value.length)),B=r((()=>$.value.filter((e=>e.is_read)).length)),E=r((()=>$.value.filter((e=>!e.is_read)).length)),F=r((()=>{const e=new Date;return e.setHours(0,0,0,0),$.value.filter((t=>new Date(t.created_at)>=e)).length})),H=r((()=>$.value.filter((e=>e.phone&&""!==e.phone.trim())).length)),P=r((()=>[{key:"total",label:"إجمالي الرسائل",value:T.value,icon:"material-symbols:mail",iconBg:"bg-blue-100",iconColor:"text-blue-600"},{key:"read",label:"مقروء",value:B.value,icon:"material-symbols:mark-email-read",iconBg:"bg-green-100",iconColor:"text-green-600"},{key:"unread",label:"غير مقروء",value:E.value,icon:"material-symbols:mark-email-unread",iconBg:"bg-orange-100",iconColor:"text-orange-600"},{key:"today",label:"اليوم",value:F.value,icon:"material-symbols:today",iconBg:"bg-purple-100",iconColor:"text-purple-600"},{key:"phone",label:"مع رقم هاتف",value:H.value,icon:"material-symbols:phone",iconBg:"bg-teal-100",iconColor:"text-teal-600"}])),Q=async()=>{try{const e=await $fetch("/api/contact-messages/mark-all-read",{method:"PUT"});if(e.success){$.value.forEach((e=>{e.status="read",e.is_read=!0}));const{fetchMessageCounts:t}=f();await t(),console.log(`تم تعيين ${e.affectedRows} رسالة كمقروءة`)}}catch(e){console.error("خطأ في تعيين الرسائل كمقروءة:",e)}},U=()=>{console.log("Exporting contacts...")},K=e=>({general:"bg-gray-100 text-gray-800",package:"bg-blue-100 text-blue-800",destination:"bg-green-100 text-green-800",complaint:"bg-red-100 text-red-800",suggestion:"bg-purple-100 text-purple-800"}[e]||"bg-gray-100 text-gray-800");return l([k,_,C,D],(()=>{L.value=1})),w({title:"إدارة الرسائل - Wonder Land Admin",meta:[{name:"description",content:"عرض وإدارة رسائل العملاء"},{name:"robots",content:"noindex, nofollow"}]}),(s,r,l,c)=>{const f=e,w=t,$=a;r(`<div${u(o({class:"space-y-6"},c))}><div class="h-16"></div>`),r(m(f,{title:"إدارة الرسائل",description:"عرض وإدارة رسائل العملاء"},{actions:n(((e,t,a,s)=>{if(!t)return[i("button",{onClick:Q,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[i(w,{name:"material-symbols:mark-email-read",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),i("span",{class:"hidden sm:inline"},"تعيين الكل كمقروء"),i("span",{class:"sm:hidden"},"مقروء")]),i("button",{onClick:U,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},[i(w,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),i("span",{class:"hidden sm:inline"},"تصدير البيانات"),i("span",{class:"sm:hidden"},"تصدير")])];t(`<button class="inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"${s}>`),t(m(w,{name:"material-symbols:mark-email-read",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,a,s)),t(`<span class="hidden sm:inline"${s}>تعيين الكل كمقروء</span><span class="sm:hidden"${s}>مقروء</span></button><button class="inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"${s}>`),t(m(w,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,a,s)),t(`<span class="hidden sm:inline"${s}>تصدير البيانات</span><span class="sm:hidden"${s}>تصدير</span></button>`)})),_:1},l)),r(m($,{stats:d(P)},null,l)),r('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div class="relative">'),r(m(w,{name:"material-symbols:search",class:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"},null,l)),r(`<input${p("value",d(k))} type="text" placeholder="البحث في الرسائل..." class="w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></div><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${g(Array.isArray(d(_))?v(d(_),""):b(d(_),""))?" selected":""}>جميع الأنواع</option><option value="general"${g(Array.isArray(d(_))?v(d(_),"general"):b(d(_),"general"))?" selected":""}>عام</option><option value="package"${g(Array.isArray(d(_))?v(d(_),"package"):b(d(_),"package"))?" selected":""}>حزمة سياحية</option><option value="destination"${g(Array.isArray(d(_))?v(d(_),"destination"):b(d(_),"destination"))?" selected":""}>وجهة</option><option value="complaint"${g(Array.isArray(d(_))?v(d(_),"complaint"):b(d(_),"complaint"))?" selected":""}>شكوى</option><option value="suggestion"${g(Array.isArray(d(_))?v(d(_),"suggestion"):b(d(_),"suggestion"))?" selected":""}>اقتراح</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${g(Array.isArray(d(C))?v(d(C),""):b(d(C),""))?" selected":""}>جميع الحالات</option><option value="read"${g(Array.isArray(d(C))?v(d(C),"read"):b(d(C),"read"))?" selected":""}>مقروء</option><option value="unread"${g(Array.isArray(d(C))?v(d(C),"unread"):b(d(C),"unread"))?" selected":""}>غير مقروء</option></select><select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value=""${g(Array.isArray(d(D))?v(d(D),""):b(d(D),""))?" selected":""}>جميع التواريخ</option><option value="today"${g(Array.isArray(d(D))?v(d(D),"today"):b(d(D),"today"))?" selected":""}>اليوم</option><option value="week"${g(Array.isArray(d(D))?v(d(D),"week"):b(d(D),"week"))?" selected":""}>هذا الأسبوع</option><option value="month"${g(Array.isArray(d(D))?v(d(D),"month"):b(d(D),"month"))?" selected":""}>هذا الشهر</option></select></div></div><div class="bg-white rounded-lg shadow-sm border border-gray-200">`),d(A)?(r('<div class="flex justify-center items-center py-12">'),r(m(w,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"},null,l)),r('<span class="mr-3 text-gray-600">جارٍ تحميل الرسائل...</span></div>')):d(j).length>0?(r('<div class="divide-y divide-gray-200">\x3c!--[--\x3e'),y(d(j),(e=>{r(`<div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center space-x-3 space-x-reverse"><div class="${x([e.is_read?"bg-gray-100":"bg-blue-100","p-2 rounded-full"])}">`),r(m(w,{name:e.is_read?"material-symbols:mark-email-read":"material-symbols:mark-email-unread",class:[e.is_read?"text-gray-600":"text-blue-600","h-5 w-5"]},null,l)),r(`</div><div class="flex-1"><div class="flex items-center space-x-2 space-x-reverse"><h3 class="text-sm font-medium text-gray-900">${h(e.name)}</h3><span class="${x([K(e.type),"px-2 py-1 text-xs font-medium rounded-full"])}">${h((e=>({general:"عام",package:"حزمة سياحية",destination:"وجهة",complaint:"شكوى",suggestion:"اقتراح"}[e]||e))(e.type))}</span>`),e.is_read?r("\x3c!----\x3e"):r('<span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full"> جديد </span>'),r(`</div><p class="text-sm text-gray-600 mt-1">${h(e.email)}</p>`),e.phone?(r('<p class="text-sm text-gray-600 mt-1">'),r(m(w,{name:"material-symbols:phone",class:"h-4 w-4 inline ml-1"},null,l)),r(` ${h(e.phone)}</p>`)):r("\x3c!----\x3e"),r(`<p class="text-sm text-gray-700 mt-2">${h(((e,t)=>e?e.length>t?e.substring(0,t)+"...":e:"")(e.message,100))}</p></div></div></div><div class="flex items-center space-x-2 space-x-reverse"><div class="text-right"><p class="text-sm text-gray-500">${h((e=>new Date(e).toLocaleDateString("ar-SA"))(e.created_at))}</p><p class="text-xs text-gray-400">${h((e=>new Date(e).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}))(e.created_at))}</p></div><div class="flex items-center space-x-1 space-x-reverse"><button class="${x([e.is_read?"text-orange-600 hover:text-orange-900":"text-green-600 hover:text-green-900","p-1 rounded"])}"${p("title",e.is_read?"تعيين كغير مقروء":"تعيين كمقروء")}>`),r(m(w,{name:e.is_read?"material-symbols:mark-email-unread":"material-symbols:mark-email-read",class:"h-4 w-4"},null,l)),r('</button><button class="text-red-600 hover:text-red-900 p-1 rounded" title="حذف">'),r(m(w,{name:"material-symbols:delete",class:"h-4 w-4"},null,l)),r("</button></div></div></div></div>")})),r("\x3c!--]--\x3e</div>")):(r('<div class="text-center py-12">'),r(m(w,{name:"material-symbols:mail",class:"h-16 w-16 text-gray-300 mx-auto mb-4"},null,l)),r('<h3 class="text-lg font-medium text-gray-900 mb-2">لا توجد رسائل</h3><p class="text-gray-500 mb-6">لم يتم العثور على أي رسائل</p></div>')),r("</div>"),d(S)>1?r(`<div class="flex items-center justify-between"><div class="text-sm text-gray-700"> عرض ${h(10*(d(L)-1)+1)} إلى ${h(Math.min(10*d(L),d(M)))} من أصل ${h(d(M))} رسالة </div><div class="flex space-x-1 space-x-reverse"><button${g(1===d(L))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> السابق </button><span class="px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md">${h(d(L))}</span><button${g(d(L)===d(S))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> التالي </button></div></div>`):r("\x3c!----\x3e"),r("</div>")}}},A=$.setup;$.setup=(e,t)=>{const a=c();return(a.modules||(a.modules=new Set)).add("pages/admin/contacts/index.vue"),A?A(e,t):void 0};export{$ as default};
//# sourceMappingURL=index.vue11.mjs.map
