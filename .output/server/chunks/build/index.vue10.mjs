import{i as e}from"./AdminPageHeader.vue.mjs";import{q as t}from"./index2.mjs";import{M as l}from"./nuxt-link.mjs";import{d as a}from"./AdminStats.vue.mjs";import{t as s,l as n,u as o}from"./AdminSelect.vue.mjs";import{ref as r,computed as i,watch as d,mergeProps as u,withCtx as m,createVNode as c,unref as p,isRef as x,createTextVNode as g,useSSRContext as v}from"vue";import{ssrRenderAttrs as b,ssrRenderComponent as h,ssrRenderList as y,ssrInterpolate as w,ssrRenderClass as f,ssrIncludeBooleanAttr as _}from"vue/server-renderer";import{p as k}from"./useExcelExport.mjs";import{H as $}from"./server.mjs";import"@iconify/utils/lib/css/icon";import"@iconify/vue";import"fs";import"stream";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"node:module";import"ipx";import"node:path";import"vue-router";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"unhead/utils";import"devalue";import"unhead/plugins";import"@unhead/schema-org";import"@unhead/schema-org/vue";import"floating-vue";const V={__name:"index",__ssrInlineRender:!0,setup(v){const V=r([]),C=r(!0),L=r(""),D=r(""),j=r(""),U=r(""),A=r(1),S=i((()=>{let e=V.value;if(L.value&&(e=e.filter((e=>{var t,l,a,s;return(null==(t=e.customer_name)?void 0:t.toLowerCase().includes(L.value.toLowerCase()))||(null==(l=e.customer_email)?void 0:l.toLowerCase().includes(L.value.toLowerCase()))||(null==(a=e.booking_number)?void 0:a.toLowerCase().includes(L.value.toLowerCase()))||(null==(s=e.package_title)?void 0:s.toLowerCase().includes(L.value.toLowerCase()))}))),D.value&&(e=e.filter((e=>e.status===D.value))),j.value&&(e=e.filter((e=>e.payment_status===j.value))),U.value){const t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(l.getTime()-6048e5),s=new Date(l.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(U.value){case"today":return t>=l;case"week":return t>=a;case"month":return t>=s;default:return!0}}))}return e.slice(10*(A.value-1),10*A.value)})),B=i((()=>{let e=V.value;if(L.value&&(e=e.filter((e=>{var t,l,a,s;return(null==(t=e.customer_name)?void 0:t.toLowerCase().includes(L.value.toLowerCase()))||(null==(l=e.customer_email)?void 0:l.toLowerCase().includes(L.value.toLowerCase()))||(null==(a=e.booking_number)?void 0:a.toLowerCase().includes(L.value.toLowerCase()))||(null==(s=e.package_title)?void 0:s.toLowerCase().includes(L.value.toLowerCase()))}))),D.value&&(e=e.filter((e=>e.status===D.value))),j.value&&(e=e.filter((e=>e.payment_status===j.value))),U.value){const t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(l.getTime()-6048e5),s=new Date(l.getTime()-2592e6);e=e.filter((e=>{const t=new Date(e.created_at);switch(U.value){case"today":return t>=l;case"week":return t>=a;case"month":return t>=s;default:return!0}}))}return e.length})),T=i((()=>Math.ceil(B.value/10))),M=i((()=>V.value.length)),E=i((()=>V.value.filter((e=>"confirmed"===e.status)).length)),F=i((()=>V.value.filter((e=>"pending"===e.status)).length)),R=i((()=>V.value.filter((e=>"cancelled"===e.status)).length)),H=i((()=>V.value.reduce(((e,t)=>e+(t.total_amount||0)),0))),Y=i((()=>[{key:"total",label:"إجمالي الحجوزات",value:M.value,icon:"material-symbols:book-online",iconBg:"bg-blue-100",iconColor:"text-blue-600"},{key:"confirmed",label:"مؤكدة",value:E.value,icon:"material-symbols:check-circle",iconBg:"bg-green-100",iconColor:"text-green-600"},{key:"pending",label:"في الانتظار",value:F.value,icon:"material-symbols:schedule",iconBg:"bg-orange-100",iconColor:"text-orange-600"},{key:"cancelled",label:"ملغية",value:R.value,icon:"material-symbols:cancel",iconBg:"bg-red-100",iconColor:"text-red-600"},{key:"revenue",label:"إجمالي المبيعات",value:M$1(H.value),icon:"material-symbols:attach-money",iconBg:"bg-purple-100",iconColor:"text-purple-600"}])),N=i((()=>[{value:"confirmed",label:"مؤكدة"},{value:"pending",label:"في الانتظار"},{value:"cancelled",label:"ملغية"},{value:"completed",label:"مكتملة"}])),P=i((()=>[{value:"paid",label:"مدفوع"},{value:"pending",label:"في الانتظار"},{value:"failed",label:"فشل"}])),W=i((()=>[{value:"today",label:"اليوم"},{value:"week",label:"هذا الأسبوع"},{value:"month",label:"هذا الشهر"}])),K=()=>{try{const{exportBookingsToExcel:e}=k();e(V.value)?console.log("تم تصدير الحجوزات بنجاح"):console.error("فشل في تصدير الحجوزات")}catch(e){console.error("خطأ في تصدير الحجوزات:",e)}},M$1=e=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR"}).format(e),I=e=>({confirmed:"bg-green-100 text-green-800",pending:"bg-orange-100 text-orange-800",cancelled:"bg-red-100 text-red-800",completed:"bg-blue-100 text-blue-800"}[e]||"bg-gray-100 text-gray-800"),te=e=>({paid:"bg-green-100 text-green-800",pending:"bg-orange-100 text-orange-800",failed:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800");return d([L,D,j,U],(()=>{A.value=1})),$({title:"إدارة الحجوزات - Wonder Land Admin",meta:[{name:"description",content:"عرض وإدارة حجوزات العملاء"},{name:"robots",content:"noindex, nofollow"}]}),(r,i,d,v)=>{const k=e,$=t,V=l,M=a,E=s,F=n,R=o;i(`<div${b(u({class:"space-y-6"},v))}><div class="h-16"></div>`),i(h(k,{title:"إدارة الحجوزات",description:"عرض وإدارة حجوزات العملاء"},{actions:m(((e,t,l,a)=>{if(!t)return[c("button",{onClick:K,class:"inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},[c($,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),c("span",{class:"hidden sm:inline"},"تصدير البيانات"),c("span",{class:"sm:hidden"},"تصدير")]),c(V,{to:"/admin/bookings/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:m((()=>[c($,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),c("span",{class:"hidden sm:inline"},"إضافة حجز جديد"),c("span",{class:"sm:hidden"},"إضافة")])),_:1})];t(`<button class="inline-flex items-center px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"${a}>`),t(h($,{name:"material-symbols:download",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,l,a)),t(`<span class="hidden sm:inline"${a}>تصدير البيانات</span><span class="sm:hidden"${a}>تصدير</span></button>`),t(h(V,{to:"/admin/bookings/create",class:"inline-flex items-center px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"},{default:m(((e,t,l,a)=>{if(!t)return[c($,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"}),c("span",{class:"hidden sm:inline"},"إضافة حجز جديد"),c("span",{class:"sm:hidden"},"إضافة")];t(h($,{name:"material-symbols:add",class:"h-4 w-4 sm:h-5 sm:w-5 ml-2"},null,l,a)),t(`<span class="hidden sm:inline"${a}>إضافة حجز جديد</span><span class="sm:hidden"${a}>إضافة</span>`)})),_:1},l,a))})),_:1},d)),i(h(M,{stats:p(Y)},null,d)),i(h(E,null,{default:m(((e,t,l,a)=>{if(!t)return[c(F,{modelValue:p(L),"onUpdate:modelValue":e=>x(L)?L.value=e:null,placeholder:"البحث في الحجوزات..."},null,8,["modelValue","onUpdate:modelValue"]),c(R,{modelValue:p(D),"onUpdate:modelValue":e=>x(D)?D.value=e:null,options:p(N),placeholder:"جميع الحالات"},null,8,["modelValue","onUpdate:modelValue","options"]),c(R,{modelValue:p(j),"onUpdate:modelValue":e=>x(j)?j.value=e:null,options:p(P),placeholder:"جميع أنواع الدفع"},null,8,["modelValue","onUpdate:modelValue","options"]),c(R,{modelValue:p(U),"onUpdate:modelValue":e=>x(U)?U.value=e:null,options:p(W),placeholder:"جميع التواريخ"},null,8,["modelValue","onUpdate:modelValue","options"])];t(h(F,{modelValue:p(L),"onUpdate:modelValue":e=>x(L)?L.value=e:null,placeholder:"البحث في الحجوزات..."},null,l,a)),t(h(R,{modelValue:p(D),"onUpdate:modelValue":e=>x(D)?D.value=e:null,options:p(N),placeholder:"جميع الحالات"},null,l,a)),t(h(R,{modelValue:p(j),"onUpdate:modelValue":e=>x(j)?j.value=e:null,options:p(P),placeholder:"جميع أنواع الدفع"},null,l,a)),t(h(R,{modelValue:p(U),"onUpdate:modelValue":e=>x(U)?U.value=e:null,options:p(W),placeholder:"جميع التواريخ"},null,l,a))})),_:1},d)),i('<div class="bg-white rounded-lg shadow-sm border border-gray-200">'),p(C)?(i('<div class="flex justify-center items-center py-12">'),i(h($,{name:"material-symbols:progress-activity",class:"animate-spin h-8 w-8 text-blue-600"},null,d)),i('<span class="mr-3 text-gray-600">جارٍ تحميل الحجوزات...</span></div>')):p(S).length>0?(i('<div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الحجز </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> العميل </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الباقة </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الحالة </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> المبلغ </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> تاريخ الحجز </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"> الإجراءات </th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e'),y(p(S),(e=>{i('<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-10 w-10"><div class="h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center">'),i(h($,{name:"material-symbols:book-online",class:"h-6 w-6 text-blue-600"},null,d)),i(`</div></div><div class="mr-4"><div class="text-sm font-medium text-gray-900">#${w(e.booking_number||e.id)}</div><div class="text-sm text-gray-500">${w(e.adults+e.children)} أشخاص</div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${w(e.customer_name)}</div><div class="text-sm text-gray-500">${w(e.customer_email)}</div><div class="text-sm text-gray-500">${w(e.customer_phone)}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${w(e.package_title)}</div><div class="text-sm text-gray-500">${w(e.travel_date)}</div></td><td class="px-6 py-4 whitespace-nowrap"><span class="${f([I(e.status),"px-2 py-1 text-xs font-medium rounded-full"])}">${w((e=>({confirmed:"مؤكدة",pending:"في الانتظار",cancelled:"ملغية",completed:"مكتملة"}[e]||e))(e.status))}</span>`),e.payment_status?i(`<div class="mt-1"><span class="${f([te(e.payment_status),"px-2 py-1 text-xs font-medium rounded-full"])}">${w((e=>({paid:"مدفوع",pending:"في الانتظار",failed:"فشل"}[e]||e))(e.payment_status))}</span></div>`):i("\x3c!----\x3e"),i(`</td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${w(M$1(e.total_amount))}</div><div class="text-sm text-gray-500">${w(e.currency||"SAR")}</div></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${w((e=>new Date(e).toLocaleDateString("ar-SA"))(e.created_at))}</td><td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><div class="flex items-center space-x-2 space-x-reverse">`),i(h(V,{to:`/admin/bookings/${e.id}`,class:"text-blue-600 hover:text-blue-900 p-1 rounded",title:"عرض"},{default:m(((e,t,l,a)=>{if(!t)return[c($,{name:"material-symbols:visibility",class:"h-4 w-4"})];t(h($,{name:"material-symbols:visibility",class:"h-4 w-4"},null,l,a))})),_:2},d)),i(h(V,{to:`/admin/bookings/${e.id}/edit`,class:"text-green-600 hover:text-green-900 p-1 rounded",title:"تحرير"},{default:m(((e,t,l,a)=>{if(!t)return[c($,{name:"material-symbols:edit",class:"h-4 w-4"})];t(h($,{name:"material-symbols:edit",class:"h-4 w-4"},null,l,a))})),_:2},d)),i('<button class="text-red-600 hover:text-red-900 p-1 rounded" title="حذف">'),i(h($,{name:"material-symbols:delete",class:"h-4 w-4"},null,d)),i("</button></div></td></tr>")})),i("\x3c!--]--\x3e</tbody></table></div>")):(i('<div class="text-center py-12">'),i(h($,{name:"material-symbols:book-online",class:"h-16 w-16 text-gray-300 mx-auto mb-4"},null,d)),i('<h3 class="text-lg font-medium text-gray-900 mb-2">لا توجد حجوزات</h3><p class="text-gray-500 mb-6">لم يتم العثور على أي حجوزات</p>'),i(h(V,{to:"/admin/bookings/create",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},{default:m(((e,t,l,a)=>{if(!t)return[c($,{name:"material-symbols:add",class:"h-5 w-5 ml-2"}),g(" إضافة حجز جديد ")];t(h($,{name:"material-symbols:add",class:"h-5 w-5 ml-2"},null,l,a)),t(" إضافة حجز جديد ")})),_:1},d)),i("</div>")),i("</div>"),p(T)>1?i(`<div class="flex items-center justify-between"><div class="text-sm text-gray-700"> عرض ${w(10*(p(A)-1)+1)} إلى ${w(Math.min(10*p(A),p(B)))} من أصل ${w(p(B))} حجز </div><div class="flex space-x-1 space-x-reverse"><button${_(1===p(A))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> السابق </button><span class="px-3 py-2 text-sm bg-blue-600 text-white border border-blue-600 rounded-md">${w(p(A))}</span><button${_(p(A)===p(T))?" disabled":""} class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"> التالي </button></div></div>`):i("\x3c!----\x3e"),i("</div>")}}},C=V.setup;V.setup=(e,t)=>{const l=v();return(l.modules||(l.modules=new Set)).add("pages/admin/bookings/index.vue"),C?C(e,t):void 0};export{V as default};
//# sourceMappingURL=index.vue10.mjs.map
