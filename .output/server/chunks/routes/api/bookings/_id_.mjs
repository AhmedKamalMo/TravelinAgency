import{c as e,g as t,e as a}from"../../../_/nitro.mjs";import{executeQuery as n}from"../../../_/database.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"ipx";import"node:path";import"mysql2/promise";import"bcryptjs";import"jsonwebtoken";const o=e((async e=>{try{const o=t(e,"id");if(!o)throw a({statusCode:400,statusMessage:"Booking ID is required"});const s=await n("\n      SELECT \n        b.id, \n        b.booking_number,\n        b.customer_name,\n        b.customer_email,\n        b.customer_phone,\n        b.customer_details,\n        b.guests_count,\n        b.guests_details,\n        b.departure_date,\n        b.return_date,\n        b.total_amount,\n        b.paid_amount,\n        b.currency,\n        b.payment_status,\n        b.booking_status,\n        b.payment_method,\n        b.payment_reference,\n        b.special_requests,\n        b.notes,\n        b.cancellation_reason,\n        b.cancellation_date,\n        b.confirmed_at,\n        b.created_at,\n        b.updated_at,\n        p.id as package_id,\n        p.title_ar as package_title_ar,\n        p.title_en as package_title_en,\n        p.title as package_title,\n        p.price as package_price,\n        p.duration_days as package_duration,\n        p.travel_period as package_location,\n        p.image_url as package_image\n      FROM bookings b\n      LEFT JOIN packages p ON b.package_id = p.id\n      WHERE b.id = ?\n    ",[o]);if(!s||0===s.length)throw a({statusCode:404,statusMessage:"Booking not found"});const r=s[0];return{success:!0,data:{id:r.id,booking_number:r.booking_number,customer_name:r.customer_name,customer_email:r.customer_email,customer_phone:r.customer_phone,customer_details:JSON.parse(r.customer_details||"{}"),guests_count:r.guests_count,guests_details:JSON.parse(r.guests_details||"[]"),departure_date:r.departure_date,return_date:r.return_date,total_amount:r.total_amount,paid_amount:r.paid_amount,currency:r.currency,payment_status:r.payment_status,booking_status:r.booking_status,payment_method:r.payment_method,payment_reference:r.payment_reference,special_requests:r.special_requests,notes:r.notes,cancellation_reason:r.cancellation_reason,cancellation_date:r.cancellation_date,confirmed_at:r.confirmed_at,created_at:r.created_at,updated_at:r.updated_at,package:{id:r.package_id,title_ar:r.package_title_ar,title_en:r.package_title_en,title:r.package_title_ar||r.package_title_en||r.package_title,price:r.package_price,duration_days:r.package_duration,location:r.package_location,travel_period:r.package_location,image_url:r.package_image}}}}catch(e){if(console.error("Error fetching booking:",e),e.statusCode)throw e;throw a({statusCode:500,statusMessage:"Failed to fetch booking"})}}));export{o as default};
//# sourceMappingURL=_id_.mjs.map
