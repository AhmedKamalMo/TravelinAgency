import{c as e,r as t,e as o,h as s}from"../../../_/nitro.mjs";import{authenticateUser as r,generateJWT as a}from"../../../_/database.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"ipx";import"node:path";import"mysql2/promise";import"bcryptjs";import"jsonwebtoken";const i=e((async e=>{try{const i=await t(e),{email:n,password:m}=i;if(!n||!m)throw o({statusCode:400,statusMessage:"Email and password are required"});const l=await r(n,m);if(!l)throw o({statusCode:401,statusMessage:"Invalid login credentials"});const{user:d}=l;if(!d.role||!["admin","super_admin","moderator"].includes(d.role))throw o({statusCode:403,statusMessage:"ليس لديك صلاحيات للوصول إلى لوحة التحكم"});const p={userId:d.id,email:d.email,role:d.role},u=a(p,"7d");s(e,"auth-token",u,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),console.log("✅ Admin login successful:",{userId:d.id,email:d.email,role:d.role,timestamp:(new Date).toISOString()});return{success:!0,data:{user:{id:d.id,email:d.email,full_name:d.full_name,phone:d.phone,role:d.role,permissions:d.permissions,status:d.status},token:u}}}catch(e){if(console.error("Login API error:",e),e.statusCode)throw e;throw o({statusCode:500,statusMessage:"Internal server error during login"})}}));export{i as default};
//# sourceMappingURL=login.post.mjs.map
