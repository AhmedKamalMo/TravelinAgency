import{c as t,e as o}from"../../../../_/nitro.mjs";import{executeQuery as e}from"../../../../_/database.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"node:module";import"ipx";import"node:path";import"mysql2/promise";import"bcryptjs";import"jsonwebtoken";const s=t((async t=>{try{const t=await e("SELECT \n        p.*,\n        u1.email as created_by_email,\n        u2.email as updated_by_email\n       FROM cms_pages p\n       LEFT JOIN users u1 ON p.created_by = u1.id\n       LEFT JOIN users u2 ON p.updated_by = u2.id\n       WHERE p.slug = 'home'",[]);if(0===t.length)throw o({statusCode:404,statusMessage:"Homepage not found"});const s=await e("SELECT \n        s.*,\n        (SELECT COUNT(*) FROM cms_content_blocks WHERE section_id = s.id AND is_active = 1) as blocks_count\n       FROM cms_sections s\n       WHERE s.page_id = ? AND s.is_active = 1\n       ORDER BY s.order_index ASC",[t[0].id]);for(const t of s)t.content_blocks=await e("SELECT * FROM cms_content_blocks \n         WHERE section_id = ? AND is_active = 1\n         ORDER BY order_index ASC",[t.id]);return{success:!0,data:{page:t[0],sections:s}}}catch(t){if(console.error("Error fetching homepage:",t),t.statusCode)throw t;throw o({statusCode:500,statusMessage:"Error fetching homepage"})}}));export{s as default};
//# sourceMappingURL=home.get.mjs.map
