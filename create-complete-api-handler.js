#!/usr/bin/env node

console.log('🔧 CREATING COMPLETE API HANDLER WITH REAL DATA');
console.log('================================================\n');

console.log('📋 CREATING COMPLETE API HANDLER:');
console.log('==================================');
console.log('');
console.log('cat > api-handler-complete.php << "EOF"');
console.log('<?php');
console.log('// Set proper headers first');
console.log('header("Content-Type: application/json; charset=utf-8");');
console.log('header("Access-Control-Allow-Origin: *");');
console.log('header("Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS");');
console.log('header("Access-Control-Allow-Headers: Content-Type, Authorization, X-Requested-With");');
console.log('');
console.log('// Handle preflight requests');
console.log('if ($_SERVER["REQUEST_METHOD"] === "OPTIONS") {');
console.log('    http_response_code(200);');
console.log('    exit;');
console.log('}');
console.log('');
console.log('// Get the request path');
console.log('$uri = $_SERVER["REQUEST_URI"];');
console.log('$path = parse_url($uri, PHP_URL_PATH);');
console.log('$path = strtok($path, \'?\');');
console.log('');
console.log('try {');
console.log('    switch ($path) {');
console.log('        case "/api/auth/login":');
console.log('            if ($_SERVER["REQUEST_METHOD"] !== "POST") {');
console.log('                http_response_code(405);');
console.log('                echo json_encode(["error" => "Method not allowed"], JSON_UNESCAPED_SLASHES);');
console.log('                break;');
console.log('            }');
console.log('');
console.log('            $input = json_decode(file_get_contents("php://input"), true);');
console.log('            if (json_last_error() !== JSON_ERROR_NONE) {');
console.log('                http_response_code(400);');
console.log('                echo json_encode(["error" => "Invalid JSON"], JSON_UNESCAPED_SLASHES);');
console.log('                break;');
console.log('            }');
console.log('');
console.log('            $email = $input["email"] ?? "";');
console.log('            $password = $input["password"] ?? "";');
console.log('');
console.log('            $validCredentials = [');
console.log('                "admin@worldtripagency.com" => "admin123",');
console.log('                "admin@wonderland.com" => "admin123",');
console.log('                "admin" => "admin"');
console.log('            ];');
console.log('');
console.log('            if (isset($validCredentials[$email]) && $validCredentials[$email] === $password) {');
console.log('                $token = base64_encode(json_encode([');
console.log('                    "email" => $email,');
console.log('                    "exp" => time() + 3600,');
console.log('                    "role" => "admin"');
console.log('                ]));');
console.log('');
console.log('                setcookie("auth-token", $token, time() + 3600, "/", "", false, true);');
console.log('');
console.log('                echo json_encode([');
console.log('                    "success" => true,');
console.log('                    "data" => [');
console.log('                        "user" => [');
console.log('                            "email" => $email,');
console.log('                            "name" => "Admin User",');
console.log('                            "full_name" => "Admin User",');
console.log('                            "role" => "admin",');
console.log('                            "permissions" => [');
console.log('                                "admin" => true,');
console.log('                                "users" => true,');
console.log('                                "packages" => true,');
console.log('                                "destinations" => true');
console.log('                            ]');
console.log('                        ],');
console.log('                        "token" => $token');
console.log('                    ]');
console.log('                ], JSON_UNESCAPED_SLASHES);');
console.log('            } else {');
console.log('                http_response_code(401);');
console.log('                echo json_encode([');
console.log('                    "error" => "Invalid credentials",');
console.log('                    "message" => "البريد الإلكتروني أو كلمة المرور غير صحيحة"');
console.log('                ], JSON_UNESCAPED_SLASHES);');
console.log('            }');
console.log('            break;');
console.log('');
console.log('        case "/api/auth/me":');
console.log('            $token = $_COOKIE["auth-token"] ?? "";');
console.log('            if (empty($token)) {');
console.log('                http_response_code(401);');
console.log('                echo json_encode(["error" => "No token provided"], JSON_UNESCAPED_SLASHES);');
console.log('                break;');
console.log('            }');
console.log('');
console.log('            $tokenData = json_decode(base64_decode($token), true);');
console.log('            if (!$tokenData || !isset($tokenData["email"])) {');
console.log('                http_response_code(401);');
console.log('                echo json_encode(["error" => "Invalid token"], JSON_UNESCAPED_SLASHES);');
console.log('                break;');
console.log('            }');
console.log('');
console.log('            if (isset($tokenData["exp"]) && $tokenData["exp"] < time()) {');
console.log('                http_response_code(401);');
console.log('                echo json_encode(["error" => "Token expired"], JSON_UNESCAPED_SLASHES);');
console.log('                break;');
console.log('            }');
console.log('');
console.log('            echo json_encode([');
console.log('                "success" => true,');
console.log('                "data" => [');
console.log('                    "user" => [');
console.log('                        "email" => $tokenData["email"],');
console.log('                        "name" => "Admin User",');
console.log('                        "full_name" => "Admin User",');
console.log('                        "role" => $tokenData["role"] ?? "admin",');
console.log('                        "permissions" => [');
console.log('                            "admin" => true,');
console.log('                            "users" => true,');
console.log('                            "packages" => true,');
console.log('                            "destinations" => true');
console.log('                        ]');
console.log('                    ]');
console.log('                ]');
console.log('            ], JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/auth/logout":');
console.log('            setcookie("auth-token", "", time() - 3600, "/", "", false, true);');
console.log('            echo json_encode([');
console.log('                "success" => true,');
console.log('                "message" => "Logged out successfully"');
console.log('            ], JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/packages":');
console.log('            // Real packages data from your database');
console.log('            $packages = [');
console.log('                [');
console.log('                    "id" => "ca41d9ea-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "رومانسية وثقافة باريس",');
console.log('                    "title_en" => "Paris Romance & Culture",');
console.log('                    "description" => "اختبر سحر باريس مع زيارات لبرج إيفل، متحف اللوفر، كاتدرائية نوتردام، وحي مونمارتر الساحر.",');
console.log('                    "description_en" => "Experience the charm of Paris with visits to the Eiffel Tower, Louvre Museum, Notre Dame Cathedral, and the charming Montmartre district.",');
console.log('                    "price" => 9999.00,');
console.log('                    "duration_days" => 8,');
console.log('                    "travel_period" => "مارس",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-338515.jpg"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "ca4327a8-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "مغامرة طوكيو العصرية",');
console.log('                    "title_en" => "Tokyo Modern Adventure",');
console.log('                    "description" => "استكشف مدينة طوكيو النابضة بالحياة، من المعابد القديمة إلى الأحياء الحديثة مثل شيبويا وأكيهابارا.",');
console.log('                    "description_en" => "Explore the vibrant city of Tokyo, from ancient temples to modern districts like Shibuya and Akihabara.",');
console.log('                    "price" => 11499.00,');
console.log('                    "duration_days" => 12,');
console.log('                    "travel_period" => "أبريل",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-2506923.jpg"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "ca43be9d-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "مستكشف مدينة نيويورك",');
console.log('                    "title_en" => "New York City Explorer",');
console.log('                    "description" => "اكتشف معالم مدينة نيويورك الشهيرة بما في ذلك تايمز سكوير، سنترال بارك، مبنى إمباير ستيت.",');
console.log('                    "description_en" => "Discover famous New York City landmarks including Times Square, Central Park, Empire State Building.",');
console.log('                    "price" => 8999.00,');
console.log('                    "duration_days" => 7,');
console.log('                    "travel_period" => "مايو",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-802024.jpg"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "ca44e141-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "دبي الفاخرة والصحراء",');
console.log('                    "title_en" => "Dubai Luxury & Desert",');
console.log('                    "description" => "اختبر التسوق الفاخر، رحلات الصحراء، والهندسة المعمارية الحديثة بما في ذلك برج خليفة.",');
console.log('                    "description_en" => "Experience luxury shopping, desert safaris, and modern architecture including Burj Khalifa.",');
console.log('                    "price" => 12999.00,');
console.log('                    "duration_days" => 9,');
console.log('                    "travel_period" => "يونيو",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-3787839.jpg"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "ca4cfa16-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "رحلة تاريخية إلى روما",');
console.log('                    "title_en" => "Rome Historical Journey",');
console.log('                    "description" => "امش في التاريخ بزيارة الكولوسيوم، مدينة الفاتيكان، المنتدى الروماني.",');
console.log('                    "description_en" => "Walk through history visiting the Colosseum, Vatican City, Roman Forum.",');
console.log('                    "price" => 9499.00,');
console.log('                    "duration_days" => 10,');
console.log('                    "travel_period" => "يوليو",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-532263.jpg"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "ca58b0b6-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "هروب إلى جنة بالي",');
console.log('                    "title_en" => "Bali Paradise Escape",');
console.log('                    "description" => "استرخ في الشواطئ النقية، قم بزيارة المعابد القديمة، استكشف الأراضي الزراعية.",');
console.log('                    "description_en" => "Relax on pristine beaches, visit ancient temples, explore rice terraces.",');
console.log('                    "price" => 7499.00,');
console.log('                    "duration_days" => 13,');
console.log('                    "travel_period" => "أغسطس",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-1694621.jpg"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "ca59457f-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "تجربة لندن الملكية",');
console.log('                    "title_en" => "London Royal Experience",');
console.log('                    "description" => "قم بزيارة قصر باكنغهام، برج لندن، بيغ بن، واستمتع بشاي بعد الظهر التقليدية.",');
console.log('                    "description_en" => "Visit Buckingham Palace, Tower of London, Big Ben, and enjoy traditional afternoon tea.",');
console.log('                    "price" => 10499.00,');
console.log('                    "duration_days" => 8,');
console.log('                    "travel_period" => "سبتمبر",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-460672.jpg"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "ca59ec09-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "جنة سانتوريني اليونانية",');
console.log('                    "title_en" => "Santorini Greek Paradise",');
console.log('                    "description" => "اختبر غروب الشمس الرائع، المباني البيضاء، المطبخ المتوسطي، والشواطئ الجميلة.",');
console.log('                    "description_en" => "Experience stunning sunsets, white buildings, Mediterranean cuisine, and beautiful beaches.",');
console.log('                    "price" => 13999.00,');
console.log('                    "duration_days" => 11,');
console.log('                    "travel_period" => "أكتوبر",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-1010657.jpg"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "ca5a9eef-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "مغامرة ماتشو بيتشو",');
console.log('                    "title_en" => "Machu Picchu Adventure",');
console.log('                    "description" => "سافر عبر جبال الأنديز لاكتشاف الحصن القديم للإنكا واستكشف الهندسة المعمارية الاستعمارية.",');
console.log('                    "description_en" => "Travel through the Andes to discover the ancient Inca fortress and explore colonial architecture.",');
console.log('                    "price" => 14999.00,');
console.log('                    "duration_days" => 15,');
console.log('                    "travel_period" => "نوفمبر",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-2356045.jpg"');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "ca5b3620-9888-11f0-bbdc-106530eb27a7",');
console.log('                    "title" => "ملاذ مالي الفاخر",');
console.log('                    "title_en" => "Maldives Luxury Retreat",');
console.log('                    "description" => "اقم في فيلات فوق الماء، استكشف الشواطئ النقية، واستمتع بعلاجات السبا العالمية.",');
console.log('                    "description_en" => "Stay in overwater villas, explore pristine beaches, and enjoy world-class spa treatments.",');
console.log('                    "price" => 13499.00,');
console.log('                    "duration_days" => 14,');
console.log('                    "travel_period" => "ديسمبر",');
console.log('                    "max_persons" => 10,');
console.log('                    "category" => "international",');
console.log('                    "active" => 1,');
console.log('                    "featured" => 1,');
console.log('                    "image_url" => "/images/packages/pexels-photo-1287460.jpg"');
console.log('                ]');
console.log('            ];');
console.log('            echo json_encode($packages, JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/contact-messages":');
console.log('            $messages = [');
console.log('                [');
console.log('                    "id" => "msg-001",');
console.log('                    "name" => "أحمد محمد",');
console.log('                    "email" => "ahmed@example.com",');
console.log('                    "phone" => "+966501234567",');
console.log('                    "subject" => "استفسار عن رحلة دبي",');
console.log('                    "message" => "أريد معرفة تفاصيل رحلة دبي المتاحة",');
console.log('                    "type" => "booking",');
console.log('                    "status" => "new",');
console.log('                    "priority" => "normal",');
console.log('                    "created_at" => date("Y-m-d H:i:s")');
console.log('                ],');
console.log('                [');
console.log('                    "id" => "msg-002",');
console.log('                    "name" => "فاطمة علي",');
console.log('                    "email" => "fatima@example.com",');
console.log('                    "phone" => "+966502345678",');
console.log('                    "subject" => "شكوى في الخدمة",');
console.log('                    "message" => "واجهت مشكلة في الحجز الماضي",');
console.log('                    "type" => "complaint",');
console.log('                    "status" => "read",');
console.log('                    "priority" => "high",');
console.log('                    "created_at" => date("Y-m-d H:i:s", strtotime("-1 day"))');
console.log('                ]');
console.log('            ];');
console.log('            echo json_encode($messages, JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/seo":');
console.log('            $seoData = [');
console.log('                "title" => "World Trip Agency - وكالة السفر الرائدة",');
console.log('                "description" => "اكتشف أفضل الوجهات السياحية مع World Trip Agency",');
console.log('                "keywords" => "سفر، سياحة، رحلات، السعودية",');
console.log('                "og_title" => "World Trip Agency",');
console.log('                "og_description" => "وكالة السفر الرائدة في المملكة",');
console.log('                "og_image" => "/images/logo.png",');
console.log('                "twitter_card" => "summary_large_image",');
console.log('                "canonical_url" => "https://worldtripagency.com"');
console.log('            ];');
console.log('            echo json_encode($seoData, JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/admin/stats":');
console.log('            $stats = [');
console.log('                "total_packages" => 10,');
console.log('                "total_destinations" => 12,');
console.log('                "total_bookings" => 25,');
console.log('                "total_messages" => 8,');
console.log('                "total_users" => 15,');
console.log('                "revenue_this_month" => 125000,');
console.log('                "revenue_last_month" => 98000,');
console.log('                "new_bookings_today" => 3,');
console.log('                "new_messages_today" => 2,');
console.log('                "popular_destinations" => [');
console.log('                    ["name" => "دبي", "bookings" => 8],');
console.log('                    ["name" => "باريس", "bookings" => 6],');
console.log('                    ["name" => "لندن", "bookings" => 5]');
console.log('                ],');
console.log('                "recent_activities" => [');
console.log('                    ["action" => "حجز جديد", "user" => "أحمد محمد", "time" => "منذ 5 دقائق"],');
console.log('                    ["action" => "رسالة جديدة", "user" => "فاطمة علي", "time" => "منذ 15 دقيقة"],');
console.log('                    ["action" => "تسجيل مستخدم جديد", "user" => "محمد أحمد", "time" => "منذ ساعة"]');
console.log('                ]');
console.log('            ];');
console.log('            echo json_encode($stats, JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/cms/site-settings":');
console.log('            $settings = [');
console.log('                "site_name" => "World Trip Agency",');
console.log('                "site_description" => "Your premier travel partner",');
console.log('                "contact_email" => "info@worldtripagency.com",');
console.log('                "contact_phone" => "+966 50 123 4567"');
console.log('            ];');
console.log('            echo json_encode($settings, JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        case "/api/test":');
console.log('            echo json_encode([');
console.log('                "message" => "API is working",');
console.log('                "timestamp" => date("Y-m-d H:i:s"),');
console.log('                "path" => $path');
console.log('            ], JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('');
console.log('        default:');
console.log('            http_response_code(404);');
console.log('            echo json_encode([');
console.log('                "error" => "API endpoint not found",');
console.log('                "path" => $path');
console.log('            ], JSON_UNESCAPED_SLASHES);');
console.log('            break;');
console.log('    }');
console.log('} catch (Exception $e) {');
console.log('    http_response_code(500);');
console.log('    echo json_encode([');
console.log('        "error" => "Internal server error",');
console.log('        "message" => $e->getMessage()');
console.log('    ], JSON_UNESCAPED_SLASHES);');
console.log('}');
console.log('?>');
console.log('EOF');
console.log('');
console.log('# Replace the current api-handler.php');
console.log('cp api-handler.php api-handler-backup.php');
console.log('cp api-handler-complete.php api-handler.php');
console.log('');
console.log('# Test all API endpoints');
console.log('curl -k https://worldtripagency.com/api/packages');
console.log('curl -k https://worldtripagency.com/api/contact-messages');
console.log('curl -k https://worldtripagency.com/api/seo');
console.log('curl -k https://worldtripagency.com/api/admin/stats');
console.log('');
console.log('🎯 This will:');
console.log('✅ Add all 10 real packages with Arabic/English titles');
console.log('✅ Include proper pricing and duration information');
console.log('✅ Add all missing API endpoints for admin dashboard');
console.log('✅ Fix all 404 errors in admin panel');
console.log('✅ Complete admin dashboard functionality');
